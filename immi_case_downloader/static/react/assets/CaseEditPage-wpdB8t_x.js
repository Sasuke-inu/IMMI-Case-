import{j as s}from"./query-DQVcjD57.js";import{j,u as C,r as g}from"./vendor-CxW-pF4z.js";import{c as y,f as N}from"./use-cases-CF6q4pvg.js";import{B as w}from"./Breadcrumb-CG-MlZgK.js";import{u as S,t as p}from"./index-D-73LkCS.js";import{S as A}from"./save-Dv5a48yq.js";import"./api-aTUBEVUX.js";import"./chevron-right-Begj5eiQ.js";import"./charts-CKTqRh7i.js";const E=["","Migration","Refugee","Judicial Review","Citizenship","Visa Cancellation","Deportation","Character","Bridging Visa"],D=["","AATA","ARTA","FCA","FCCA","FedCFamC2G","HCA"],F=["title","citation","court","court_code","date","judges","outcome","visa_type","visa_subclass","visa_class_code","case_nature","legislation","legal_concepts","catchwords","url","source","tags","user_notes","applicant_name","respondent","country_of_origin","visa_subclass_number","hearing_date","is_represented","representative"];function M(){const{t:a}=S(),{id:l}=j(),i=C(),{data:c,isLoading:o}=y(l),u=N(),[t,x]=g.useState({}),[m,h]=g.useState(!1);g.useEffect(()=>{if(c?.case){const e={};for(const d of F)e[d]=String(c.case[d]??"");x(e)}},[c]),g.useEffect(()=>{if(!m)return;const e=d=>{d.preventDefault()};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[m]);const n=g.useCallback((e,d)=>{x(_=>({..._,[e]:d})),h(!0)},[]);if(o||!c)return s.jsx("div",{className:"flex h-64 items-center justify-center text-muted-text",children:a("pages.case_edit.loading")});const v=async e=>{if(e.preventDefault(),!t.title?.trim()){p.error(a("pages.case_edit.title_required"));return}try{await u.mutateAsync({id:l,data:t}),p.success(a("pages.case_edit.success")),h(!1),i(`/cases/${l}`)}catch(d){p.error(d.message)}};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(w,{items:[{label:a("nav.cases"),href:"/cases"},{label:c.case.citation||a("cases.title"),href:`/cases/${l}`},{label:a("pages.case_edit.breadcrumb_edit")}]}),m&&s.jsx("span",{className:"rounded-full bg-warning/10 px-2 py-0.5 text-xs font-medium text-warning",children:a("pages.case_edit.unsaved_changes")})]}),s.jsx("form",{onSubmit:v,children:s.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[s.jsxs("div",{className:"rounded-lg border border-border bg-card p-5 lg:col-span-2",children:[s.jsx("h2",{className:"mb-3 font-heading text-base font-semibold",children:a("pages.case_edit.case_metadata")}),s.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[s.jsx(r,{label:`${a("cases.case_title")} *`,value:t.title,onChange:e=>n("title",e)}),s.jsx(r,{label:a("cases.citation"),value:t.citation,onChange:e=>n("citation",e)}),s.jsx(r,{label:a("cases.court"),value:t.court,onChange:e=>n("court",e)}),s.jsx(b,{label:a("cases.court_code"),value:t.court_code,options:D,onChange:e=>n("court_code",e)}),s.jsx(r,{label:a("cases.date"),value:t.date,onChange:e=>n("date",e),placeholder:"DD Month YYYY"}),s.jsx(r,{label:a("units.year"),value:t.year,onChange:e=>n("year",e),type:"number"}),s.jsx(r,{label:a("cases.judges"),value:t.judges,onChange:e=>n("judges",e)}),s.jsx(r,{label:a("cases.outcome"),value:t.outcome,onChange:e=>n("outcome",e)}),s.jsx(r,{label:a("cases.visa_type"),value:t.visa_type,onChange:e=>n("visa_type",e)}),s.jsx(r,{label:a("cases.visa_subclass"),value:t.visa_subclass,onChange:e=>n("visa_subclass",e)}),s.jsx(r,{label:a("cases.class_code"),value:t.visa_class_code,onChange:e=>n("visa_class_code",e)}),s.jsx(b,{label:a("cases.nature"),value:t.case_nature,options:E,onChange:e=>n("case_nature",e)}),s.jsx(r,{label:a("cases.legislation"),value:t.legislation,onChange:e=>n("legislation",e),span2:!0}),s.jsx(r,{label:a("cases.legal_concepts"),value:t.legal_concepts,onChange:e=>n("legal_concepts",e),span2:!0,placeholder:"Semicolon-separated"}),s.jsx(r,{label:a("cases.url"),value:t.url,onChange:e=>n("url",e),span2:!0}),s.jsx(r,{label:a("cases.source"),value:t.source,onChange:e=>n("source",e)}),s.jsx(f,{label:a("case_detail.catchwords"),value:t.catchwords,onChange:e=>n("catchwords",e),rows:3})]}),s.jsx("h2",{className:"mb-3 mt-5 font-heading text-base font-semibold",children:a("pages.case_edit.parties_representation")}),s.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[s.jsx(r,{label:a("cases.applicant"),value:t.applicant_name,onChange:e=>n("applicant_name",e)}),s.jsx(r,{label:a("cases.respondent"),value:t.respondent,onChange:e=>n("respondent",e)}),s.jsx(r,{label:a("cases.country_of_origin"),value:t.country_of_origin,onChange:e=>n("country_of_origin",e)}),s.jsx(r,{label:a("cases.subclass_no"),value:t.visa_subclass_number,onChange:e=>n("visa_subclass_number",e)}),s.jsx(r,{label:a("cases.hearing_date"),value:t.hearing_date,onChange:e=>n("hearing_date",e),placeholder:"DD Month YYYY"}),s.jsx(b,{label:a("cases.represented"),value:t.is_represented,options:["","Yes","No","Self-represented"],onChange:e=>n("is_represented",e)}),s.jsx(r,{label:a("cases.representative"),value:t.representative,onChange:e=>n("representative",e),span2:!0})]})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"rounded-lg border border-border bg-card p-5",children:[s.jsx("h2",{className:"mb-3 font-heading text-base font-semibold",children:a("pages.case_edit.annotations")}),s.jsx(r,{label:a("case_detail.tags"),value:t.tags,onChange:e=>n("tags",e),placeholder:"Comma-separated"}),s.jsx("div",{className:"mt-4",children:s.jsx(f,{label:a("case_detail.notes"),value:t.user_notes,onChange:e=>n("user_notes",e),rows:8})})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{type:"button",onClick:()=>i(-1),className:"flex-1 rounded-md border border-border px-4 py-2 text-sm text-foreground hover:bg-surface",children:a("pages.case_edit.cancel_button")}),s.jsxs("button",{type:"submit",disabled:u.isPending,className:"flex flex-1 items-center justify-center gap-1 rounded-md bg-accent px-4 py-2 text-sm font-medium text-white hover:bg-accent-light disabled:opacity-50",children:[s.jsx(A,{className:"h-4 w-4"}),u.isPending?a("pages.case_edit.saving"):a("pages.case_edit.save_button")]})]})]})]})})]})}function r({label:a,value:l,onChange:i,type:c="text",placeholder:o,span2:u}){return s.jsxs("div",{className:u?"sm:col-span-2":"",children:[s.jsx("label",{className:"mb-1 block text-xs font-medium text-secondary-text",children:a}),s.jsx("input",{type:c,value:l??"",onChange:t=>i(t.target.value),placeholder:o,className:"w-full rounded-md border border-border bg-surface px-3 py-1.5 text-sm text-foreground focus:border-accent focus:outline-none focus:ring-1 focus:ring-accent"})]})}function b({label:a,value:l,options:i,onChange:c}){return s.jsxs("div",{children:[s.jsx("label",{className:"mb-1 block text-xs font-medium text-secondary-text",children:a}),s.jsx("select",{value:l??"",onChange:o=>c(o.target.value),className:"w-full rounded-md border border-border bg-surface px-3 py-1.5 text-sm text-foreground focus:border-accent focus:outline-none focus:ring-1 focus:ring-accent",children:i.map(o=>s.jsx("option",{value:o,children:o||`Select ${a}...`},o))})]})}function f({label:a,value:l,onChange:i,rows:c=3}){return s.jsxs("div",{className:"sm:col-span-2",children:[s.jsx("label",{className:"mb-1 block text-xs font-medium text-secondary-text",children:a}),s.jsx("textarea",{value:l??"",onChange:o=>i(o.target.value),rows:c,className:"w-full rounded-md border border-border bg-surface px-3 py-1.5 text-sm text-foreground focus:border-accent focus:outline-none focus:ring-1 focus:ring-accent"})]})}export{M as CaseEditPage};
