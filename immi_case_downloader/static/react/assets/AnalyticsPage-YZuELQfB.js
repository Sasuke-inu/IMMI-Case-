import{j as e,u as C,k as L}from"./query-DQVcjD57.js";import{r as f,L as ye}from"./vendor-CxW-pF4z.js";import{A as ge}from"./AnalyticsFilters-BERX9T28.js";import{c as D,u as p,a as A,X as be}from"./index-Bnk0r1Pl.js";import{R as je}from"./rotate-ccw-B0XuW8jB.js";import{S as ve}from"./save-BIREmgls.js";import{a as Q}from"./use-cases-DtOm505J.js";import{h as Ne,i as ke,j as Se,k as we,l as _e,m as Ce,n as Le,o as $e,q as ze,r as Re}from"./api-mEKAgK73.js";import{R as S,B as E,X as w,Y as j,T as v,d as z,C as B,f as J,g as Z,b as V,L as P,h as Y,A as Fe,e as U,S as Oe,i as Me,j as Ee,k as Te,l as Ae}from"./charts-CKTqRh7i.js";const De=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],Ke=D("arrow-down-right",De);const We=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],qe=D("arrow-up-right",We);const Be=[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z",key:"oz39mx"}]],Ve=D("bookmark",Be);const Pe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ie=D("circle-question-mark",Pe);const Ye=[["path",{d:"M6 18h8",key:"1borvv"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M14 22a7 7 0 1 0 0-14h-1",key:"1jwaiy"}],["path",{d:"M9 14h2",key:"197e7h"}],["path",{d:"M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2Z",key:"1bmzmy"}],["path",{d:"M12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3",key:"1drr47"}]],Ge=D("microscope",Ye),ee="analytics-filter-presets";function He(){try{const t=localStorage.getItem(ee);return t?JSON.parse(t):[]}catch{return[]}}function Je(t){localStorage.setItem(ee,JSON.stringify(t))}function I(t,a){return t.includes(a)?t.filter(n=>n!==a):[...t,a]}function Ue({caseNatures:t,visaSubclasses:a,outcomeTypes:n,selectedNatures:s,selectedSubclasses:o,selectedOutcomes:r,onNaturesChange:c,onSubclassesChange:i,onOutcomesChange:d}){const{t:u}=p(),[y,g]=f.useState(""),[_,N]=f.useState(He),m=s.length+o.length+r.length,h=()=>{c([]),i([]),d([])},R=()=>{if(!y.trim())return;const x={name:y.trim(),natures:s,subclasses:o,outcomes:r},l=[..._.filter(k=>k.name!==x.name),x];Je(l),N(l),g("")},F=x=>{c(x.natures),i(x.subclasses),d(x.outcomes)};return e.jsxs("div",{className:"rounded-lg border border-border bg-card p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:u("analytics.advanced_filters",{defaultValue:"Advanced Filters"})}),m>0&&e.jsx("span",{"data-testid":"active-filter-count",className:"inline-flex h-5 min-w-5 items-center justify-center rounded-full bg-accent px-1.5 text-[10px] font-bold text-white",children:m})]}),m>0&&e.jsxs("button",{type:"button",onClick:h,"aria-label":"Clear all filters",className:"inline-flex items-center gap-1 text-xs text-muted-text hover:text-foreground",children:[e.jsx(je,{className:"h-3 w-3"}),u("common.clear",{defaultValue:"Clear"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1.5 text-xs font-medium text-muted-text",children:"Case Nature"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.map(x=>{const l=s.includes(x);return e.jsx("button",{type:"button",onClick:()=>c(I(s,x)),className:A("rounded-full px-2.5 py-1 text-xs font-medium transition-colors",l?"bg-accent text-white":"bg-surface text-secondary-text hover:bg-accent-muted hover:text-accent"),children:x},x)})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1.5 text-xs font-medium text-muted-text",children:"Visa Subclass"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:a.map(x=>{const l=o.includes(x);return e.jsx("button",{type:"button",onClick:()=>i(I(o,x)),className:A("rounded-full px-2.5 py-1 text-xs font-medium transition-colors",l?"bg-accent text-white":"bg-surface text-secondary-text hover:bg-accent-muted hover:text-accent"),children:x},x)})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1.5 text-xs font-medium text-muted-text",children:"Outcome"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:n.map(x=>{const l=r.includes(x);return e.jsx("button",{type:"button",onClick:()=>d(I(r,x)),className:A("rounded-full px-2.5 py-1 text-xs font-medium transition-colors",l?"bg-accent text-white":"bg-surface text-secondary-text hover:bg-accent-muted hover:text-accent"),children:x},x)})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 border-t border-border pt-2",children:[_.map(x=>e.jsxs("button",{type:"button",onClick:()=>F(x),className:"inline-flex items-center gap-1 rounded-md border border-border px-2 py-1 text-xs text-secondary-text hover:bg-surface hover:text-foreground",children:[e.jsx(Ve,{className:"h-3 w-3"}),x.name]},x.name)),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"text",value:y,onChange:x=>g(x.target.value),placeholder:u("analytics.preset_name_placeholder",{defaultValue:"Preset name..."}),className:"w-28 rounded-md border border-border bg-background px-2 py-1 text-xs text-foreground placeholder:text-muted-text",onKeyDown:x=>{x.key==="Enter"&&R()}}),e.jsxs("button",{type:"button",onClick:R,"aria-label":"Save preset",disabled:!y.trim(),className:"inline-flex items-center gap-1 rounded-md border border-border px-2 py-1 text-xs text-secondary-text hover:bg-surface hover:text-foreground disabled:opacity-40",children:[e.jsx(ve,{className:"h-3 w-3"}),u("common.save",{defaultValue:"Save"})]})]})]})]})}function b({title:t,children:a,isLoading:n,isEmpty:s,className:o}){const{t:r}=p();return e.jsxs("div",{className:`flex h-full flex-col rounded-lg border border-border bg-card p-4 ${o??""}`,children:[e.jsx("h3",{className:"mb-3 font-heading text-base font-semibold text-foreground",children:t}),n?e.jsxs("div",{className:"flex flex-1 flex-col gap-3 pt-2",children:[e.jsx("div",{className:"h-4 w-3/4 animate-pulse rounded bg-border/40"}),e.jsx("div",{className:"h-4 w-1/2 animate-pulse rounded bg-border/40"}),e.jsx("div",{className:"h-32 w-full animate-pulse rounded bg-border/40"}),e.jsx("div",{className:"h-4 w-2/3 animate-pulse rounded bg-border/40"})]}):s?e.jsx("div",{className:"flex flex-1 items-center justify-center text-sm text-muted-text",children:r("chart.no_data")}):e.jsx("div",{className:"min-h-0 flex-1",children:a})]})}const $=t=>[t?.court,t?.yearFrom,t?.yearTo,t?.caseNatures?.join(","),t?.visaSubclasses?.join(","),t?.outcomeTypes?.join(",")];function te(t){return C({queryKey:["analytics","outcomes",...$(t)],queryFn:()=>Ne(t),staleTime:5*6e4,placeholderData:L})}function Xe(t,a=20){return C({queryKey:["analytics","judges",a,...$(t)],queryFn:()=>ke(t,a),staleTime:5*6e4,placeholderData:L})}function ae(t,a=20){return C({queryKey:["analytics","concepts",a,...$(t)],queryFn:()=>Se(t,a),staleTime:5*6e4,placeholderData:L})}function se(t){return C({queryKey:["analytics","nature-outcome",...$(t)],queryFn:()=>we(t),staleTime:5*6e4,placeholderData:L})}function Qe(t){return C({queryKey:["analytics","success-rate",...$(t),t.visa_subclass,t.case_nature,...t.legal_concepts??[]],queryFn:()=>_e(t),staleTime:5*6e4,placeholderData:L})}function re(t){return C({queryKey:["analytics","concept-effectiveness",...$(t),t?.limit??30],queryFn:()=>Ce(t),staleTime:5*6e4,placeholderData:L})}function Ze(t){return C({queryKey:["analytics","concept-cooccurrence",...$(t),t?.limit??15,t?.min_count??50],queryFn:()=>Le(t),staleTime:5*6e4,placeholderData:L})}function oe(t){return C({queryKey:["analytics","concept-trends",...$(t),t?.limit??10],queryFn:()=>$e(t),staleTime:5*6e4,placeholderData:L})}function et(t){return C({queryKey:["analytics","flow-matrix",...$(t),t?.top_n??8],queryFn:()=>ze(t),staleTime:5*6e4,placeholderData:L})}function tt(t){return C({queryKey:["analytics","monthly-trends",...$(t)],queryFn:()=>Re(t),staleTime:5*6e4,placeholderData:L})}function at({winCount:t,lossCount:a}){const n=[{name:"Cases",win:t,loss:a}];return e.jsx(S,{width:"100%",height:72,children:e.jsxs(E,{data:n,layout:"vertical",margin:{top:6,right:8,left:0,bottom:0},children:[e.jsx(w,{type:"number",hide:!0}),e.jsx(j,{type:"category",dataKey:"name",hide:!0}),e.jsx(v,{formatter:(s,o)=>[Number(s??0).toLocaleString(),o==="win"?"Wins":"Losses"],contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)"}}),e.jsxs(z,{dataKey:"win",stackId:"total",radius:[4,0,0,4],children:[e.jsx(B,{fill:"#1f8a4d"}),e.jsx(J,{dataKey:"win",position:"insideLeft",fill:"#ffffff",fontSize:11})]}),e.jsxs(z,{dataKey:"loss",stackId:"total",radius:[0,4,4,0],children:[e.jsx(B,{fill:"#b64040"}),e.jsx(J,{dataKey:"loss",position:"insideRight",fill:"#ffffff",fontSize:11})]})]})})}function st(t){return t>=1.2?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-200":t>=1?"bg-sky-100 text-sky-800 dark:bg-sky-900/40 dark:text-sky-200":"bg-rose-100 text-rose-800 dark:bg-rose-900/40 dark:text-rose-200"}function rt({combos:t}){const{t:a}=p();return t.length?e.jsx("div",{className:"overflow-x-auto -mx-1 px-1",children:e.jsxs("table",{className:"w-full min-w-[420px] text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border text-left text-xs uppercase tracking-wide text-muted-text",children:[e.jsx("th",{className:"py-2 pr-2",children:a("analytics.concepts_col")}),e.jsx("th",{className:"py-2 pr-2",children:a("analytics.cases_col")}),e.jsx("th",{className:"py-2 pr-2",children:a("analytics.win_rate")}),e.jsx("th",{className:"py-2",children:a("analytics.lift")})]})}),e.jsx("tbody",{children:t.slice(0,8).map(n=>e.jsxs("tr",{className:"border-b border-border-light/60",children:[e.jsx("td",{className:"py-2 pr-2 text-foreground",children:n.concepts.join(" + ")}),e.jsx("td",{className:"py-2 pr-2 text-secondary-text",children:n.count.toLocaleString()}),e.jsxs("td",{className:"py-2 pr-2 text-secondary-text",children:[n.win_rate.toFixed(1),"%"]}),e.jsx("td",{className:"py-2",children:e.jsxs("span",{className:`rounded-full px-2 py-0.5 text-xs font-semibold ${st(n.lift)}`,children:[n.lift.toFixed(2),"x"]})})]},n.concepts.join("|")))})]})}):e.jsx("p",{className:"text-sm text-muted-text",children:a("analytics.no_cooccurrence_data")})}function ne({totalMatching:t}){const{t:a}=p(),s=(o=>o>=100?{level:"high",label:a("analytics.confidence_high"),bgColor:"bg-green-100",textColor:"text-green-800",borderColor:"border-green-200"}:o>=50?{level:"medium",label:a("analytics.confidence_medium"),bgColor:"bg-yellow-100",textColor:"text-yellow-800",borderColor:"border-yellow-200"}:{level:"low",label:a("analytics.confidence_low"),bgColor:"bg-red-100",textColor:"text-red-800",borderColor:"border-red-200"})(t);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{"data-testid":`confidence-badge-${s.level}`,className:A("flex items-center gap-1.5 rounded-md border px-2.5 py-1 text-xs font-medium",s.bgColor,s.textColor,s.borderColor),children:[e.jsxs("span",{children:["N=",t]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:s.label})]}),e.jsx("button",{"aria-label":a("analytics.confidence_tooltip_label"),className:"text-muted-text hover:text-foreground transition-colors",title:a("analytics.confidence_tooltip"),children:e.jsx(Ie,{className:"h-4 w-4"})})]})}function ce({data:t}){const{natures:a,outcomes:n,matrix:s}=t;let o=1;for(const c of a)for(const i of n){const d=s[c]?.[i]??0;d>o&&(o=d)}const r=(c,i)=>c.length>i?c.slice(0,i-1)+"…":c;return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"grid gap-px text-xs",style:{gridTemplateColumns:`160px repeat(${n.length}, minmax(70px, 1fr))`},children:[e.jsx("div",{className:"p-1.5 font-medium text-muted-text"}),n.map(c=>e.jsx("div",{className:"p-1.5 text-center text-[10px] font-semibold text-secondary-text",title:c,children:c},c)),a.map(c=>e.jsxs(f.Fragment,{children:[e.jsx("div",{className:"truncate p-1.5 text-[11px] font-medium text-foreground",title:c,children:r(c,25)}),n.map(i=>{const d=s[c]?.[i]??0,u=d/o;return e.jsx("div",{className:"flex items-center justify-center rounded-sm p-1.5 text-[10px]",style:{backgroundColor:d===0?"var(--color-surface)":`rgba(26, 82, 118, ${Math.max(u*.85,.1)})`,color:d===0?"var(--color-text-muted)":u>.3?"#fff":"var(--color-text-secondary)"},title:`${c} → ${i}: ${d.toLocaleString()}`,children:d>0?d.toLocaleString():"–"},`${c}-${i}`)})]},c))]})})}function ie({data:t}){const{t:a}=p(),n=t.concepts.slice(0,12).map(s=>({name:s.name,liftDelta:Number((s.lift-1).toFixed(2)),winRate:s.win_rate,total:s.total}));return n.length?e.jsx(S,{width:"100%",height:Math.max(n.length*32,260),children:e.jsxs(E,{data:n,layout:"vertical",margin:{top:0,right:10,left:10,bottom:0},children:[e.jsx(w,{type:"number",tick:{fontSize:11,fill:"var(--color-text-secondary)"},tickFormatter:s=>`${s>0?"+":""}${s.toFixed(2)}`}),e.jsx(j,{type:"category",dataKey:"name",width:140,tick:{fontSize:11,fill:"var(--color-text-secondary)"},axisLine:!1,tickLine:!1}),e.jsx(v,{formatter:(s,o)=>{const r=Number(s??0);return o==="liftDelta"?[r.toFixed(2),a("analytics.lift_delta")]:[String(s??0),"Value"]},labelFormatter:s=>String(s),contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)"}}),e.jsx(z,{dataKey:"liftDelta",radius:[3,3,3,3],children:n.map(s=>e.jsx(B,{fill:s.liftDelta>=0?"#1f8a4d":"#b64040"},s.name))})]})}):e.jsx("p",{className:"text-sm text-muted-text",children:a("analytics.no_effectiveness_data")})}const X=["#1a5276","#2d7d46","#6c3483","#b9770e","#a83232","#117864"];function le({data:t}){const{t:a}=p(),n=Object.keys(t.series).slice(0,6),s=new Set;n.forEach(r=>{t.series[r].forEach(c=>s.add(c.year))});const o=Array.from(s).sort((r,c)=>r-c).map(r=>{const c={year:r};return n.forEach(i=>{const d=t.series[i].find(u=>u.year===r);c[i]=d?.win_rate??0}),c});return o.length?e.jsx(S,{width:"100%",height:280,children:e.jsxs(Z,{data:o,margin:{top:5,right:10,left:-20,bottom:10},children:[e.jsx(V,{strokeDasharray:"3 3",stroke:"var(--color-border)",opacity:.35}),e.jsx(w,{dataKey:"year",tick:{fontSize:11,fill:"var(--color-text-secondary)"}}),e.jsx(j,{domain:[0,100],tick:{fontSize:11,fill:"var(--color-text-secondary)"},tickFormatter:r=>`${r}%`}),e.jsx(v,{formatter:r=>[`${Number(r??0).toFixed(1)}%`,a("analytics.win_rate")],contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)"}}),e.jsx(P,{wrapperStyle:{fontSize:11}}),n.map((r,c)=>e.jsx(Y,{type:"monotone",dataKey:r,stroke:X[c%X.length],dot:{r:2},strokeWidth:2},r))]})}):e.jsx("p",{className:"text-sm text-muted-text",children:a("analytics.no_trend_data")})}function ot({open:t,onClose:a,filters:n,currentRate:s,totalMatching:o}){const{t:r}=p(),{data:c,isLoading:i}=se(n),{data:d,isLoading:u}=re({...n,limit:15}),{data:y,isLoading:g}=oe({...n,limit:8});if(f.useEffect(()=>{if(!t)return;const N=m=>{m.key==="Escape"&&a()};return document.addEventListener("keydown",N),()=>document.removeEventListener("keydown",N)},[t,a]),!t)return null;const _=o.toLocaleString();return e.jsx("div",{"data-testid":"deep-modal-overlay",className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",onClick:a,children:e.jsxs("div",{className:"relative z-10 mx-4 max-h-[90vh] w-full max-w-4xl overflow-y-auto rounded-lg border border-border bg-card p-6 shadow-xl",onClick:N=>N.stopPropagation(),children:[e.jsxs("div",{className:"mb-6 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-foreground",children:r("analytics.deep_analysis_title",{defaultValue:"Success Rate Deep Analysis"})}),e.jsxs("div",{className:"mt-2 flex items-baseline gap-4",children:[e.jsxs("span",{className:"text-3xl font-bold text-accent",children:[s,"%"]}),e.jsxs("span",{className:"text-sm text-muted-text",children:[_," ",r("analytics.matching_cases",{defaultValue:"cases"})]}),e.jsx(ne,{totalMatching:o})]}),n.court&&e.jsx("span",{className:"mt-1 inline-block rounded bg-surface px-2 py-0.5 text-xs text-muted-text",children:n.court})]}),e.jsx("button",{onClick:a,"aria-label":"Close",className:"rounded-md p-1.5 text-muted-text hover:bg-surface hover:text-foreground",children:e.jsx(be,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"mb-3 text-lg font-semibold text-foreground",children:"Nature vs Outcome Breakdown"}),e.jsx("div",{className:"rounded-md border border-border bg-surface p-4",children:i||!c?e.jsx("p",{className:"text-sm text-muted-text",children:r("common.loading",{defaultValue:"Loading..."})}):e.jsx(ce,{data:c})})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"mb-3 text-lg font-semibold text-foreground",children:"Concept Effectiveness"}),e.jsx("div",{className:"rounded-md border border-border bg-surface p-4",children:u||!d?e.jsx("p",{className:"text-sm text-muted-text",children:r("common.loading",{defaultValue:"Loading..."})}):e.jsx(ie,{data:d})})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"mb-3 text-lg font-semibold text-foreground",children:"Concept Trends"}),e.jsx("div",{className:"rounded-md border border-border bg-surface p-4",children:g||!y?e.jsx("p",{className:"text-sm text-muted-text",children:r("common.loading",{defaultValue:"Loading..."})}):e.jsx(le,{data:y})})]})]})]})})}function nt(t,a,n){return Math.min(Math.max(t,a),n)}function ct(t){return t<40?"text-red-500":t<65?"text-yellow-500":"text-green-500"}function it(t){return t<40?"#ef4444":t<65?"#eab308":"#22c55e"}function lt({score:t,label:a}){const n=nt(Math.round(t),0,100),s=f.useMemo(()=>ct(n),[n]),o=f.useMemo(()=>it(n),[n]),r=70,c=90,i=85,d=Math.PI*r,u=n/100*d;return e.jsxs("div",{"data-testid":"risk-gauge",className:"flex flex-col items-center",children:[e.jsxs("svg",{width:180,height:100,viewBox:"0 0 180 100",children:[e.jsx("path",{d:`M ${c-r} ${i} A ${r} ${r} 0 0 1 ${c+r} ${i}`,fill:"none",stroke:"var(--color-border, #e5e7eb)",strokeWidth:12,strokeLinecap:"round"}),e.jsx("path",{d:`M ${c-r} ${i} A ${r} ${r} 0 0 1 ${c+r} ${i}`,fill:"none",stroke:o,strokeWidth:12,strokeLinecap:"round",strokeDasharray:`${u} ${d}`}),e.jsx("text",{x:c,y:i-10,textAnchor:"middle",dominantBaseline:"middle",fontSize:28,fontWeight:"bold",fill:"currentColor",children:n})]}),e.jsx("span",{"data-testid":"risk-gauge-label",className:`-mt-2 text-sm font-medium ${s}`,children:a})]})}function dt({filters:t}){const{t:a}=p(),[n,s]=f.useState(""),[o,r]=f.useState(""),[c,i]=f.useState([]),[d,u]=f.useState(!1),{data:y}=Q(),{data:g}=te(t),{data:_}=ae(t,18),N=f.useMemo(()=>({...t,visa_subclass:n||void 0,case_nature:o||void 0,legal_concepts:c}),[t,n,o,c]),{data:m,isLoading:h}=Qe(N),R=f.useMemo(()=>g?Object.keys(g.by_subclass).sort((l,k)=>Number(l)-Number(k)):[],[g]),F=_?.concepts??[],x=l=>{i(k=>k.includes(l)?k.filter(T=>T!==l):[...k,l])};return e.jsxs("section",{className:"rounded-lg border border-border bg-card p-4","data-testid":"success-rate-calculator",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:a("analytics.success_rate_calculator")}),e.jsx("p",{className:"text-sm text-muted-text",children:a("analytics.success_calculator_desc")})]}),e.jsxs("div",{className:"mb-1 flex flex-wrap items-center gap-x-1.5 text-xs font-medium text-muted-text",children:[e.jsx("span",{children:a("analytics.visa_subclass")}),e.jsxs("select",{value:n,onChange:l=>s(l.target.value),className:"rounded-md border border-border bg-background px-2 py-1.5 text-sm text-foreground",children:[e.jsx("option",{value:"",children:a("common.all")}),R.map(l=>e.jsx("option",{value:l,children:l},l))]}),e.jsx("span",{className:"ml-2",children:a("analytics.case_nature")}),e.jsxs("select",{value:o,onChange:l=>r(l.target.value),className:"rounded-md border border-border bg-background px-2 py-1.5 text-sm text-foreground",children:[e.jsx("option",{value:"",children:a("common.all")}),(y?.natures??[]).map(l=>e.jsx("option",{value:l,children:l},l))]}),e.jsx("span",{className:"ml-2",children:a("analytics.legal_concepts_label")}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:F.slice(0,12).map(l=>{const k=c.includes(l.name);return e.jsx("button",{type:"button",onClick:()=>x(l.name),className:A("rounded-full px-2 py-1 text-xs",k?"bg-accent text-white":"bg-surface text-secondary-text hover:bg-accent-muted hover:text-accent"),children:l.name},l.name)})})]}),h||!m?e.jsx("div",{className:"mt-4 text-sm text-muted-text",children:a("analytics.loading_calculator")}):e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid gap-4 lg:grid-cols-4",children:[e.jsxs("div",{className:"rounded-md border border-border p-3",children:[e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-muted-text",children:a("analytics.success_rate")}),e.jsxs("p",{className:"mt-1 text-3xl font-bold text-foreground","data-testid":"success-rate-number",children:[m.success_rate.overall.toFixed(1),"%"]}),e.jsxs("p",{className:"mt-1 text-xs text-secondary-text",children:[m.query.total_matching.toLocaleString()," ",a("analytics.matching_cases")]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(ne,{totalMatching:m.query.total_matching}),e.jsxs("button",{type:"button",onClick:()=>u(!0),className:"inline-flex items-center gap-1 rounded-md border border-border px-2 py-1 text-xs text-secondary-text hover:bg-surface hover:text-foreground",children:[e.jsx(Ge,{className:"h-3 w-3"}),a("analytics.deep_dive",{defaultValue:"Deep Dive"})]})]})]}),e.jsx("div",{className:"flex items-center justify-center rounded-md border border-border p-3",children:e.jsx(lt,{score:m.success_rate.overall,label:m.success_rate.overall>=65?a("analytics.favourable",{defaultValue:"Favourable"}):m.success_rate.overall>=40?a("analytics.moderate",{defaultValue:"Moderate"}):a("analytics.unfavourable",{defaultValue:"Unfavourable"})})}),e.jsxs("div",{className:"rounded-md border border-border p-3 lg:col-span-2",children:[e.jsx("p",{className:"mb-2 text-xs font-medium uppercase tracking-wide text-muted-text",children:a("analytics.outcome_funnel")}),e.jsx(at,{winCount:m.success_rate.win_count,lossCount:m.success_rate.loss_count})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs("div",{className:"rounded-md border border-border p-3",children:[e.jsx("p",{className:"mb-2 text-xs font-medium uppercase tracking-wide text-muted-text",children:a("analytics.top_concept_lift")}),e.jsx("div",{className:"space-y-2",children:m.by_concept.slice(0,6).map(l=>e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-foreground",children:l.concept}),e.jsxs("span",{className:"text-secondary-text",children:[l.win_rate.toFixed(1),"%"]})]}),e.jsx("div",{className:"h-2 rounded bg-surface",children:e.jsx("div",{className:"h-2 rounded bg-accent",style:{width:`${Math.min(l.win_rate,100)}%`}})})]},l.concept))})]}),e.jsxs("div",{className:"rounded-md border border-border p-3",children:[e.jsx("p",{className:"mb-2 text-xs font-medium uppercase tracking-wide text-muted-text",children:a("analytics.win_trend")}),e.jsx(S,{width:"100%",height:180,children:e.jsxs(Z,{data:m.trend,margin:{top:5,right:5,left:-20,bottom:0},children:[e.jsx(V,{strokeDasharray:"3 3",stroke:"var(--color-border)",opacity:.35}),e.jsx(w,{dataKey:"year",tick:{fontSize:11,fill:"var(--color-text-secondary)"}}),e.jsx(j,{tick:{fontSize:11,fill:"var(--color-text-secondary)"}}),e.jsx(v,{formatter:l=>[`${Number(l??0).toFixed(1)}%`,a("analytics.success_rate")],contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)"}}),e.jsx(Y,{type:"monotone",dataKey:"rate",stroke:"var(--color-primary)",strokeWidth:2,dot:{r:2}})]})})]})]}),e.jsxs("div",{className:"rounded-md border border-border p-3",children:[e.jsx("p",{className:"mb-2 text-xs font-medium uppercase tracking-wide text-muted-text",children:a("analytics.top_concept_combinations")}),e.jsx(rt,{combos:m.top_combos})]})]}),m&&e.jsx(ot,{open:d,onClose:()=>u(!1),filters:t,currentRate:m.success_rate.overall,totalMatching:m.query.total_matching})]})}const xt={Affirmed:"#2d7d46",Dismissed:"#a83232",Remitted:"#2a6496","Set Aside":"#6c3483",Allowed:"#117864",Refused:"#b9770e",Withdrawn:"#8b8680",Other:"#c0b8a8"};function mt({data:t}){const a=new Set;for(const o of Object.values(t))for(const r of Object.keys(o))a.add(r);const n=[...a].sort(),s=Object.entries(t).map(([o,r])=>{const c=Object.values(r).reduce((d,u)=>d+u,0),i={court:o,_total:c};for(const d of n)i[d]=c>0?Math.round((r[d]??0)/c*1e3)/10:0;return i}).sort((o,r)=>r._total-o._total);return e.jsx(S,{width:"100%",height:s.length*36+50,children:e.jsxs(E,{data:s,layout:"vertical",margin:{top:0,right:20,bottom:30,left:5},children:[e.jsx(w,{type:"number",domain:[0,100],tickFormatter:o=>`${o}%`,tick:{fontSize:11,fill:"var(--color-text-secondary)"},axisLine:!1,tickLine:!1}),e.jsx(j,{type:"category",dataKey:"court",tick:{fontSize:11,fill:"var(--color-text-secondary)"},width:85,axisLine:!1,tickLine:!1}),e.jsx(v,{formatter:(o,r)=>[`${Number(o??0).toFixed(1)}%`,r??""],contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)",fontSize:12,padding:"8px 12px"},itemStyle:{fontSize:12,padding:"1px 0"},labelStyle:{fontSize:12,fontWeight:600,marginBottom:4}}),e.jsx(P,{wrapperStyle:{fontSize:11,paddingTop:8,color:"var(--color-text-secondary)"},iconSize:10}),n.map(o=>e.jsx(z,{dataKey:o,stackId:"stack",fill:xt[o]??"#8b8680",maxBarSize:24},o))]})})}function ut({data:t}){const{t:a}=p(),n=Object.entries(t).map(([s,o])=>{const r=Object.values(o).reduce((g,_)=>g+_,0),c=o.Affirmed??0,i=o["Set Aside"]??0,d=o.Remitted??0,u=o.Allowed??0,y=i+d+u;return{year:Number(s),affirmedRate:r>0?Math.round(c/r*1e3)/10:0,applicantWinRate:r>0?Math.round(y/r*1e3)/10:0,total:r}}).filter(s=>s.total>=10).sort((s,o)=>s.year-o.year);return e.jsx(S,{width:"100%",height:"100%",minHeight:300,children:e.jsxs(Fe,{data:n,margin:{top:5,right:15,bottom:5,left:-10},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"affirmedGrad-trend",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#2d7d46",stopOpacity:.2}),e.jsx("stop",{offset:"95%",stopColor:"#2d7d46",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"applicantGrad-trend",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#2a6496",stopOpacity:.2}),e.jsx("stop",{offset:"95%",stopColor:"#2a6496",stopOpacity:0})]})]}),e.jsx(V,{strokeDasharray:"3 3",stroke:"var(--color-border)",opacity:.2}),e.jsx(w,{dataKey:"year",tick:{fontSize:11,fill:"var(--color-text-secondary)"},tickFormatter:s=>`'${String(s).slice(2)}`,axisLine:!1,tickLine:!1}),e.jsx(j,{domain:[0,100],tickFormatter:s=>`${s}%`,tick:{fontSize:11,fill:"var(--color-text-secondary)"},axisLine:!1,tickLine:!1}),e.jsx(v,{formatter:(s,o)=>[`${Number(s??0).toFixed(1)}%`,o??""],labelFormatter:s=>`${a("analytics.year_label")} ${s}`,contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)",fontSize:12,padding:"8px 12px"},itemStyle:{fontSize:12,padding:"1px 0"},labelStyle:{fontSize:12,fontWeight:600,marginBottom:4}}),e.jsx(P,{wrapperStyle:{fontSize:11,color:"var(--color-text-secondary)"},iconSize:8}),e.jsx(U,{type:"monotone",dataKey:"affirmedRate",name:a("analytics.affirmed_rate"),stroke:"#2d7d46",strokeWidth:2,fill:"url(#affirmedGrad-trend)",dot:{r:2,fill:"#2d7d46",strokeWidth:0},activeDot:{r:4,fill:"#2d7d46",strokeWidth:2,stroke:"#fff"}}),e.jsx(U,{type:"monotone",dataKey:"applicantWinRate",name:a("analytics.applicant_win_rate"),stroke:"#2a6496",strokeWidth:2,fill:"url(#applicantGrad-trend)",dot:{r:2,fill:"#2a6496",strokeWidth:0},activeDot:{r:4,fill:"#2a6496",strokeWidth:2,stroke:"#fff"}})]})})}function ft({data:t,limit:a=12}){const{t:n}=p(),s=Object.entries(t).map(([r,c])=>{const i=Object.values(c).reduce((u,y)=>u+y,0),d=c.Affirmed??0;return{subclass:r,affirmedRate:i>0?Math.round(d/i*1e3)/10:0,total:i}}).filter(r=>r.total>=20).sort((r,c)=>c.total-r.total).slice(0,a),o=r=>r>=55?"#2d7d46":r>=35?"#b9770e":"#a83232";return e.jsx(S,{width:"100%",height:s.length*32+30,children:e.jsxs(E,{data:s,layout:"vertical",margin:{top:0,right:30,bottom:0,left:0},children:[e.jsx(w,{type:"number",domain:[0,100],tickFormatter:r=>`${r}%`,tick:{fontSize:10,fill:"var(--color-text-secondary)"},axisLine:!1,tickLine:!1}),e.jsx(j,{type:"category",dataKey:"subclass",tick:{fontSize:10,fill:"var(--color-text-secondary)"},width:45,axisLine:!1,tickLine:!1}),e.jsx(v,{formatter:r=>[`${Number(r??0).toFixed(1)}%`,n("analytics.affirmed_rate")],labelFormatter:r=>`${n("analytics.visa_subclass")} ${r}`,contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)",fontSize:12,padding:"8px 12px"},itemStyle:{fontSize:12,padding:"1px 0"},labelStyle:{fontSize:12,fontWeight:600,marginBottom:4}}),e.jsx(z,{dataKey:"affirmedRate",name:"Affirmed Rate",maxBarSize:20,radius:[0,3,3,0],label:{position:"right",fontSize:10,fill:"var(--color-text-secondary)",formatter:r=>`${Number(r)}%`},children:s.map(r=>e.jsx(B,{fill:o(r.affirmedRate)},r.subclass))})]})})}function ht(t){return t.split(/\s+/).map(a=>a.length<=2?a:a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()).join(" ")}function pt({data:t}){const{t:a}=p(),n=t.slice(0,12).map(s=>{const o=ht(s.name);return{...s,displayName:o.length>18?o.slice(0,16)+"…":o,fullName:o}});return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(ye,{to:"/judge-profiles",className:"text-xs font-medium text-accent hover:underline",children:[a("buttons.view_all")," ",e.jsx("span",{"aria-hidden":"true",children:"→"})]})}),e.jsx(S,{width:"100%",height:n.length*38+35,children:e.jsxs(E,{data:n,layout:"vertical",margin:{top:0,right:45,bottom:0,left:5},children:[e.jsx(w,{type:"number",hide:!0}),e.jsx(j,{type:"category",dataKey:"displayName",tick:{fontSize:12,fill:"var(--color-text-secondary)"},width:110,axisLine:!1,tickLine:!1}),e.jsx(v,{formatter:s=>[Number(s??0).toLocaleString(),a("chart.cases")],labelFormatter:(s,o)=>{const r=o?.[0]?.payload;return r?`${r.fullName??r.name} (${r.courts.join(", ")})`:""},contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)",fontSize:12,padding:"8px 12px"},itemStyle:{fontSize:12,padding:"1px 0"},labelStyle:{fontSize:12,fontWeight:600,marginBottom:4}}),e.jsx(z,{dataKey:"count",fill:"var(--color-primary)",radius:[0,3,3,0],maxBarSize:22,label:{position:"right",fontSize:11,fill:"var(--color-text-secondary)",formatter:s=>{const o=Number(s);return o>=1e3?`${(o/1e3).toFixed(1)}k`:String(o)}}})]})})]})}function yt({data:t}){const{t:a}=p(),n=t.slice(0,12).map(s=>({...s,displayName:s.name.length>18?s.name.slice(0,16)+"…":s.name}));return e.jsx(S,{width:"100%",height:n.length*38+35,children:e.jsxs(E,{data:n,layout:"vertical",margin:{top:0,right:45,bottom:0,left:5},children:[e.jsx(w,{type:"number",hide:!0}),e.jsx(j,{type:"category",dataKey:"displayName",tick:{fontSize:12,fill:"var(--color-text-secondary)"},width:120,axisLine:!1,tickLine:!1}),e.jsx(v,{formatter:s=>[Number(s??0).toLocaleString(),a("chart.cases")],labelFormatter:(s,o)=>o?.[0]?.payload?.name??"",contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)",fontSize:12,padding:"8px 12px"},itemStyle:{fontSize:12,padding:"1px 0"},labelStyle:{fontSize:12,fontWeight:600,marginBottom:4}}),e.jsx(z,{dataKey:"count",fill:"var(--color-accent)",radius:[0,3,3,0],maxBarSize:22,label:{position:"right",fontSize:11,fill:"var(--color-text-secondary)",formatter:s=>{const o=Number(s);return o>=1e3?`${(o/1e3).toFixed(1)}k`:String(o)}}})]})})}function gt({data:t}){const{t:a}=p(),n=t.concepts.slice(0,8),s=Array.from(new Set(n.flatMap(r=>Object.keys(r.by_court)))).slice(0,4),o=n.map(r=>{const c={name:r.name};return s.forEach(i=>{c[i]=r.by_court[i]?.win_rate??0}),c});return!o.length||!s.length?e.jsx("p",{className:"text-sm text-muted-text",children:a("analytics.no_court_data")}):e.jsx(S,{width:"100%",height:Math.max(o.length*38,260),children:e.jsxs(E,{data:o,layout:"vertical",margin:{top:0,right:10,left:20,bottom:0},children:[e.jsx(w,{type:"number",tick:{fontSize:11,fill:"var(--color-text-secondary)"},tickFormatter:r=>`${r}%`}),e.jsx(j,{type:"category",dataKey:"name",width:140,tick:{fontSize:11,fill:"var(--color-text-secondary)"},axisLine:!1,tickLine:!1}),e.jsx(v,{formatter:r=>[`${Number(r??0).toFixed(1)}%`,a("analytics.win_rate")],contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)"}}),e.jsx(P,{wrapperStyle:{fontSize:11}}),s.map((r,c)=>e.jsx(z,{dataKey:r,fill:["#1a5276","#2d7d46","#6c3483","#b9770e"][c%4],radius:[2,2,2,2]},r))]})})}function bt(t,a){return a===0?"var(--color-surface)":`rgba(26, 82, 118, ${Math.max(.15,Math.min(t/100,1))})`}function jt({data:t}){const{t:a}=p(),n=t.concepts.slice(0,12);return n.length?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"grid gap-px text-xs",style:{gridTemplateColumns:`180px repeat(${n.length}, minmax(70px, 1fr))`},children:[e.jsx("div",{className:"p-1.5 text-muted-text"}),n.map(s=>e.jsx("div",{className:"p-1.5 text-center text-[10px] font-semibold text-secondary-text",children:s},`head-${s}`)),n.map(s=>e.jsxs(f.Fragment,{children:[e.jsx("div",{className:"truncate p-1.5 text-[11px] font-medium text-foreground",title:s,children:s},`row-${s}`),n.map(o=>{const r=t.matrix[s]?.[o],c=r?.count??0,i=r?.win_rate??0;return e.jsx("div",{className:"flex items-center justify-center rounded-sm p-1.5 text-[10px]",style:{backgroundColor:bt(i,c),color:c===0?"var(--color-text-muted)":i>30?"#fff":"var(--color-text-secondary)"},title:`${s} + ${o}: ${c.toLocaleString()} cases, ${i.toFixed(1)}%`,children:c>0?c.toLocaleString():"-"},`${s}-${o}`)})]},s))]})}):e.jsx("p",{className:"text-sm text-muted-text",children:a("analytics.no_cooccurrence_data")})}function vt({data:t}){const{t:a}=p(),n=t.emerging.length>0,s=t.declining.length>0;return!n&&!s?e.jsx("p",{className:"text-sm text-muted-text",children:a("analytics.no_concepts_detected")}):e.jsxs("div",{className:"space-y-3",children:[n&&e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-muted-text",children:a("analytics.emerging")}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.emerging.slice(0,8).map(o=>e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-100 px-2 py-1 text-xs font-medium text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-200",children:[e.jsx(qe,{className:"h-3 w-3"}),o.name," (",o.growth_pct.toFixed(1),"%)"]},o.name))})]}),s&&e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-muted-text",children:a("analytics.declining")}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.declining.slice(0,8).map(o=>e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-rose-100 px-2 py-1 text-xs font-medium text-rose-800 dark:bg-rose-900/40 dark:text-rose-200",children:[e.jsx(Ke,{className:"h-3 w-3"}),o.name," (",o.decline_pct.toFixed(1),"%)"]},o.name))})]})]})}const Nt={court:"Court",nature:"Case Nature",outcome:"Outcome"},kt={court:"var(--color-primary)",nature:"var(--color-accent)",outcome:"var(--color-success, #22c55e)"};function St({x:t,y:a,width:n,height:s,index:o,payload:r}){const c=r.layer??"court";return e.jsxs(Me,{children:[e.jsx(Ee,{x:t,y:a,width:n,height:s,fill:kt[c]??"var(--color-muted)",fillOpacity:.85}),s>14&&e.jsx("text",{x:t+n+6,y:a+s/2,textAnchor:"start",dominantBaseline:"middle",fontSize:11,fill:"var(--color-text, currentColor)",children:r.name})]},`node-${o}`)}function wt(t){const[a,n]=f.useState(700);return f.useEffect(()=>{const s=t.current;if(!s)return;const o=new ResizeObserver(r=>{const c=r[0];c&&n(Math.floor(c.contentRect.width))});return o.observe(s),n(Math.floor(s.getBoundingClientRect().width)),()=>o.disconnect()},[t]),a}function _t({data:t}){const a=f.useRef(null),n=wt(a),s=!t.nodes.length||!t.links.length,o=f.useMemo(()=>{const r=new Set;for(const c of t.nodes)c.layer&&r.add(c.layer);return Array.from(r)},[t.nodes]);return s?e.jsx("div",{"data-testid":"flow-sankey-chart",className:"py-12 text-center text-muted-text",children:"No flow data available"}):e.jsxs("div",{"data-testid":"flow-sankey-chart",ref:a,className:"space-y-2",children:[e.jsx("div",{className:"flex justify-between px-4 text-xs font-medium text-muted-text",children:o.map(r=>e.jsx("span",{children:Nt[r]??r},r))}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(Oe,{width:Math.max(n,300),height:400,data:{nodes:t.nodes,links:t.links},node:e.jsx(St,{x:0,y:0,width:0,height:0,index:0,payload:{name:""}}),link:{stroke:"var(--color-border, #d1d5db)"},margin:{top:10,right:120,bottom:10,left:10},children:e.jsx(v,{})})})]})}function Ct({data:t}){return t.series.length?e.jsxs("div",{"data-testid":"monthly-trends-chart",className:"space-y-2",children:[e.jsx(S,{width:"100%",height:300,children:e.jsxs(Te,{data:t.series,margin:{top:10,right:20,left:-10,bottom:0},children:[e.jsx(V,{strokeDasharray:"3 3",stroke:"var(--color-border)",opacity:.35}),e.jsx(w,{dataKey:"month",tick:{fontSize:10,fill:"var(--color-text-secondary)"},interval:"preserveStartEnd"}),e.jsx(j,{yAxisId:"left",tick:{fontSize:10,fill:"var(--color-text-secondary)"}}),e.jsx(j,{yAxisId:"right",orientation:"right",tick:{fontSize:10,fill:"var(--color-text-secondary)"},domain:[0,100],tickFormatter:a=>`${a}%`}),e.jsx(v,{contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)"}}),e.jsx(z,{yAxisId:"left",dataKey:"total",fill:"var(--color-primary)",fillOpacity:.3,name:"Cases"}),e.jsx(Y,{yAxisId:"right",type:"monotone",dataKey:"win_rate",stroke:"var(--color-accent)",strokeWidth:2,dot:!1,name:"Win Rate %"}),t.events.map(a=>e.jsx(Ae,{yAxisId:"left",x:a.month,stroke:"var(--color-danger, #ef4444)",strokeDasharray:"4 4",label:{value:a.label,position:"top",fontSize:10,fill:"var(--color-danger, #ef4444)"}},a.month))]})}),t.events.length>0&&e.jsx("div",{className:"flex flex-wrap gap-3 text-xs text-muted-text",children:t.events.map(a=>e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{className:"inline-block h-2 w-2 rounded-full bg-red-500"}),e.jsx("span",{className:"font-medium",children:a.month}),e.jsx("span",{children:a.label})]},a.month))})]}):e.jsx("div",{"data-testid":"monthly-trends-chart",className:"py-12 text-center text-muted-text",children:"No monthly data available"})}const Lt=new Date().getFullYear(),$t=["Affirmed","Dismissed","Remitted","Set Aside","Allowed","Refused","Withdrawn","Other"];function Kt(){const{t}=p(),[a,n]=f.useState(""),[s,o]=f.useState(2e3),[r,c]=f.useState(Lt),[i,d]=f.useState([]),[u,y]=f.useState([]),[g,_]=f.useState([]),{data:N}=Q(),m=f.useMemo(()=>({court:a||void 0,yearFrom:s,yearTo:r,caseNatures:i.length?i:void 0,visaSubclasses:u.length?u:void 0,outcomeTypes:g.length?g:void 0}),[a,s,r,i,u,g]),{data:h,isLoading:R}=te(m),{data:F,isLoading:x}=Xe(m),{data:l,isLoading:k}=ae(m),{data:T,isLoading:de}=se(m),{data:O,isLoading:G}=re({...m,limit:30}),{data:K,isLoading:xe}=Ze({...m,limit:15,min_count:2}),{data:M,isLoading:H}=oe({...m,limit:10}),{data:W,isLoading:me}=et(m),{data:q,isLoading:ue}=tt(m),fe=(he,pe)=>{o(he),c(pe)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-semibold text-foreground",children:t("analytics.title")}),e.jsx("p",{className:"text-sm text-muted-text",children:t("analytics.subtitle")})]}),e.jsx(ge,{court:a,yearFrom:s,yearTo:r,onCourtChange:n,onYearRangeChange:fe}),e.jsx(Ue,{caseNatures:N?.natures??[],visaSubclasses:N?.visa_types??[],outcomeTypes:$t,selectedNatures:i,selectedSubclasses:u,selectedOutcomes:g,onNaturesChange:d,onSubclassesChange:y,onOutcomesChange:_})]}),e.jsx(dt,{filters:m}),e.jsx(b,{title:t("analytics.outcome_rate_by_court"),isLoading:R,isEmpty:!h||Object.keys(h.by_court).length===0,children:h&&e.jsx(mt,{data:h.by_court})}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsx(b,{title:t("analytics.affirmed_rate_trend"),isLoading:R,isEmpty:!h||Object.keys(h.by_year).length===0,children:h&&e.jsx(ut,{data:h.by_year})}),e.jsx(b,{title:t("analytics.affirmed_rate_visa"),isLoading:R,isEmpty:!h||Object.keys(h.by_subclass).length===0,children:h&&e.jsx(ft,{data:h.by_subclass})})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsx(b,{title:t("analytics.active_judges"),isLoading:x,isEmpty:!F||F.judges.length===0,children:F&&e.jsx(pt,{data:F.judges})}),e.jsx(b,{title:t("analytics.legal_concepts_frequency"),isLoading:k,isEmpty:!l||l.concepts.length===0,children:l&&e.jsx(yt,{data:l.concepts})})]}),e.jsx(b,{title:t("analytics.nature_outcome_matrix"),isLoading:de,isEmpty:!T||T.natures.length===0,children:T&&e.jsx(ce,{data:T})}),e.jsx(b,{title:t("analytics.flow_sankey",{defaultValue:"Case Flow (Court → Nature → Outcome)"}),isLoading:me,isEmpty:!W||W.nodes.length===0,children:W&&e.jsx(_t,{data:W})}),e.jsx(b,{title:t("analytics.monthly_trends",{defaultValue:"Monthly Trends & Policy Events"}),isLoading:ue,isEmpty:!q||q.series.length===0,children:q&&e.jsx(Ct,{data:q})}),e.jsxs("section",{className:"space-y-4","data-testid":"concept-intelligence-section",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-foreground",children:t("analytics.concept_intelligence")}),e.jsx("p",{className:"text-sm text-muted-text",children:t("analytics.concept_intelligence_desc")||"Identify legal concepts that correlate with better outcomes and how they evolve over time."})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsx(b,{title:t("analytics.concept_effectiveness"),isLoading:G,isEmpty:!O||O.concepts.length===0,children:O&&e.jsx(ie,{data:O})}),e.jsx(b,{title:t("analytics.concept_by_court"),isLoading:G,isEmpty:!O||O.concepts.length===0,children:O&&e.jsx(gt,{data:O})})]}),e.jsx(b,{title:t("analytics.concept_cooccurrence"),isLoading:xe,isEmpty:!K||K.concepts.length===0,children:K&&e.jsx(jt,{data:K})}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsx(b,{title:t("analytics.concept_trends"),isLoading:H,isEmpty:!M||Object.keys(M.series).length===0,children:M&&e.jsx(le,{data:M})}),e.jsx(b,{title:t("analytics.emerging_concepts"),isLoading:H,isEmpty:!M,children:M&&e.jsx(vt,{data:M})})]})]})]})}export{Kt as AnalyticsPage};
