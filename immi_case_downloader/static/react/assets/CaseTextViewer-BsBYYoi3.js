import{j as e}from"./query-DQVcjD57.js";import{r as l}from"./vendor-CxW-pF4z.js";import{c as v,u as T,S as j,X as _,a as C}from"./index-Bnk0r1Pl.js";import{C as D,a as L}from"./chevron-up-BWZp7hxx.js";import{D as M}from"./download-C5MK6Xwo.js";const $=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],U=v("maximize-2",$);const F=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],H=v("minimize-2",F);const P=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],V=v("printer",P),S=/^(CATCHWORDS?|THE DECISION|DECISION RECORD?|DECISION|REASONS FOR DECISION|STATEMENT OF DECISION AND REASONS|REASONS|ORDERS?|THE FACTS?|LEGISLATION|RELEVANT LAW|RELEVANT LEGISLATION|BACKGROUND|FINDINGS AND REASONS|FINDINGS|CONSIDERATION OF CLAIMS AND EVIDENCE|CONSIDERATION OF CLAIMS|CONSIDERATION|CONCLUSIONS?|APPEARANCES|REPRESENTATION|ISSUES|SUBMISSIONS|ANALYSIS|EVIDENCE|INTRODUCTION|MATERIALS BEFORE THE TRIBUNAL|JURISDICTION|APPENDIX [A-Z]:?|ANNEXURE [A-Z]:?)/m,z=/^(Title|Citation|Court|Date|URL|Division|Applicant|Representative|Case Number)\s*:/,B=/^(Member|Applicant|HH|Counsel|Senior Member|Presiding Member|Tribunal)(\s+\w+)?\s*:/,G=/^\[\d+\]/,K=/^={5,}$/;function W(r){const i=r.trim();return K.test(i)?"separator":z.test(i)?"metadata":S.test(i)?"major-heading":B.test(i)?"dialogue":G.test(i)?"footnote":i?"body":"blank"}function X(r){const i=r.split(`
`),d=new Set,s=[];let m=0;return i.forEach((c,h)=>{const a=W(c),f=c.trim();if(a==="blank"){m++,m<=2&&s.push(e.jsx("div",{className:"h-2"},h));return}switch(m=0,a){case"separator":s.push(e.jsx("div",{className:"my-4 border-t border-border"},h));break;case"metadata":s.push(e.jsx("div",{className:"font-mono text-[10px] text-muted-text pb-0.5",children:c},h));break;case"major-heading":{const N=`toc-${f.toLowerCase().replace(/[^a-z0-9]+/g,"-").slice(0,50)}`;let p=N,g=1;for(;d.has(p);)p=`${N}-${++g}`;d.add(p),s.push(e.jsx("div",{className:"mt-6 pt-4 border-t-2 border-accent/20",children:e.jsx("strong",{id:p,className:"block font-sans text-sm font-bold text-accent tracking-wide uppercase",children:f})},h));break}case"dialogue":s.push(e.jsx("div",{className:"my-0.5 border-l-2 border-info/40 bg-surface/40 pl-3 py-0.5 rounded-r font-sans text-xs text-foreground whitespace-pre-wrap",children:c},h));break;case"footnote":s.push(e.jsx("div",{className:"font-mono text-[10px] text-muted-text leading-loose whitespace-pre-wrap",children:c},h));break;default:s.push(e.jsx("div",{className:"font-mono text-xs text-foreground whitespace-pre-wrap leading-relaxed min-h-[1rem]",children:c},h))}}),s}function q(r){const i=r.split(`
`),d=[],s=new Set;return i.forEach(m=>{const c=m.trim();if(S.test(c)){const h=`toc-${c.toLowerCase().replace(/[^a-z0-9]+/g,"-").slice(0,50)}`;let a=h,f=1;for(;s.has(a);)a=`${h}-${++f}`;s.add(a),d.push({id:a,title:c})}}),d}function Z(r){const i=r.split(`
`),d=new Set;return i.map((s,m)=>{const c=s.trim();if(S.test(c)){const h=`toc-${c.toLowerCase().replace(/[^a-z0-9]+/g,"-").slice(0,50)}`;let a=h,f=1;for(;d.has(a);)a=`${h}-${++f}`;return d.add(a),e.jsxs("span",{children:[m>0&&`
`,e.jsx("strong",{id:a,className:"text-sm text-accent",children:s})]},m)}return e.jsxs("span",{children:[m>0?`
`:"",s]},m)})}function se({text:r,citation:i}){const{t:d}=T(),[s,m]=l.useState(""),[c,h]=l.useState(0),[a,f]=l.useState(!1),[N,p]=l.useState(!1),[g,k]=l.useState(null),w=l.useRef(null),E=l.useRef(null),b=l.useMemo(()=>q(r),[r]),u=l.useMemo(()=>{if(!s||s.length<2)return[];const t=[],n=r.toLowerCase(),o=s.toLowerCase();let x=n.indexOf(o);for(;x!==-1;)t.push(x),x=n.indexOf(o,x+1);return t},[r,s]);l.useEffect(()=>{h(0)},[u.length]),l.useEffect(()=>{if(u.length===0)return;w.current?.querySelector(".active-match")?.scrollIntoView({block:"center",behavior:"smooth"})},[c,u.length]),l.useEffect(()=>{if(b.length===0)return;const t=new IntersectionObserver(n=>{const o=n.filter(x=>x.isIntersecting);o.length>0&&k(o[0].target.id)},{root:w.current,rootMargin:"0px 0px -75% 0px",threshold:0});return b.forEach(n=>{const o=document.getElementById(n.id);o&&t.observe(o)}),()=>t.disconnect()},[b,a]),l.useEffect(()=>{const t=n=>{(n.metaKey||n.ctrlKey)&&n.key==="f"&&(n.preventDefault(),p(!0),setTimeout(()=>E.current?.focus(),50)),n.key==="Escape"&&N&&(p(!1),m(""))};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[N]);const I=l.useCallback(t=>{u.length!==0&&h(n=>(n+t+u.length)%u.length)},[u.length]),y=l.useCallback(t=>{document.getElementById(t)?.scrollIntoView({behavior:"smooth",block:"start"})},[]),A=l.useCallback(()=>{const t=new Blob([r],{type:"text/plain"}),n=URL.createObjectURL(t),o=document.createElement("a");o.href=n,o.download=`${i??"case"}.txt`,o.click(),URL.revokeObjectURL(n)},[r,i]),O=l.useCallback(()=>{const t=window.open("","_blank");t&&(t.document.write(`<html><head><title>${i??"Case"}</title>
      <style>body{font-family:monospace;font-size:12px;white-space:pre-wrap;padding:2em;line-height:1.6}</style>
      </head><body>${r.replace(/</g,"&lt;")}</body></html>`),t.document.close(),t.print())},[r,i]),R=l.useMemo(()=>{if(!r)return null;if(s&&s.length>=2&&u.length>0){const t=[];let n=0;return u.forEach((o,x)=>{o>n&&t.push({text:r.slice(n,o),isMatch:!1,matchIdx:-1}),t.push({text:r.slice(o,o+s.length),isMatch:!0,matchIdx:x}),n=o+s.length}),n<r.length&&t.push({text:r.slice(n),isMatch:!1,matchIdx:-1}),t.map((o,x)=>o.isMatch?e.jsx("mark",{className:o.matchIdx===c?"active-match bg-warning text-foreground rounded-sm px-0.5":"bg-warning/30 rounded-sm px-0.5",children:o.text},x):e.jsx("span",{children:Z(o.text)},x))}return X(r)},[r,s,u,c]);return e.jsxs("div",{className:"rounded-lg border border-border bg-card",children:[e.jsxs("div",{className:"flex items-center gap-2 border-b border-border px-4 py-2",children:[e.jsx("h2",{className:"font-heading text-lg font-semibold text-foreground",children:d("components.case_text_viewer.full_text")}),e.jsxs("div",{className:"ml-auto flex items-center gap-1.5",children:[N?e.jsxs("div",{className:"flex items-center gap-1 rounded-md border border-border bg-surface px-2 py-1",children:[e.jsx(j,{className:"h-3.5 w-3.5 text-muted-text"}),e.jsx("input",{ref:E,type:"text",value:s,onChange:t=>m(t.target.value),onKeyDown:t=>{t.key==="Enter"&&I(t.shiftKey?-1:1)},placeholder:d("components.case_text_viewer.search_in_text"),className:"w-40 bg-transparent text-sm text-foreground outline-none placeholder:text-muted-text"}),u.length>0&&e.jsxs("span",{className:"text-xs text-muted-text whitespace-nowrap",children:[c+1,"/",u.length]}),e.jsx("button",{onClick:()=>I(-1),className:"p-0.5 text-muted-text hover:text-foreground",children:e.jsx(D,{className:"h-3.5 w-3.5"})}),e.jsx("button",{onClick:()=>I(1),className:"p-0.5 text-muted-text hover:text-foreground",children:e.jsx(L,{className:"h-3.5 w-3.5"})}),e.jsx("button",{onClick:()=>{p(!1),m("")},className:"p-0.5 text-muted-text hover:text-foreground",children:e.jsx(_,{className:"h-3.5 w-3.5"})})]}):e.jsx("button",{onClick:()=>{p(!0),setTimeout(()=>E.current?.focus(),50)},className:"rounded-md p-1.5 text-muted-text hover:bg-surface hover:text-foreground",title:d("components.case_text_viewer.search_tooltip"),children:e.jsx(j,{className:"h-4 w-4"})}),e.jsx("button",{onClick:A,className:"rounded-md p-1.5 text-muted-text hover:bg-surface hover:text-foreground",title:d("components.case_text_viewer.download_tooltip"),children:e.jsx(M,{className:"h-4 w-4"})}),e.jsx("button",{onClick:O,className:"rounded-md p-1.5 text-muted-text hover:bg-surface hover:text-foreground",title:d("components.case_text_viewer.print_tooltip"),children:e.jsx(V,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>f(!a),className:"rounded-md p-1.5 text-muted-text hover:bg-surface hover:text-foreground",title:d(a?"components.case_text_viewer.collapse_tooltip":"components.case_text_viewer.expand_tooltip"),children:a?e.jsx(H,{className:"h-4 w-4"}):e.jsx(U,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex",children:[b.length>0&&e.jsxs("div",{className:`w-44 flex-shrink-0 border-r border-border overflow-y-auto ${a?"max-h-none":"max-h-[600px]"}`,children:[e.jsx("p",{className:"sticky top-0 bg-card px-3 pt-3 pb-1.5 text-[10px] font-semibold uppercase tracking-wider text-muted-text",children:d("components.case_text_viewer.table_of_contents")}),e.jsx("nav",{className:"pb-3",children:b.map(t=>e.jsx("button",{onClick:()=>y(t.id),className:C("w-full border-l-2 px-3 py-1 text-left text-[11px] leading-snug transition-colors",g===t.id?"border-accent bg-accent/5 font-medium text-accent":"border-transparent text-secondary-text hover:bg-surface hover:text-foreground"),children:t.title},t.id))})]}),e.jsx("div",{ref:w,className:C("flex-1 overflow-auto p-4 leading-relaxed text-foreground",s&&s.length>=2&&u.length>0?"whitespace-pre-wrap font-mono text-xs":"",a?"max-h-none":"max-h-[600px]"),children:R})]})]})}export{se as C};
