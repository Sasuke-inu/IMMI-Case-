import{j as e}from"./query-DQVcjD57.js";import{r as i,j as $,u as U,L as E}from"./vendor-CxW-pF4z.js";import{c as B,d as P,e as F}from"./use-cases-CF6q4pvg.js";import{C as S}from"./CourtBadge-CSxHQ2SD.js";import{O as H}from"./OutcomeBadge-CCZ6XL-s.js";import{N as V}from"./NatureBadge-BlBxpbbY.js";import{B as z}from"./Breadcrumb-DkhLTxuY.js";import{T as G,C as K}from"./ConfirmModal-BkAqCFGe.js";import{c as O,u as T,S as k,X,a as I,t as A}from"./index-C09Lid14.js";import{C as q,a as W}from"./chevron-up-BfQ7NQB_.js";import{D as Z}from"./download-PWp1J724.js";import{M as J,a as Y}from"./minimize-2-B8Hyc0ba.js";import{E as Q}from"./external-link-ZJL98cwU.js";import{C as ee,a as te}from"./copy-BkKBPxzf.js";import"./api-aTUBEVUX.js";import"./chevron-right-C5GK6v9S.js";import"./charts-CKTqRh7i.js";const se=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],ae=O("printer",se);const re=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],ne=O("square-pen",re),y=/^(CATCHWORDS?|THE DECISION|DECISION RECORD?|DECISION|REASONS FOR DECISION|STATEMENT OF DECISION AND REASONS|REASONS|ORDERS?|THE FACTS?|LEGISLATION|RELEVANT LAW|RELEVANT LEGISLATION|BACKGROUND|FINDINGS AND REASONS|FINDINGS|CONSIDERATION OF CLAIMS AND EVIDENCE|CONSIDERATION OF CLAIMS|CONSIDERATION|CONCLUSIONS?|APPEARANCES|REPRESENTATION|ISSUES|SUBMISSIONS|ANALYSIS|EVIDENCE|INTRODUCTION|MATERIALS BEFORE THE TRIBUNAL|JURISDICTION|APPENDIX [A-Z]:?|ANNEXURE [A-Z]:?)/m,oe=/^(Title|Citation|Court|Date|URL|Division|Applicant|Representative|Case Number)\s*:/,ce=/^(Member|Applicant|HH|Counsel|Senior Member|Presiding Member|Tribunal)(\s+\w+)?\s*:/,le=/^\[\d+\]/,de=/^={5,}$/;function ie(t){const o=t.trim();return de.test(o)?"separator":oe.test(o)?"metadata":y.test(o)?"major-heading":ce.test(o)?"dialogue":le.test(o)?"footnote":o?"body":"blank"}function me(t){const o=t.split(`
`),c=new Set,a=[];let f=0;return o.forEach((m,p)=>{const u=ie(m),g=m.trim();if(u==="blank"){f++,f<=2&&a.push(e.jsx("div",{className:"h-2"},p));return}switch(f=0,u){case"separator":a.push(e.jsx("div",{className:"my-4 border-t border-border"},p));break;case"metadata":a.push(e.jsx("div",{className:"font-mono text-[10px] text-muted-text pb-0.5",children:m},p));break;case"major-heading":{const v=`toc-${g.toLowerCase().replace(/[^a-z0-9]+/g,"-").slice(0,50)}`;let b=v,_=1;for(;c.has(b);)b=`${v}-${++_}`;c.add(b),a.push(e.jsx("div",{className:"mt-6 pt-4 border-t-2 border-accent/20",children:e.jsx("strong",{id:b,className:"block font-sans text-sm font-bold text-accent tracking-wide uppercase",children:g})},p));break}case"dialogue":a.push(e.jsx("div",{className:"my-0.5 border-l-2 border-info/40 bg-surface/40 pl-3 py-0.5 rounded-r font-sans text-xs text-foreground whitespace-pre-wrap",children:m},p));break;case"footnote":a.push(e.jsx("div",{className:"font-mono text-[10px] text-muted-text leading-loose whitespace-pre-wrap",children:m},p));break;default:a.push(e.jsx("div",{className:"font-mono text-xs text-foreground whitespace-pre-wrap leading-relaxed min-h-[1rem]",children:m},p))}}),a}function ue(t){const o=t.split(`
`),c=[],a=new Set;return o.forEach(f=>{const m=f.trim();if(y.test(m)){const p=`toc-${m.toLowerCase().replace(/[^a-z0-9]+/g,"-").slice(0,50)}`;let u=p,g=1;for(;a.has(u);)u=`${p}-${++g}`;a.add(u),c.push({id:u,title:m})}}),c}function xe(t){const o=t.split(`
`),c=new Set;return o.map((a,f)=>{const m=a.trim();if(y.test(m)){const p=`toc-${m.toLowerCase().replace(/[^a-z0-9]+/g,"-").slice(0,50)}`;let u=p,g=1;for(;c.has(u);)u=`${p}-${++g}`;return c.add(u),e.jsxs("span",{children:[f>0&&`
`,e.jsx("strong",{id:u,className:"text-sm text-accent",children:a})]},f)}return e.jsxs("span",{children:[f>0?`
`:"",a]},f)})}function he({text:t,citation:o}){const{t:c}=T(),[a,f]=i.useState(""),[m,p]=i.useState(0),[u,g]=i.useState(!1),[v,b]=i.useState(!1),[_,C]=i.useState(null),s=i.useRef(null),j=i.useRef(null),x=i.useMemo(()=>ue(t),[t]),n=i.useMemo(()=>{if(!a||a.length<2)return[];const r=[],l=t.toLowerCase(),d=a.toLowerCase();let N=l.indexOf(d);for(;N!==-1;)r.push(N),N=l.indexOf(d,N+1);return r},[t,a]);i.useEffect(()=>{p(0)},[n.length]),i.useEffect(()=>{if(n.length===0)return;s.current?.querySelector(".active-match")?.scrollIntoView({block:"center",behavior:"smooth"})},[m,n.length]),i.useEffect(()=>{if(x.length===0)return;const r=new IntersectionObserver(l=>{const d=l.filter(N=>N.isIntersecting);d.length>0&&C(d[0].target.id)},{root:s.current,rootMargin:"0px 0px -75% 0px",threshold:0});return x.forEach(l=>{const d=document.getElementById(l.id);d&&r.observe(d)}),()=>r.disconnect()},[x,u]),i.useEffect(()=>{const r=l=>{(l.metaKey||l.ctrlKey)&&l.key==="f"&&(l.preventDefault(),b(!0),setTimeout(()=>j.current?.focus(),50)),l.key==="Escape"&&v&&(b(!1),f(""))};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[v]);const w=i.useCallback(r=>{n.length!==0&&p(l=>(l+r+n.length)%n.length)},[n.length]),R=i.useCallback(r=>{document.getElementById(r)?.scrollIntoView({behavior:"smooth",block:"start"})},[]),L=i.useCallback(()=>{const r=new Blob([t],{type:"text/plain"}),l=URL.createObjectURL(r),d=document.createElement("a");d.href=l,d.download=`${o??"case"}.txt`,d.click(),URL.revokeObjectURL(l)},[t,o]),D=i.useCallback(()=>{const r=window.open("","_blank");r&&(r.document.write(`<html><head><title>${o??"Case"}</title>
      <style>body{font-family:monospace;font-size:12px;white-space:pre-wrap;padding:2em;line-height:1.6}</style>
      </head><body>${t.replace(/</g,"&lt;")}</body></html>`),r.document.close(),r.print())},[t,o]),M=i.useMemo(()=>{if(!t)return null;if(a&&a.length>=2&&n.length>0){const r=[];let l=0;return n.forEach((d,N)=>{d>l&&r.push({text:t.slice(l,d),isMatch:!1,matchIdx:-1}),r.push({text:t.slice(d,d+a.length),isMatch:!0,matchIdx:N}),l=d+a.length}),l<t.length&&r.push({text:t.slice(l),isMatch:!1,matchIdx:-1}),r.map((d,N)=>d.isMatch?e.jsx("mark",{className:d.matchIdx===m?"active-match bg-warning text-foreground rounded-sm px-0.5":"bg-warning/30 rounded-sm px-0.5",children:d.text},N):e.jsx("span",{children:xe(d.text)},N))}return me(t)},[t,a,n,m]);return e.jsxs("div",{className:"rounded-lg border border-border bg-card",children:[e.jsxs("div",{className:"flex items-center gap-2 border-b border-border px-4 py-2",children:[e.jsx("h2",{className:"font-heading text-lg font-semibold text-foreground",children:c("components.case_text_viewer.full_text")}),e.jsxs("div",{className:"ml-auto flex items-center gap-1.5",children:[v?e.jsxs("div",{className:"flex items-center gap-1 rounded-md border border-border bg-surface px-2 py-1",children:[e.jsx(k,{className:"h-3.5 w-3.5 text-muted-text"}),e.jsx("input",{ref:j,type:"text",value:a,onChange:r=>f(r.target.value),onKeyDown:r=>{r.key==="Enter"&&w(r.shiftKey?-1:1)},placeholder:c("components.case_text_viewer.search_in_text"),className:"w-40 bg-transparent text-sm text-foreground outline-none placeholder:text-muted-text"}),n.length>0&&e.jsxs("span",{className:"text-xs text-muted-text whitespace-nowrap",children:[m+1,"/",n.length]}),e.jsx("button",{onClick:()=>w(-1),className:"p-0.5 text-muted-text hover:text-foreground",children:e.jsx(q,{className:"h-3.5 w-3.5"})}),e.jsx("button",{onClick:()=>w(1),className:"p-0.5 text-muted-text hover:text-foreground",children:e.jsx(W,{className:"h-3.5 w-3.5"})}),e.jsx("button",{onClick:()=>{b(!1),f("")},className:"p-0.5 text-muted-text hover:text-foreground",children:e.jsx(X,{className:"h-3.5 w-3.5"})})]}):e.jsx("button",{onClick:()=>{b(!0),setTimeout(()=>j.current?.focus(),50)},className:"rounded-md p-1.5 text-muted-text hover:bg-surface hover:text-foreground",title:c("components.case_text_viewer.search_tooltip"),children:e.jsx(k,{className:"h-4 w-4"})}),e.jsx("button",{onClick:L,className:"rounded-md p-1.5 text-muted-text hover:bg-surface hover:text-foreground",title:c("components.case_text_viewer.download_tooltip"),children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx("button",{onClick:D,className:"rounded-md p-1.5 text-muted-text hover:bg-surface hover:text-foreground",title:c("components.case_text_viewer.print_tooltip"),children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>g(!u),className:"rounded-md p-1.5 text-muted-text hover:bg-surface hover:text-foreground",title:c(u?"components.case_text_viewer.collapse_tooltip":"components.case_text_viewer.expand_tooltip"),children:u?e.jsx(J,{className:"h-4 w-4"}):e.jsx(Y,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex",children:[x.length>0&&e.jsxs("div",{className:`w-44 flex-shrink-0 border-r border-border overflow-y-auto ${u?"max-h-none":"max-h-[600px]"}`,children:[e.jsx("p",{className:"sticky top-0 bg-card px-3 pt-3 pb-1.5 text-[10px] font-semibold uppercase tracking-wider text-muted-text",children:c("components.case_text_viewer.table_of_contents")}),e.jsx("nav",{className:"pb-3",children:x.map(r=>e.jsx("button",{onClick:()=>R(r.id),className:I("w-full border-l-2 px-3 py-1 text-left text-[11px] leading-snug transition-colors",_===r.id?"border-accent bg-accent/5 font-medium text-accent":"border-transparent text-secondary-text hover:bg-surface hover:text-foreground"),children:r.title},r.id))})]}),e.jsx("div",{ref:s,className:I("flex-1 overflow-auto p-4 leading-relaxed text-foreground",a&&a.length>=2&&n.length>0?"whitespace-pre-wrap font-mono text-xs":"",u?"max-h-none":"max-h-[600px]"),children:M})]})]})}function Te(){const{t}=T(),{id:o}=$(),c=U(),{data:a,isLoading:f}=B(o),{data:m}=P(o),p=F(),[u,g]=i.useState(!1),[v,b]=i.useState(!1);i.useEffect(()=>{const x=n=>{const w=n.target;w.tagName==="INPUT"||w.tagName==="TEXTAREA"||n.key==="e"&&!n.metaKey&&!n.ctrlKey&&c(`/cases/${o}/edit`)};return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[o,c]);const _=i.useCallback(async()=>{try{await p.mutateAsync(o),A.success(t("states.completed")),c("/cases")}catch(x){A.error(x.message)}},[o,p,c]),C=i.useCallback(()=>{a?.case.citation&&(navigator.clipboard.writeText(a.case.citation),b(!0),setTimeout(()=>b(!1),2e3))},[a]);if(f||!a)return e.jsx("div",{className:"flex h-64 items-center justify-center text-muted-text",children:t("common.loading_ellipsis")});const s=a.case,j=a.full_text;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(z,{items:[{label:t("cases.title"),href:"/cases"},{label:s.citation||s.title||t("cases.case_details")}]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.url&&e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 rounded-md border border-border px-3 py-1.5 text-sm text-foreground hover:bg-surface",children:[e.jsx(Q,{className:"h-3.5 w-3.5"})," ",t("cases.url")]}),e.jsxs(E,{to:`/cases/${s.case_id}/edit`,className:"flex items-center gap-1 rounded-md border border-border px-3 py-1.5 text-sm text-foreground hover:bg-surface",children:[e.jsx(ne,{className:"h-3.5 w-3.5"})," ",t("common.edit")]}),e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-1 rounded-md border border-danger/30 px-3 py-1.5 text-sm text-danger hover:bg-danger/5",children:[e.jsx(G,{className:"h-3.5 w-3.5"})," ",t("common.delete")]})]})]}),e.jsxs("div",{className:"rounded-lg border border-border bg-card p-5",children:[e.jsxs("div",{className:"mb-2 flex flex-wrap items-center gap-2",children:[e.jsx(S,{court:s.court_code}),e.jsx(H,{outcome:s.outcome}),e.jsx(V,{nature:s.case_nature})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("h1",{className:"font-heading text-xl font-semibold text-foreground",children:s.citation||s.title}),e.jsx("button",{onClick:C,className:"mt-1 shrink-0 rounded-md p-1 text-muted-text hover:bg-surface hover:text-foreground",title:t("case_detail.copy_citation"),children:v?e.jsx(ee,{className:"h-4 w-4 text-success"}):e.jsx(te,{className:"h-4 w-4"})})]}),s.title&&s.citation&&s.title!==s.citation&&e.jsx("p",{className:"mt-1 text-sm text-secondary-text",children:s.title})]}),e.jsxs("div",{className:"rounded-lg border border-border bg-card p-5",children:[e.jsx("h2",{className:"mb-3 font-heading text-base font-semibold text-foreground",children:t("cases.case_information")}),e.jsxs("dl",{className:"grid gap-x-6 gap-y-2.5 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsx(h,{label:t("cases.title"),value:s.case_id,mono:!0}),e.jsx(h,{label:t("cases.citation"),value:s.citation}),e.jsx(h,{label:t("cases.date"),value:s.date}),e.jsx(h,{label:t("filters.court"),value:s.court}),e.jsx(h,{label:t("cases.court_code")||"Court Code",value:s.court_code}),e.jsx(h,{label:t("units.year"),value:s.year?String(s.year):""}),e.jsx(h,{label:t("cases.judges"),value:s.judges}),e.jsx(h,{label:t("cases.source")||"Source",value:s.source}),e.jsx(h,{label:t("cases.outcome"),value:s.outcome}),e.jsx(h,{label:t("cases.nature"),value:s.case_nature}),e.jsx(h,{label:t("cases.applicant"),value:s.applicant_name}),e.jsx(h,{label:t("cases.respondent"),value:s.respondent}),e.jsx(h,{label:t("cases.country_of_origin"),value:s.country_of_origin}),e.jsx(h,{label:t("cases.visa_type")||"Visa Type",value:s.visa_type}),e.jsx(h,{label:t("cases.visa_subclass"),value:s.visa_subclass,mono:!0}),e.jsx(h,{label:t("cases.subclass_no")||"Subclass No.",value:s.visa_subclass_number,mono:!0}),e.jsx(h,{label:t("cases.class_code")||"Class Code",value:s.visa_class_code,mono:!0}),e.jsx(h,{label:t("cases.hearing_date")||"Hearing Date",value:s.hearing_date}),e.jsx(h,{label:t("cases.represented")||"Represented",value:s.is_represented}),e.jsx(h,{label:t("cases.representative")||"Representative",value:s.representative}),e.jsx(h,{label:t("cases.legislation"),value:s.legislation})]})]}),s.catchwords&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-5",children:[e.jsx("h2",{className:"mb-2 font-heading text-base font-semibold",children:t("case_detail.catchwords")}),e.jsx("p",{className:"text-sm leading-relaxed text-secondary-text",children:s.catchwords})]}),s.legal_concepts&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-5",children:[e.jsx("h2",{className:"mb-2 font-heading text-base font-semibold",children:t("cases.legal_concepts")}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.legal_concepts.split(";").map(x=>{const n=x.trim();return n?e.jsx(E,{to:`/cases?keyword=${encodeURIComponent(n)}`,className:"rounded-full bg-surface px-2.5 py-0.5 text-xs text-foreground transition-colors hover:bg-accent-muted hover:text-accent",children:n},n):null})})]}),(s.tags||s.user_notes)&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-5",children:[e.jsxs("h2",{className:"mb-2 font-heading text-base font-semibold",children:[t("case_detail.notes")," & ",t("case_detail.tags")]}),s.tags&&e.jsxs("div",{className:"mb-3",children:[e.jsx("dt",{className:"mb-1 text-xs font-medium text-secondary-text",children:t("case_detail.tags")}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.tags.split(",").map(x=>{const n=x.trim();return n?e.jsx(E,{to:`/cases?tag=${encodeURIComponent(n)}`,className:"rounded-full bg-accent/10 px-2.5 py-0.5 text-xs font-medium text-accent hover:bg-accent/20",children:n},n):null})})]}),s.user_notes&&e.jsxs("div",{children:[e.jsx("dt",{className:"mb-1 text-xs font-medium text-secondary-text",children:t("case_detail.notes")}),e.jsx("p",{className:"whitespace-pre-wrap text-sm text-foreground",children:s.user_notes})]})]}),m&&m.cases.length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-5",children:[e.jsx("h2",{className:"mb-3 font-heading text-base font-semibold",children:t("cases.related_cases")}),e.jsx("div",{className:"grid gap-2 sm:grid-cols-2 lg:grid-cols-3",children:m.cases.map(x=>e.jsxs(E,{to:`/cases/${x.case_id}`,className:"flex items-center gap-3 rounded-md border border-border-light px-3 py-2 text-sm transition-colors hover:border-accent hover:bg-surface",children:[e.jsx(S,{court:x.court_code}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"block truncate font-medium text-foreground",children:x.citation||x.title}),e.jsx("span",{className:"text-xs text-muted-text",children:x.date})]})]},x.case_id))})]}),j&&e.jsx(he,{text:j,citation:s.citation}),e.jsx(K,{open:u,title:t("modals.confirm_delete"),message:t("modals.confirm_delete_message",{name:s.citation||s.title}),confirmLabel:t("common.delete"),variant:"danger",onConfirm:_,onCancel:()=>g(!1)})]})}function h({label:t,value:o,mono:c}){return o?e.jsxs("div",{className:"min-w-0",children:[e.jsx("dt",{className:"text-xs font-medium text-secondary-text",children:t}),e.jsx("dd",{className:I("mt-0.5 break-words text-sm text-foreground",c&&"font-mono text-xs"),children:o})]}):null}export{Te as CaseDetailPage};
