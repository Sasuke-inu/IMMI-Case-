import{j as e}from"./query-DQVcjD57.js";import{r as h,u as _,L as W}from"./vendor-CxW-pF4z.js";import{u as X,a as Z}from"./use-stats-Dfs6nHsj.js";import{S as g}from"./StatCard-Bw2OBtoA.js";import{c as j}from"./tokens-CHeescls.js";import{c as w,u as p,F as O,B as J}from"./index-BpL851_i.js";import{R as u,P as Q,a as ee,C as v,T as b,L as Y,B as A,b as y,X as C,Y as N,d as F,A as te,e as re}from"./charts-CKTqRh7i.js";import{C as M}from"./CourtBadge-BvMcX3Vm.js";import{E as ae}from"./EmptyState-Czet-5pR.js";import{A as se}from"./AnalyticsFilters-Dqjn-nop.js";import{A as E}from"./ApiErrorState-CWDNouH1.js";import{d as P}from"./api-CH3UgZL0.js";import{D as oe}from"./database-BApq4SNV.js";import{D as S}from"./download-NHSBa0lb.js";import{G as ne}from"./git-branch-CQmLGeMg.js";const ce=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],de=w("chart-column",ce);const le=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],ie=w("layers",le);const me=[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]],he=w("table",me),xe={"Administrative Appeals Tribunal":"AATA","Administrative Review Tribunal":"ARTA","Federal Court of Australia":"FCA","Federal Circuit Court of Australia":"FCCA","Federal Circuit and Family Court of Australia (Division 2)":"FedCFamC2G","Federal Circuit and Family Court (Div 2)":"FedCFamC2G","High Court of Australia":"HCA"};function $(r){return xe[r]??(r.length>12?r.slice(0,10)+"…":r)}function ue({data:r,type:d="bar"}){const{t:l}=p(),s=Object.entries(r).map(([a,t])=>({name:a,value:t})).sort((a,t)=>t.value-a.value);if(d==="pie"){const a=s.reduce((t,n)=>t+n.value,0);return e.jsx(u,{width:"100%",height:360,children:e.jsxs(Q,{children:[e.jsx(ee,{data:s,dataKey:"value",nameKey:"name",cx:"50%",cy:"45%",outerRadius:90,label:({name:t,percent:n})=>{const i=((n??0)*100).toFixed(0);return Number(i)>=3?`${$(t??"")} ${i}%`:""},labelLine:!1,fontSize:12,children:s.map(t=>e.jsx(v,{fill:j[t.name]??"#8b8680"},t.name))}),e.jsx(b,{formatter:t=>{const n=Number(t??0);return[`${n.toLocaleString()} (${(n/a*100).toFixed(1)}%)`,l("components.charts.chart_cases")]},contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",fontSize:13}}),e.jsx(Y,{verticalAlign:"bottom",height:36,formatter:t=>$(t),wrapperStyle:{fontSize:11,color:"var(--color-text-secondary)"}})]})})}return e.jsx(u,{width:"100%",height:300,children:e.jsxs(A,{data:s,margin:{top:5,right:20,bottom:5,left:0},children:[e.jsx(y,{strokeDasharray:"3 3",stroke:"var(--color-border)"}),e.jsx(C,{dataKey:"name",tick:{fontSize:12,fill:"var(--color-text-secondary)"}}),e.jsx(N,{tick:{fontSize:12,fill:"var(--color-text-secondary)"}}),e.jsx(b,{contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)",fontSize:13}}),e.jsx(F,{dataKey:"value",radius:[4,4,0,0],children:s.map(a=>e.jsx(v,{fill:j[a.name]??"#8b8680"},a.name))})]})})}const K=h.memo(ue),B=["#1a5276","#117864","#6c3483","#b9770e","#a93226","#1e8449","#922b5f","#b84c00","#1b2631","#2e86c1","#28b463","#d4ac0d","#cb4335","#7d3c98","#148f77","#d68910","#a569bd","#45b39d","#ec7063","#5dade2"];function be({data:r}){const{t:d}=p(),l=_(),s=Object.entries(r).sort(([,a],[,t])=>t-a).slice(0,15).map(([a,t])=>({name:a,value:t}));return s.length===0?null:e.jsx(u,{width:"100%",height:Math.max(250,s.length*28),children:e.jsxs(A,{data:s,layout:"vertical",margin:{top:5,right:30,bottom:5,left:0},onClick:a=>{const t=a?.activePayload;if(t?.[0]){const n=t[0].payload.name;l(`/cases?nature=${encodeURIComponent(n)}`)}},children:[e.jsx(y,{strokeDasharray:"3 3",stroke:"var(--color-border)",horizontal:!1}),e.jsx(C,{type:"number",tick:{fontSize:11,fill:"var(--color-text-secondary)"}}),e.jsx(N,{type:"category",dataKey:"name",width:110,tick:{fontSize:10,fill:"var(--color-text-secondary)"},tickFormatter:a=>a.length>18?a.slice(0,16)+"…":a}),e.jsx(b,{cursor:{fill:"var(--color-background-surface)",opacity:.5},contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)",fontSize:13},formatter:a=>[Number(a??0).toLocaleString(),d("components.charts.chart_cases")]}),e.jsx(F,{dataKey:"value",radius:[0,4,4,0],cursor:"pointer",children:s.map((a,t)=>e.jsx(v,{fill:B[t%B.length]},t))})]})})}const pe=h.memo(be),fe=["AATA","ARTA","FCA","FCCA","FedCFamC2G","MRTA","RRTA","FMCA","HCA"];function ge({data:r}){const{t:d}=p();if(!r||r.length===0)return null;const l=new Set;for(const t of r)for(const n of Object.keys(t))n!=="year"&&l.add(n);const s=fe.filter(t=>l.has(t));for(const t of[...l].sort())s.includes(t)||s.push(t);const a=r.map(t=>{const n={year:t.year};for(const i of s)n[i]=t[i]||0;return n});return e.jsx(u,{width:"100%",height:300,children:e.jsxs(te,{data:a,margin:{top:5,right:20,bottom:5,left:0},children:[e.jsx(y,{strokeDasharray:"3 3",stroke:"var(--color-border)"}),e.jsx(C,{dataKey:"year",tick:{fontSize:11,fill:"var(--color-text-secondary)"},tickFormatter:t=>String(t)}),e.jsx(N,{tick:{fontSize:11,fill:"var(--color-text-secondary)"}}),e.jsx(b,{content:({active:t,payload:n,label:i})=>{if(!t||!n)return null;const o=n.filter(m=>typeof m.value=="number"&&m.value>0);return o.length===0?null:e.jsxs("div",{style:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)",padding:"8px 12px",fontSize:12},children:[e.jsxs("p",{style:{fontWeight:600,marginBottom:4},children:[d("filters.date"),": ",i]}),o.map(m=>e.jsxs("p",{style:{color:m.color,margin:"2px 0"},children:[m.name,": ",Number(m.value).toLocaleString()]},m.dataKey))]})}}),e.jsx(Y,{verticalAlign:"bottom",height:36,wrapperStyle:{fontSize:11,color:"var(--color-text-secondary)"}}),s.map(t=>e.jsx(re,{type:"monotone",dataKey:t,stackId:"1",stroke:j[t]??"#8b8680",fill:j[t]??"#8b8680",fillOpacity:.6},t))]})})}const je=h.memo(ge),I={866:"Protection",500:"Student",457:"Temp Skilled (old)",482:"Temp Skill Shortage",189:"Skilled Independent",190:"Skilled Nominated",820:"Partner (temp)",801:"Partner (perm)",309:"Partner (offshore)",600:"Visitor",143:"Contrib Parent",103:"Parent",785:"Temp Protection",200:"Refugee",417:"Work & Holiday",186:"Employer Nom",491:"Skilled Regional",494:"Employer Regional",300:"Prospective Marriage",444:"NZ Citizen",790:"Safe Haven Enterprise"},U=["#1a5276","#117864","#b9770e","#6c3483","#a93226","#1e8449","#d68910","#922b5f","#2e86c1","#b84c00","#28b463","#d4ac0d","#7d3c98","#148f77","#45b39d"];function ve({data:r}){const{t:d}=p(),l=_(),s=Object.entries(r).sort(([,a],[,t])=>t-a).slice(0,15).map(([a,t])=>({subclass:a,label:I[a]?`${a} (${I[a]})`:a,value:t}));return s.length===0?null:e.jsx(u,{width:"100%",height:Math.max(250,s.length*28),children:e.jsxs(A,{data:s,layout:"vertical",margin:{top:5,right:30,bottom:5,left:0},onClick:a=>{const t=a?.activePayload;if(t?.[0]){const n=t[0].payload.subclass;l(`/cases?keyword=subclass+${encodeURIComponent(n)}`)}},children:[e.jsx(y,{strokeDasharray:"3 3",stroke:"var(--color-border)",horizontal:!1}),e.jsx(C,{type:"number",tick:{fontSize:11,fill:"var(--color-text-secondary)"}}),e.jsx(N,{type:"category",dataKey:"label",width:130,tick:{fontSize:10,fill:"var(--color-text-secondary)"},tickFormatter:a=>a.length>20?a.slice(0,18)+"…":a}),e.jsx(b,{cursor:{fill:"var(--color-background-surface)",opacity:.5},contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)",fontSize:13},formatter:a=>[Number(a??0).toLocaleString(),d("components.charts.chart_cases")],labelFormatter:a=>String(a)}),e.jsx(F,{dataKey:"value",radius:[0,4,4,0],cursor:"pointer",children:s.map((a,t)=>e.jsx(v,{fill:U[t%U.length]},t))})]})})}const ye=h.memo(ve),Ce=new Date().getFullYear();function Pe(){const{t:r}=p(),[d,l]=h.useState(""),[s,a]=h.useState(2e3),[t,n]=h.useState(Ce),i=h.useMemo(()=>({court:d||void 0,yearFrom:s,yearTo:t}),[d,s,t]),{data:o,isLoading:m,isFetching:G,isError:H,error:R,refetch:T}=X(i),{data:V}=Z(i),f=_(),[k,z]=h.useState("chart");if(m&&!o)return e.jsx("div",{className:"flex h-64 items-center justify-center text-muted-text",children:r("common.loading_ellipsis")});if(H&&!o){const c=R instanceof Error?R.message:r("errors.api_request_failed",{name:"Dashboard"});return e.jsx(E,{title:r("errors.failed_to_load",{name:"Dashboard"}),message:c,onRetry:()=>{T()}})}if(!o)return e.jsx(E,{title:r("errors.data_unavailable",{name:"Dashboard"}),message:r("errors.payload_error",{name:"Dashboard"}),onRetry:()=>{T()}});if(o.total_cases===0&&!G)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:r("dashboard.title")}),e.jsx("p",{className:"text-sm text-muted-text",children:r("dashboard.subtitle_empty")})]}),e.jsx(ae,{icon:e.jsx(O,{className:"h-10 w-10"}),title:r("dashboard.welcome_title"),description:r("dashboard.welcome_description"),action:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs("div",{className:"grid gap-2 text-left text-sm text-muted-text",children:[e.jsx("p",{children:e.jsx("strong",{className:"text-foreground",children:r("dashboard.step_1")})}),e.jsx("p",{children:e.jsx("strong",{className:"text-foreground",children:r("dashboard.step_2")})})]}),e.jsx("button",{onClick:()=>f("/pipeline"),className:"mt-2 rounded-md bg-accent px-6 py-2 text-sm font-medium text-white hover:bg-accent-light",children:r("buttons.start_pipeline")})]})})]});const q=Object.entries(o.courts).sort(([,c],[,x])=>x-c),D=Object.keys(o.natures||{}).length,L=V?.trends??[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:r("dashboard.title")}),e.jsx("p",{className:"text-sm text-muted-text",children:r("dashboard.subtitle")})]}),e.jsx(se,{court:d,yearFrom:s,yearTo:t,onCourtChange:l,onYearRangeChange:(c,x)=>{a(c),n(x)}})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(g,{title:r("dashboard.total_cases"),value:o.total_cases,icon:e.jsx(O,{className:"h-5 w-5"})}),e.jsx(g,{title:r("dashboard.with_full_text"),value:o.with_full_text,icon:e.jsx(J,{className:"h-5 w-5"}),description:r("dashboard.coverage",{percentage:(o.with_full_text/o.total_cases*100).toFixed(1)})}),e.jsx(g,{title:r("dashboard.courts_tribunals"),value:Object.keys(o.courts).length,icon:e.jsx(oe,{className:"h-5 w-5"})}),e.jsx(g,{title:r("dashboard.case_categories"),value:D,icon:e.jsx(ie,{className:"h-5 w-5"}),description:D>0?r("dashboard.classified",{count:Object.values(o.natures).reduce((c,x)=>c+x,0)}):void 0})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-base font-semibold",children:r("dashboard.cases_by_court")}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>z("chart"),className:k==="chart"?"rounded p-1 bg-accent-muted text-accent":"rounded p-1 text-muted-text hover:text-foreground",children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>z("table"),className:k==="table"?"rounded p-1 bg-accent-muted text-accent":"rounded p-1 text-muted-text hover:text-foreground",children:e.jsx(he,{className:"h-4 w-4"})})]})]}),k==="chart"?e.jsx(K,{data:o.courts,type:"bar"}):e.jsx("div",{className:"space-y-1.5",children:q.map(([c,x])=>e.jsxs(W,{to:`/cases?court=${c}`,className:"flex items-center justify-between rounded-md px-2 py-1.5 text-sm hover:bg-surface",children:[e.jsx(M,{court:c}),e.jsx("span",{className:"font-mono text-sm text-foreground",children:x.toLocaleString()})]},c))})]}),e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h2",{className:"mb-3 font-heading text-base font-semibold",children:r("dashboard.year_trend")}),L.length>0?e.jsx(je,{data:L}):e.jsx(K,{data:o.years,type:"bar"})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[Object.keys(o.natures||{}).length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h2",{className:"mb-3 font-heading text-base font-semibold",children:r("dashboard.case_categories_dist")}),e.jsx(pe,{data:o.natures})]}),Object.keys(o.visa_subclasses||{}).length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h2",{className:"mb-3 font-heading text-base font-semibold",children:r("dashboard.top_visa_subclasses")}),e.jsx(ye,{data:o.visa_subclasses})]})]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("button",{onClick:()=>f("/download"),className:"flex items-center gap-3 rounded-lg border border-border bg-card p-4 text-left transition-all hover:border-accent hover:shadow-md",children:[e.jsx("div",{className:"rounded-md bg-accent-muted p-2 text-accent",children:e.jsx(S,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:r("nav.download")})]}),e.jsxs("button",{onClick:()=>f("/pipeline"),className:"flex items-center gap-3 rounded-lg border border-border bg-card p-4 text-left transition-all hover:border-accent hover:shadow-md",children:[e.jsx("div",{className:"rounded-md bg-accent-muted p-2 text-accent",children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:r("nav.pipeline")})]}),e.jsxs("button",{onClick:()=>P("csv"),className:"flex items-center gap-3 rounded-lg border border-border bg-card p-4 text-left transition-all hover:border-accent hover:shadow-md",children:[e.jsx("div",{className:"rounded-md bg-accent-muted p-2 text-accent",children:e.jsx(S,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:r("buttons.export_csv")})]}),e.jsxs("button",{onClick:()=>P("json"),className:"flex items-center gap-3 rounded-lg border border-border bg-card p-4 text-left transition-all hover:border-accent hover:shadow-md",children:[e.jsx("div",{className:"rounded-md bg-accent-muted p-2 text-accent",children:e.jsx(S,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:r("buttons.export_json")})]})]}),o.recent_cases&&o.recent_cases.length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h2",{className:"mb-3 font-heading text-base font-semibold",children:r("dashboard.recent_cases")}),e.jsx("div",{className:"space-y-1",children:o.recent_cases.slice(0,5).map(c=>e.jsxs("button",{onClick:()=>f(`/cases/${c.case_id}`),className:"flex w-full items-center gap-3 rounded-md px-3 py-2 text-left text-sm transition-colors hover:bg-surface",children:[e.jsx(M,{court:c.court_code}),e.jsx("span",{className:"flex-1 truncate text-foreground",title:c.title||c.citation,children:c.title||c.citation}),e.jsx("span",{className:"shrink-0 text-xs text-muted-text whitespace-nowrap",children:c.date})]},c.case_id))})]})]})}export{Pe as DashboardPage};
