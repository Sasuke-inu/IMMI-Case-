import{j as e,u as w,b as N}from"./query-DQVcjD57.js";import{u as C,r as j}from"./vendor-CxW-pF4z.js";import{d as g,s as _,f as y}from"./api-BvrL3ogf.js";import{u as F}from"./use-stats-Dk4WtzTR.js";import{a as h,u as A,F as k,B as S,t as f}from"./index-BVFuTJQG.js";import{S as b}from"./StatCard-MBxEbxIo.js";import{D as p}from"./download-DztvrjPX.js";import{C as D,a as P}from"./circle-check-big-BebVITv7.js";import{P as M}from"./play-CmZClNkh.js";import{L as R}from"./loader-circle-D5icnang.js";import"./charts-CKTqRh7i.js";function T({value:i,max:t,size:s=120,strokeWidth:o=8,label:c,className:x}){const m=t>0?Math.min(Math.round(i/t*100),100):0,a=(s-o)/2,l=a*2*Math.PI,r=l-m/100*l,d=s<100;return e.jsxs("div",{className:h("relative inline-flex items-center justify-center",x),style:{width:s,height:s},children:[e.jsxs("svg",{width:s,height:s,className:"-rotate-90",children:[e.jsx("circle",{cx:s/2,cy:s/2,r:a,fill:"none",stroke:"var(--color-border)",strokeWidth:o}),e.jsx("circle",{cx:s/2,cy:s/2,r:a,fill:"none",stroke:"var(--color-accent)",strokeWidth:o,strokeLinecap:"round",strokeDasharray:l,strokeDashoffset:r,className:"transition-all duration-500"})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsxs("span",{className:h("font-bold text-foreground",d?"text-lg":"text-2xl"),children:[m,"%"]}),c&&e.jsx("span",{className:h("text-muted-text",d?"text-[10px] leading-tight":"text-xs"),children:c})]})]})}function U(){const i=C(),{t}=A(),{data:s}=F(),[o,c]=j.useState(""),[x,m]=j.useState("100"),{data:a}=w({queryKey:["job-status"],queryFn:y,refetchInterval:n=>n.state.data?.running?2e3:!1}),l=N({mutationFn:()=>_({databases:o?[o]:["ARTA","FCA","FedCFamC2G","HCA","FCCA"],limit:Number(x)}),onSuccess:()=>{f.success("Download job started"),i("/jobs")},onError:n=>f.error(n.message)}),r=s?.total_cases??0,d=s?.with_full_text??0,u=r-d,v=u===0&&r>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:t("download.title")}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsx(b,{title:t("download.stats_title"),value:r,icon:e.jsx(k,{className:"h-5 w-5"})}),e.jsx(b,{title:t("download.stats_downloaded"),value:d,icon:e.jsx(S,{className:"h-5 w-5"})}),e.jsx(b,{title:t("download.stats_remaining"),value:u,icon:e.jsx(p,{className:"h-5 w-5"}),description:u>0?t("download.need_downloading"):t("download.all_complete")})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsx("div",{className:"flex items-center justify-center rounded-lg border border-border bg-card p-6",children:e.jsx("div",{className:"relative",children:e.jsx(T,{value:d,max:r,size:160,strokeWidth:10,label:"downloaded"})})}),e.jsx("div",{className:"rounded-lg border border-border bg-card p-5",children:v?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(D,{className:"mb-4 h-12 w-12 text-success"}),e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:t("download.all_downloaded")}),e.jsx("p",{className:"mt-2 text-sm text-muted-text",children:t("download.all_cases_full_text",{count:r})}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:()=>i("/cases"),className:"rounded-md bg-accent px-4 py-2 text-sm font-medium text-white hover:bg-accent-light",children:t("buttons.browse_cases")}),e.jsx("button",{onClick:()=>i("/pipeline"),className:"rounded-md border border-border px-4 py-2 text-sm text-foreground hover:bg-surface",children:t("buttons.start_pipeline")})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"mb-3 font-heading text-base font-semibold",children:t("download.download_settings")}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-secondary-text",children:t("download.court_filter_label")}),e.jsxs("select",{value:o,onChange:n=>c(n.target.value),className:"w-full rounded-md border border-border bg-surface px-3 py-2 text-sm text-foreground",children:[e.jsx("option",{value:"",children:t("download.all_courts_label")}),e.jsx("option",{value:"ARTA",children:"ARTA"}),e.jsx("option",{value:"FCA",children:"FCA"}),e.jsx("option",{value:"FCCA",children:"FCCA"}),e.jsx("option",{value:"FedCFamC2G",children:"FedCFamC2G"}),e.jsx("option",{value:"HCA",children:"HCA"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-secondary-text",children:t("download.batch_size_label")}),e.jsxs("select",{value:x,onChange:n=>m(n.target.value),className:"w-full rounded-md border border-border bg-surface px-3 py-2 text-sm text-foreground",children:[e.jsx("option",{value:"50",children:"50"}),e.jsx("option",{value:"100",children:"100"}),e.jsx("option",{value:"250",children:"250"}),e.jsx("option",{value:"500",children:"500"}),e.jsx("option",{value:"1000",children:"1,000"})]})]})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>l.mutate(),disabled:a?.running||l.isPending,className:"flex items-center gap-1 rounded-md bg-accent px-4 py-2 text-sm font-medium text-white hover:bg-accent-light disabled:opacity-50",children:[e.jsx(M,{className:"h-4 w-4"}),a?.running?t("download.running_status"):t("download.start_download")]}),a?.running&&e.jsxs("span",{className:"flex items-center gap-2 text-sm text-muted-text",children:[e.jsx(R,{className:"h-4 w-4 animate-spin"})," ",a.message]})]}),e.jsxs("div",{className:"mt-4 flex items-start gap-2 rounded-md bg-info/5 p-3 text-xs text-info",children:[e.jsx(P,{className:"mt-0.5 h-3.5 w-3.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{children:t("download.rate_limit_info")}),e.jsx("p",{className:"mt-1",children:t("download.extraction_info")})]})]})]})})]}),e.jsxs("div",{className:"rounded-lg border border-border bg-card p-5",children:[e.jsx("h2",{className:"mb-2 font-heading text-base font-semibold",children:t("download.export_data_title")}),e.jsx("p",{className:"mb-4 text-sm text-muted-text",children:t("download.export_data_subtitle")}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>g("csv"),className:"flex items-center gap-1 rounded-md border border-border px-4 py-2 text-sm font-medium text-foreground hover:bg-surface",children:[e.jsx(p,{className:"h-4 w-4"})," ",t("buttons.export_csv")]}),e.jsxs("button",{onClick:()=>g("json"),className:"flex items-center gap-1 rounded-md border border-border px-4 py-2 text-sm font-medium text-foreground hover:bg-surface",children:[e.jsx(p,{className:"h-4 w-4"})," ",t("buttons.export_json")]})]})]})]})}export{U as DownloadPage};
