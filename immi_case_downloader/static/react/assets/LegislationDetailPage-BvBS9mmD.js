import{j as e}from"./query-DQVcjD57.js";import{d as T}from"./use-legislations-BxD-4iAp.js";import{B as I}from"./Breadcrumb-CG-MlZgK.js";import{r as c,j as B,u as O}from"./vendor-CxW-pF4z.js";import{c as P,S as _,X as V,a as v,u as D,B as U}from"./index-D-73LkCS.js";import{C as K,a as z}from"./chevron-up-JprKysvF.js";import{M as $,a as F}from"./minimize-2-CmNPCPCV.js";import{C as G}from"./chevron-right-Begj5eiQ.js";import{E as H}from"./external-link-H5c3xW7b.js";import"./api-aTUBEVUX.js";import"./charts-CKTqRh7i.js";const Z=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],A=P("arrow-left",Z),y=/^\s*\((\d+[A-Z]?)\)\s/,k=/^\s*\(([a-z]{1,2})\)\s/,L=/^\s*\((i{1,3}|iv|v{1,3}|vi{1,3}|ix|x{1,2})\)\s/i,J=/^\s*Note\s*\d*\s*:/i,X=/^\s*Penalty\s*:/i,q=/^\s*Example\s*\d*\s*:/i,W=/^[A-Z][A-Z\s\d—–-]{4,80}$/;function Y(t){return t.trim()?J.test(t)?"note":X.test(t)?"penalty":q.test(t)?"example":L.test(t)?"subpara":k.test(t)?"paragraph":y.test(t)?"subsection":W.test(t.trim())?"heading":"body":"blank"}function Q(t,s,a){switch(s){case"blank":return e.jsx("div",{className:"h-1.5"},a);case"heading":return e.jsx("p",{className:"mt-4 mb-1 text-xs font-bold uppercase tracking-widest text-accent/80",children:t.trim()},a);case"subsection":return e.jsx("p",{className:"mt-2 font-mono text-xs leading-relaxed text-foreground whitespace-pre-wrap",children:t.replace(y,()=>"").trimStart()?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-1.5 font-bold text-accent",children:t.match(y)?.[0].trim()}),t.replace(y,"").trimStart()]}):t},a);case"paragraph":return e.jsxs("p",{className:"ml-6 font-mono text-xs leading-relaxed text-foreground whitespace-pre-wrap",children:[e.jsx("span",{className:"mr-1 font-semibold text-secondary-text",children:t.match(k)?.[0].trim()}),t.replace(k,"").trimStart()]},a);case"subpara":return e.jsxs("p",{className:"ml-12 font-mono text-xs leading-relaxed text-secondary-text whitespace-pre-wrap",children:[e.jsx("span",{className:"mr-1 text-muted-text",children:t.match(L)?.[0].trim()}),t.replace(L,"").trimStart()]},a);case"note":return e.jsx("div",{className:"my-1.5 ml-4 rounded-r border-l-2 border-info/40 bg-info/5 px-3 py-1.5 font-mono text-xs text-secondary-text whitespace-pre-wrap",children:t},a);case"penalty":return e.jsx("div",{className:"my-1.5 ml-4 rounded-r border-l-2 border-warning/50 bg-warning/5 px-3 py-1.5 font-mono text-xs font-semibold text-warning whitespace-pre-wrap",children:t},a);case"example":return e.jsx("div",{className:"my-1.5 ml-4 rounded-r border-l-2 border-success/40 bg-success/5 px-3 py-1.5 font-mono text-xs text-secondary-text whitespace-pre-wrap",children:t},a);default:return e.jsx("p",{className:"font-mono text-xs leading-relaxed text-foreground whitespace-pre-wrap",children:t},a)}}function ee(t){return t.split(`
`).map((s,a)=>Q(s,Y(s),a))}function te(t,s,a,i){if(!s||s.length<2)return e.jsx("pre",{className:"whitespace-pre-wrap font-mono text-xs leading-relaxed text-foreground",children:t});const d=t.toLowerCase(),x=s.toLowerCase(),r=[];let o=0,m=0,u=d.indexOf(x);for(;u!==-1;){u>o&&r.push(t.slice(o,u));const h=i+m;r.push(e.jsx("mark",{className:h===a?"active-match rounded-sm bg-warning px-0.5 text-foreground":"rounded-sm bg-warning/30 px-0.5",children:t.slice(u,u+s.length)},`m-${u}`)),o=u+s.length,m++,u=d.indexOf(x,o)}return o<t.length&&r.push(t.slice(o)),e.jsx("pre",{className:"whitespace-pre-wrap font-mono text-xs leading-relaxed text-foreground",children:r})}function se(t){const s=[],a=new Map;for(const i of t){const d=i.part||"General Provisions",x=i.division||"";if(!a.has(d)){const o={part:d,divisions:new Map};a.set(d,o),s.push(o)}const r=a.get(d);r.divisions.has(x)||r.divisions.set(x,[]),r.divisions.get(x).push(i)}return s}function re({sections:t,activeId:s,onJump:a,expanded:i}){const d=c.useMemo(()=>se(t),[t]),[x,r]=c.useState(new Set),o=c.useCallback(m=>{r(u=>{const h=new Set(u);return h.has(m)?h.delete(m):h.add(m),h})},[]);return e.jsxs("nav",{className:v("overflow-y-auto border-r border-border bg-card",i?"max-h-none":"max-h-[680px]"),children:[e.jsx("p",{className:"sticky top-0 z-10 bg-card px-3 pt-3 pb-1.5 text-[10px] font-semibold uppercase tracking-wider text-muted-text",children:"Contents"}),e.jsx("div",{className:"pb-3",children:d.map(({part:m,divisions:u})=>{const h=x.has(m);return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>o(m),className:"flex w-full items-start gap-1 px-3 py-1.5 text-left hover:bg-surface",children:[e.jsx(G,{className:v("mt-0.5 h-3 w-3 shrink-0 text-muted-text transition-transform",!h&&"rotate-90")}),e.jsx("span",{className:"text-[11px] font-semibold leading-tight text-secondary-text",children:m})]}),!h&&Array.from(u.entries()).map(([b,N])=>e.jsxs("div",{children:[b&&e.jsx("p",{className:"ml-5 px-2 py-1 text-[10px] font-medium italic text-muted-text",children:b}),N.map(f=>{const p=s===f.id;return e.jsxs("button",{onClick:()=>a(f.id),className:v("w-full border-l-2 py-0.5 pr-2 pl-6 text-left text-[11px] leading-snug transition-colors",p?"border-accent bg-accent/5 font-medium text-accent":"border-transparent text-muted-text hover:bg-surface hover:text-foreground"),children:[e.jsx("span",{className:"font-mono text-[10px]",children:f.number}),f.title&&e.jsx("span",{className:"ml-1 opacity-80",children:f.title})]},f.id)})]},b||"__nodiv"))]},m)})})]})}function ae({section:t,searchTerm:s,activeMatchIdx:a,matchOffsetBefore:i,searching:d}){return e.jsxs("div",{id:t.id,className:"scroll-mt-4 rounded-lg border border-border bg-card",children:[e.jsxs("div",{className:"flex items-baseline gap-2 border-b border-border px-4 py-2.5",children:[e.jsx("span",{className:"font-mono text-sm font-bold text-accent",children:t.number}),t.title&&e.jsx("span",{className:"font-heading text-sm font-semibold text-foreground",children:t.title}),t.part&&e.jsx("span",{className:"ml-auto shrink-0 rounded bg-surface px-1.5 py-0.5 text-[10px] text-muted-text",children:t.part.length>30?`${t.part.slice(0,30)}…`:t.part})]}),e.jsx("div",{className:"px-4 py-3",children:d&&s.length>=2?te(t.text,s,a,i):ee(t.text)})]})}function ne({sections:t}){const[s,a]=c.useState(""),[i,d]=c.useState(0),[x,r]=c.useState(!1),[o,m]=c.useState(!1),[u,h]=c.useState(t[0]?.id??null),b=c.useRef(null),N=c.useRef(null),f=c.useMemo(()=>{if(!s||s.length<2)return t.map(()=>0);const n=s.toLowerCase();return t.map(l=>{const g=l.text.toLowerCase();let w=0,C=g.indexOf(n);for(;C!==-1;)w++,C=g.indexOf(n,C+1);return w})},[s,t]),p=c.useMemo(()=>f.reduce((n,l)=>n+l,0),[f]),M=c.useMemo(()=>{const n=[];let l=0;for(const g of f)n.push(l),l+=g;return n},[f]);c.useEffect(()=>{d(0)},[p]),c.useEffect(()=>{if(p===0)return;b.current?.querySelector(".active-match")?.scrollIntoView({block:"center",behavior:"smooth"})},[i,p]),c.useEffect(()=>{if(t.length===0)return;const n=new IntersectionObserver(l=>{const g=l.filter(w=>w.isIntersecting);g.length>0&&h(g[0].target.id)},{root:b.current,rootMargin:"0px 0px -70% 0px",threshold:0});return t.forEach(l=>{const g=document.getElementById(l.id);g&&n.observe(g)}),()=>n.disconnect()},[t,o]),c.useEffect(()=>{const n=l=>{(l.metaKey||l.ctrlKey)&&l.key==="f"&&(l.preventDefault(),r(!0),setTimeout(()=>N.current?.focus(),50)),l.key==="Escape"&&x&&(r(!1),a(""))};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[x]);const S=c.useCallback(n=>{p!==0&&d(l=>(l+n+p)%p)},[p]),R=c.useCallback(n=>{document.getElementById(n)?.scrollIntoView({behavior:"smooth",block:"start"}),h(n)},[]),E=x&&s.length>=2;return e.jsxs("div",{className:"overflow-hidden rounded-lg border border-border bg-card",children:[e.jsxs("div",{className:"flex items-center gap-2 border-b border-border px-4 py-2",children:[e.jsx("h2",{className:"font-heading text-base font-semibold text-foreground",children:"Sections"}),e.jsx("span",{className:"ml-1 rounded-full bg-surface px-2 py-0.5 text-xs text-muted-text",children:t.length}),e.jsxs("div",{className:"ml-auto flex items-center gap-1.5",children:[x?e.jsxs("div",{className:"flex items-center gap-1 rounded-md border border-border bg-surface px-2 py-1",children:[e.jsx(_,{className:"h-3.5 w-3.5 text-muted-text"}),e.jsx("input",{ref:N,type:"text",value:s,onChange:n=>a(n.target.value),onKeyDown:n=>{n.key==="Enter"&&S(n.shiftKey?-1:1)},placeholder:"Search sections…",className:"w-44 bg-transparent text-sm text-foreground outline-none placeholder:text-muted-text"}),E&&p>0&&e.jsxs("span",{className:"whitespace-nowrap text-xs text-muted-text",children:[i+1,"/",p]}),E&&p===0&&s.length>=2&&e.jsx("span",{className:"whitespace-nowrap text-xs text-danger",children:"No results"}),e.jsx("button",{onClick:()=>S(-1),className:"p-0.5 text-muted-text hover:text-foreground",children:e.jsx(K,{className:"h-3.5 w-3.5"})}),e.jsx("button",{onClick:()=>S(1),className:"p-0.5 text-muted-text hover:text-foreground",children:e.jsx(z,{className:"h-3.5 w-3.5"})}),e.jsx("button",{onClick:()=>{r(!1),a("")},className:"p-0.5 text-muted-text hover:text-foreground",children:e.jsx(V,{className:"h-3.5 w-3.5"})})]}):e.jsx("button",{onClick:()=>{r(!0),setTimeout(()=>N.current?.focus(),50)},className:"rounded-md p-1.5 text-muted-text hover:bg-surface hover:text-foreground",title:"Search sections (⌘F)",children:e.jsx(_,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>m(!o),className:"rounded-md p-1.5 text-muted-text hover:bg-surface hover:text-foreground",title:o?"Collapse":"Expand",children:o?e.jsx($,{className:"h-4 w-4"}):e.jsx(F,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-56 flex-shrink-0",children:e.jsx(re,{sections:t,activeId:u,onJump:R,expanded:o})}),e.jsx("div",{ref:b,className:v("flex-1 overflow-auto border-l border-border",o?"max-h-none":"max-h-[680px]"),children:e.jsx("div",{className:"space-y-3 p-4",children:t.map((n,l)=>e.jsx(ae,{section:n,searchTerm:s,activeMatchIdx:i,matchOffsetBefore:M[l]??0,searching:E},n.id))})})]})]})}const oe="https://www.austlii.edu.au/au/legis/cth";function j({label:t,value:s,mono:a}){return!s&&s!==0?null:e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-medium text-secondary-text",children:t}),e.jsx("dd",{className:v("mt-0.5 text-sm text-foreground",a&&"font-mono text-xs"),children:s})]})}function le({onUpdate:t}){return e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-dashed border-border bg-card p-12 text-center",children:[e.jsx(U,{className:"mb-3 h-10 w-10 text-muted-text"}),e.jsx("h3",{className:"font-heading text-base font-semibold text-foreground",children:"Full text not yet downloaded"}),e.jsx("p",{className:"mt-1 text-sm text-secondary-text",children:'Click "Update Laws" on the legislations list to download section text from AustLII.'}),e.jsx("button",{onClick:t,className:"mt-4 rounded-md bg-accent px-4 py-2 text-sm font-medium text-accent-foreground hover:bg-accent/90",children:"Go to Legislations"})]})}function je(){const{t}=D(),{id:s}=B(),a=O(),{data:i,isLoading:d,error:x}=T(s??null);if(x)return e.jsxs("div",{className:"space-y-4",children:[e.jsx(I,{items:[{label:t("common.dashboard"),href:"/"},{label:t("legislations.title",{defaultValue:"Legislations"}),href:"/legislations"},{label:t("common.not_found")}]}),e.jsxs("div",{className:"flex h-64 flex-col items-center justify-center rounded-lg border border-danger/30 bg-danger/5 p-8 text-center",children:[e.jsx("h2",{className:"font-heading text-lg font-semibold text-foreground",children:t("common.not_found")}),e.jsx("p",{className:"mt-2 text-sm text-secondary-text",children:t("legislations.not_found_description",{defaultValue:"This legislation could not be found"})}),e.jsxs("button",{onClick:()=>a("/legislations"),className:"mt-4 flex items-center gap-2 rounded-md bg-accent px-3 py-2 text-sm font-medium text-accent-foreground hover:bg-accent/90",children:[e.jsx(A,{className:"h-4 w-4"}),t("common.back")]})]})]});if(d||!i)return e.jsx("div",{className:"flex h-64 items-center justify-center text-muted-text",children:t("common.loading_ellipsis")});const r=i.data,o=r.sections??[],m=`${oe}/${r.austlii_id}/`;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(I,{items:[{label:t("common.dashboard"),href:"/"},{label:t("legislations.title",{defaultValue:"Legislations"}),href:"/legislations"},{label:r.title}]}),e.jsxs("button",{onClick:()=>a("/legislations"),className:"flex items-center gap-2 rounded-md border border-border px-3 py-1.5 text-sm text-foreground hover:bg-surface",children:[e.jsx(A,{className:"h-3.5 w-3.5"}),t("common.back")]})]}),e.jsx("div",{className:"rounded-lg border border-border bg-card p-5",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"font-heading text-2xl font-semibold text-foreground",children:r.title}),r.description&&e.jsx("p",{className:"mt-2 text-sm leading-relaxed text-secondary-text",children:r.description})]}),r.shortcode&&e.jsx("div",{className:"shrink-0 rounded-md bg-accent/10 px-3 py-1.5 text-sm font-medium text-accent",children:r.shortcode})]})}),e.jsxs("div",{className:"rounded-lg border border-border bg-card p-5",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-base font-semibold text-foreground",children:t("legislations.information",{defaultValue:"Legislation Information"})}),e.jsxs("a",{href:m,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-xs text-accent hover:underline",children:[e.jsx(H,{className:"h-3 w-3"}),"AustLII"]})]}),e.jsxs("dl",{className:"grid gap-x-6 gap-y-2.5 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsx(j,{label:"Shortcode",value:r.shortcode,mono:!0}),e.jsx(j,{label:"AustLII ID",value:r.austlii_id,mono:!0}),e.jsx(j,{label:"Jurisdiction",value:r.jurisdiction}),e.jsx(j,{label:"Type",value:r.type}),e.jsx(j,{label:t("legislations.sections",{defaultValue:"Sections"}),value:r.sections_count||void 0}),e.jsx(j,{label:t("legislations.last_amended",{defaultValue:"Last Amended"}),value:r.last_amended||void 0}),e.jsx(j,{label:t("legislations.last_scraped",{defaultValue:"Last Scraped"}),value:r.last_scraped?new Date(r.last_scraped).toLocaleDateString("en-AU"):void 0})]})]}),o.length===0?e.jsx(le,{onUpdate:()=>a("/legislations")}):e.jsx(ne,{sections:o})]})}export{je as LegislationDetailPage};
