import{j as e,u as w,k as _}from"./query-DQVcjD57.js";import{r as l,L as ne}from"./vendor-CxW-pF4z.js";import{A as oe}from"./AnalyticsFilters-TsKZXcH7.js";import{c as A,u as f,a as E,X as ce}from"./index-u9YqJcT_.js";import{R as ie}from"./rotate-ccw-DwtRmGxC.js";import{S as le}from"./save-VwlzQ6bD.js";import{a as Y}from"./use-cases-iqu99bo2.js";import{h as de,i as xe,j as me,k as ue,l as he,m as fe,n as pe,o as ye,q as ge,r as be}from"./api-CH3UgZL0.js";import{R as k,B as F,X as C,Y as v,T as N,d as $,C as D,f as q,g as G,b as K,L as I,h as W,A as je,e as V,S as ve,i as Ne,j as ke,k as Ce,l as Se}from"./charts-CKTqRh7i.js";const we=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],_e=A("arrow-down-right",we);const Le=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],Oe=A("arrow-up-right",Le);const $e=[["path",{d:"M17 3a2 2 0 0 1 2 2v15a1 1 0 0 1-1.496.868l-4.512-2.578a2 2 0 0 0-1.984 0l-4.512 2.578A1 1 0 0 1 5 20V5a2 2 0 0 1 2-2z",key:"oz39mx"}]],Fe=A("bookmark",$e);const ze=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Re=A("circle-question-mark",ze);const Me=[["path",{d:"M6 18h8",key:"1borvv"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M14 22a7 7 0 1 0 0-14h-1",key:"1jwaiy"}],["path",{d:"M9 14h2",key:"197e7h"}],["path",{d:"M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2Z",key:"1bmzmy"}],["path",{d:"M12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3",key:"1drr47"}]],Te=A("microscope",Me),H="analytics-filter-presets";function Ee(){try{const t=localStorage.getItem(H);return t?JSON.parse(t):[]}catch{return[]}}function Ae(t){localStorage.setItem(H,JSON.stringify(t))}function B(t,a){return t.includes(a)?t.filter(n=>n!==a):[...t,a]}function De({caseNatures:t,visaSubclasses:a,outcomeTypes:n,selectedNatures:s,selectedSubclasses:o,selectedOutcomes:r,onNaturesChange:c,onSubclassesChange:i,onOutcomesChange:x}){const{t:u}=f(),[p,y]=l.useState(""),[S,g]=l.useState(Ee),h=s.length+o.length+r.length,M=()=>{c([]),i([]),x([])},z=()=>{if(!p.trim())return;const m={name:p.trim(),natures:s,subclasses:o,outcomes:r},d=[...S.filter(j=>j.name!==m.name),m];Ae(d),g(d),y("")},T=m=>{c(m.natures),i(m.subclasses),x(m.outcomes)};return e.jsxs("div",{className:"rounded-lg border border-border bg-card p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:u("analytics.advanced_filters",{defaultValue:"Advanced Filters"})}),h>0&&e.jsx("span",{"data-testid":"active-filter-count",className:"inline-flex h-5 min-w-5 items-center justify-center rounded-full bg-accent px-1.5 text-[10px] font-bold text-white",children:h})]}),h>0&&e.jsxs("button",{type:"button",onClick:M,"aria-label":"Clear all filters",className:"inline-flex items-center gap-1 text-xs text-muted-text hover:text-foreground",children:[e.jsx(ie,{className:"h-3 w-3"}),u("common.clear",{defaultValue:"Clear"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1.5 text-xs font-medium text-muted-text",children:"Case Nature"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.map(m=>{const d=s.includes(m);return e.jsx("button",{type:"button",onClick:()=>c(B(s,m)),className:E("rounded-full px-2.5 py-1 text-xs font-medium transition-colors",d?"bg-accent text-white":"bg-surface text-secondary-text hover:bg-accent-muted hover:text-accent"),children:m},m)})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1.5 text-xs font-medium text-muted-text",children:"Visa Subclass"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:a.map(m=>{const d=o.includes(m);return e.jsx("button",{type:"button",onClick:()=>i(B(o,m)),className:E("rounded-full px-2.5 py-1 text-xs font-medium transition-colors",d?"bg-accent text-white":"bg-surface text-secondary-text hover:bg-accent-muted hover:text-accent"),children:m},m)})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1.5 text-xs font-medium text-muted-text",children:"Outcome"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:n.map(m=>{const d=r.includes(m);return e.jsx("button",{type:"button",onClick:()=>x(B(r,m)),className:E("rounded-full px-2.5 py-1 text-xs font-medium transition-colors",d?"bg-accent text-white":"bg-surface text-secondary-text hover:bg-accent-muted hover:text-accent"),children:m},m)})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 border-t border-border pt-2",children:[S.map(m=>e.jsxs("button",{type:"button",onClick:()=>T(m),className:"inline-flex items-center gap-1 rounded-md border border-border px-2 py-1 text-xs text-secondary-text hover:bg-surface hover:text-foreground",children:[e.jsx(Fe,{className:"h-3 w-3"}),m.name]},m.name)),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"text",value:p,onChange:m=>y(m.target.value),placeholder:u("analytics.preset_name_placeholder",{defaultValue:"Preset name..."}),className:"w-28 rounded-md border border-border bg-background px-2 py-1 text-xs text-foreground placeholder:text-muted-text",onKeyDown:m=>{m.key==="Enter"&&z()}}),e.jsxs("button",{type:"button",onClick:z,"aria-label":"Save preset",disabled:!p.trim(),className:"inline-flex items-center gap-1 rounded-md border border-border px-2 py-1 text-xs text-secondary-text hover:bg-surface hover:text-foreground disabled:opacity-40",children:[e.jsx(le,{className:"h-3 w-3"}),u("common.save",{defaultValue:"Save"})]})]})]})]})}const L=t=>[t?.court,t?.yearFrom,t?.yearTo,t?.caseNatures?.join(","),t?.visaSubclasses?.join(","),t?.outcomeTypes?.join(",")];function J(t){return w({queryKey:["analytics","outcomes",...L(t)],queryFn:()=>de(t),staleTime:5*6e4,placeholderData:_})}function Ke(t,a=20){return w({queryKey:["analytics","judges",a,...L(t)],queryFn:()=>xe(t,a),staleTime:5*6e4,placeholderData:_})}function U(t,a=20){return w({queryKey:["analytics","concepts",a,...L(t)],queryFn:()=>me(t,a),staleTime:5*6e4,placeholderData:_})}function X(t){return w({queryKey:["analytics","nature-outcome",...L(t)],queryFn:()=>ue(t),staleTime:5*6e4,placeholderData:_})}function Ie(t){return w({queryKey:["analytics","success-rate",...L(t),t.visa_subclass,t.case_nature,...t.legal_concepts??[]],queryFn:()=>he(t),staleTime:5*6e4,placeholderData:_})}function Q(t){return w({queryKey:["analytics","concept-effectiveness",...L(t),t?.limit??30],queryFn:()=>fe(t),staleTime:5*6e4,placeholderData:_})}function Be(t){return w({queryKey:["analytics","concept-cooccurrence",...L(t),t?.limit??15,t?.min_count??50],queryFn:()=>pe(t),staleTime:5*6e4,placeholderData:_})}function Z(t){return w({queryKey:["analytics","concept-trends",...L(t),t?.limit??10],queryFn:()=>ye(t),staleTime:5*6e4,placeholderData:_})}function We(t){return w({queryKey:["analytics","flow-matrix",...L(t),t?.top_n??8],queryFn:()=>ge(t),staleTime:5*6e4,placeholderData:_})}function qe(t){return w({queryKey:["analytics","monthly-trends",...L(t)],queryFn:()=>be(t),staleTime:5*6e4,placeholderData:_})}function Ve({winCount:t,lossCount:a}){const n=[{name:"Cases",win:t,loss:a}];return e.jsx(k,{width:"100%",height:72,children:e.jsxs(F,{data:n,layout:"vertical",margin:{top:6,right:8,left:0,bottom:0},children:[e.jsx(C,{type:"number",hide:!0}),e.jsx(v,{type:"category",dataKey:"name",hide:!0}),e.jsx(N,{formatter:(s,o)=>[Number(s??0).toLocaleString(),o==="win"?"Wins":"Losses"],contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)"}}),e.jsxs($,{dataKey:"win",stackId:"total",radius:[4,0,0,4],children:[e.jsx(D,{fill:"#1f8a4d"}),e.jsx(q,{dataKey:"win",position:"insideLeft",fill:"#ffffff",fontSize:11})]}),e.jsxs($,{dataKey:"loss",stackId:"total",radius:[0,4,4,0],children:[e.jsx(D,{fill:"#b64040"}),e.jsx(q,{dataKey:"loss",position:"insideRight",fill:"#ffffff",fontSize:11})]})]})})}const Pe=l.memo(Ve);function Ye(t){return t>=1.2?"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-200":t>=1?"bg-sky-100 text-sky-800 dark:bg-sky-900/40 dark:text-sky-200":"bg-rose-100 text-rose-800 dark:bg-rose-900/40 dark:text-rose-200"}function Ge({combos:t}){const{t:a}=f();return t.length?e.jsx("div",{className:"overflow-x-auto -mx-1 px-1",children:e.jsxs("table",{className:"w-full min-w-[420px] text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border text-left text-xs uppercase tracking-wide text-muted-text",children:[e.jsx("th",{className:"py-2 pr-2",children:a("analytics.concepts_col")}),e.jsx("th",{className:"py-2 pr-2",children:a("analytics.cases_col")}),e.jsx("th",{className:"py-2 pr-2",children:a("analytics.win_rate")}),e.jsx("th",{className:"py-2",children:a("analytics.lift")})]})}),e.jsx("tbody",{children:t.slice(0,8).map(n=>e.jsxs("tr",{className:"border-b border-border-light/60",children:[e.jsx("td",{className:"py-2 pr-2 text-foreground",children:n.concepts.join(" + ")}),e.jsx("td",{className:"py-2 pr-2 text-secondary-text",children:n.count.toLocaleString()}),e.jsxs("td",{className:"py-2 pr-2 text-secondary-text",children:[n.win_rate.toFixed(1),"%"]}),e.jsx("td",{className:"py-2",children:e.jsxs("span",{className:`rounded-full px-2 py-0.5 text-xs font-semibold ${Ye(n.lift)}`,children:[n.lift.toFixed(2),"x"]})})]},n.concepts.join("|")))})]})}):e.jsx("p",{className:"text-sm text-muted-text",children:a("analytics.no_cooccurrence_data")})}const He=l.memo(Ge);function ee({totalMatching:t}){const{t:a}=f(),s=(o=>o>=100?{level:"high",label:a("analytics.confidence_high"),bgColor:"bg-green-100",textColor:"text-green-800",borderColor:"border-green-200"}:o>=50?{level:"medium",label:a("analytics.confidence_medium"),bgColor:"bg-yellow-100",textColor:"text-yellow-800",borderColor:"border-yellow-200"}:{level:"low",label:a("analytics.confidence_low"),bgColor:"bg-red-100",textColor:"text-red-800",borderColor:"border-red-200"})(t);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{"data-testid":`confidence-badge-${s.level}`,className:E("flex items-center gap-1.5 rounded-md border px-2.5 py-1 text-xs font-medium",s.bgColor,s.textColor,s.borderColor),children:[e.jsxs("span",{children:["N=",t]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:s.label})]}),e.jsx("button",{"aria-label":a("analytics.confidence_tooltip_label"),className:"text-muted-text hover:text-foreground transition-colors",title:a("analytics.confidence_tooltip"),children:e.jsx(Re,{className:"h-4 w-4"})})]})}function Je({data:t}){const{natures:a,outcomes:n,matrix:s}=t;let o=1;for(const c of a)for(const i of n){const x=s[c]?.[i]??0;x>o&&(o=x)}const r=(c,i)=>c.length>i?c.slice(0,i-1)+"…":c;return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"grid gap-px text-xs",style:{gridTemplateColumns:`160px repeat(${n.length}, minmax(70px, 1fr))`},children:[e.jsx("div",{className:"p-1.5 font-medium text-muted-text"}),n.map(c=>e.jsx("div",{className:"p-1.5 text-center text-[10px] font-semibold text-secondary-text",title:c,children:c},c)),a.map(c=>e.jsxs(l.Fragment,{children:[e.jsx("div",{className:"truncate p-1.5 text-[11px] font-medium text-foreground",title:c,children:r(c,25)}),n.map(i=>{const x=s[c]?.[i]??0,u=x/o;return e.jsx("div",{className:"flex items-center justify-center rounded-sm p-1.5 text-[10px]",style:{backgroundColor:x===0?"var(--color-surface)":`rgba(26, 82, 118, ${Math.max(u*.85,.1)})`,color:x===0?"var(--color-text-muted)":u>.3?"#fff":"var(--color-text-secondary)"},title:`${c} → ${i}: ${x.toLocaleString()}`,children:x>0?x.toLocaleString():"–"},`${c}-${i}`)})]},c))]})})}const te=l.memo(Je);function Ue({data:t}){const{t:a}=f(),n=t.concepts.slice(0,12).map(s=>({name:s.name,liftDelta:Number((s.lift-1).toFixed(2)),winRate:s.win_rate,total:s.total}));return n.length?e.jsx(k,{width:"100%",height:Math.max(n.length*32,260),children:e.jsxs(F,{data:n,layout:"vertical",margin:{top:0,right:10,left:10,bottom:0},children:[e.jsx(C,{type:"number",tick:{fontSize:11,fill:"var(--color-text-secondary)"},tickFormatter:s=>`${s>0?"+":""}${s.toFixed(2)}`}),e.jsx(v,{type:"category",dataKey:"name",width:140,tick:{fontSize:11,fill:"var(--color-text-secondary)"},axisLine:!1,tickLine:!1}),e.jsx(N,{formatter:(s,o)=>{const r=Number(s??0);return o==="liftDelta"?[r.toFixed(2),a("analytics.lift_delta")]:[String(s??0),"Value"]},labelFormatter:s=>String(s),contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)"}}),e.jsx($,{dataKey:"liftDelta",radius:[3,3,3,3],children:n.map(s=>e.jsx(D,{fill:s.liftDelta>=0?"#1f8a4d":"#b64040"},s.name))})]})}):e.jsx("p",{className:"text-sm text-muted-text",children:a("analytics.no_effectiveness_data")})}const ae=l.memo(Ue),P=["#1a5276","#2d7d46","#6c3483","#b9770e","#a83232","#117864"];function Xe({data:t}){const{t:a}=f(),n=Object.keys(t.series).slice(0,6),s=new Set;n.forEach(r=>{t.series[r].forEach(c=>s.add(c.year))});const o=Array.from(s).sort((r,c)=>r-c).map(r=>{const c={year:r};return n.forEach(i=>{const x=t.series[i].find(u=>u.year===r);c[i]=x?.win_rate??0}),c});return o.length?e.jsx(k,{width:"100%",height:280,children:e.jsxs(G,{data:o,margin:{top:5,right:10,left:-20,bottom:10},children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"var(--color-border)",opacity:.35}),e.jsx(C,{dataKey:"year",tick:{fontSize:11,fill:"var(--color-text-secondary)"}}),e.jsx(v,{domain:[0,100],tick:{fontSize:11,fill:"var(--color-text-secondary)"},tickFormatter:r=>`${r}%`}),e.jsx(N,{formatter:r=>[`${Number(r??0).toFixed(1)}%`,a("analytics.win_rate")],contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)"}}),e.jsx(I,{wrapperStyle:{fontSize:11}}),n.map((r,c)=>e.jsx(W,{type:"monotone",dataKey:r,stroke:P[c%P.length],dot:{r:2},strokeWidth:2},r))]})}):e.jsx("p",{className:"text-sm text-muted-text",children:a("analytics.no_trend_data")})}const se=l.memo(Xe);function Qe({open:t,onClose:a,filters:n,currentRate:s,totalMatching:o}){const{t:r}=f(),{data:c,isLoading:i}=X(n),{data:x,isLoading:u}=Q({...n,limit:15}),{data:p,isLoading:y}=Z({...n,limit:8});if(l.useEffect(()=>{if(!t)return;const g=h=>{h.key==="Escape"&&a()};return document.addEventListener("keydown",g),()=>document.removeEventListener("keydown",g)},[t,a]),!t)return null;const S=o.toLocaleString();return e.jsx("div",{"data-testid":"deep-modal-overlay",className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",onClick:a,children:e.jsxs("div",{className:"relative z-10 mx-4 max-h-[90vh] w-full max-w-4xl overflow-y-auto rounded-lg border border-border bg-card p-6 shadow-xl",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"mb-6 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-foreground",children:r("analytics.deep_analysis_title",{defaultValue:"Success Rate Deep Analysis"})}),e.jsxs("div",{className:"mt-2 flex items-baseline gap-4",children:[e.jsxs("span",{className:"text-3xl font-bold text-accent",children:[s,"%"]}),e.jsxs("span",{className:"text-sm text-muted-text",children:[S," ",r("analytics.matching_cases",{defaultValue:"cases"})]}),e.jsx(ee,{totalMatching:o})]}),n.court&&e.jsx("span",{className:"mt-1 inline-block rounded bg-surface px-2 py-0.5 text-xs text-muted-text",children:n.court})]}),e.jsx("button",{onClick:a,"aria-label":"Close",className:"rounded-md p-1.5 text-muted-text hover:bg-surface hover:text-foreground",children:e.jsx(ce,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"mb-3 text-lg font-semibold text-foreground",children:"Nature vs Outcome Breakdown"}),e.jsx("div",{className:"rounded-md border border-border bg-surface p-4",children:i||!c?e.jsx("p",{className:"text-sm text-muted-text",children:r("common.loading",{defaultValue:"Loading..."})}):e.jsx(te,{data:c})})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"mb-3 text-lg font-semibold text-foreground",children:"Concept Effectiveness"}),e.jsx("div",{className:"rounded-md border border-border bg-surface p-4",children:u||!x?e.jsx("p",{className:"text-sm text-muted-text",children:r("common.loading",{defaultValue:"Loading..."})}):e.jsx(ae,{data:x})})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"mb-3 text-lg font-semibold text-foreground",children:"Concept Trends"}),e.jsx("div",{className:"rounded-md border border-border bg-surface p-4",children:y||!p?e.jsx("p",{className:"text-sm text-muted-text",children:r("common.loading",{defaultValue:"Loading..."})}):e.jsx(se,{data:p})})]})]})]})})}function Ze(t,a,n){return Math.min(Math.max(t,a),n)}function et(t){return t<40?"text-red-500":t<65?"text-yellow-500":"text-green-500"}function tt(t){return t<40?"#ef4444":t<65?"#eab308":"#22c55e"}function at({score:t,label:a}){const n=Ze(Math.round(t),0,100),s=l.useMemo(()=>et(n),[n]),o=l.useMemo(()=>tt(n),[n]),r=70,c=90,i=85,x=Math.PI*r,u=n/100*x;return e.jsxs("div",{"data-testid":"risk-gauge",className:"flex flex-col items-center",children:[e.jsxs("svg",{width:180,height:100,viewBox:"0 0 180 100",children:[e.jsx("path",{d:`M ${c-r} ${i} A ${r} ${r} 0 0 1 ${c+r} ${i}`,fill:"none",stroke:"var(--color-border, #e5e7eb)",strokeWidth:12,strokeLinecap:"round"}),e.jsx("path",{d:`M ${c-r} ${i} A ${r} ${r} 0 0 1 ${c+r} ${i}`,fill:"none",stroke:o,strokeWidth:12,strokeLinecap:"round",strokeDasharray:`${u} ${x}`}),e.jsx("text",{x:c,y:i-10,textAnchor:"middle",dominantBaseline:"middle",fontSize:28,fontWeight:"bold",fill:"currentColor",children:n})]}),e.jsx("span",{"data-testid":"risk-gauge-label",className:`-mt-2 text-sm font-medium ${s}`,children:a})]})}function st({filters:t}){const{t:a}=f(),[n,s]=l.useState(""),[o,r]=l.useState(""),[c,i]=l.useState([]),[x,u]=l.useState(!1),{data:p}=Y(),{data:y}=J(t),{data:S}=U(t,18),g=l.useMemo(()=>({...t,visa_subclass:n||void 0,case_nature:o||void 0,legal_concepts:c}),[t,n,o,c]),{data:h,isLoading:M}=Ie(g),z=l.useMemo(()=>y?Object.keys(y.by_subclass).sort((d,j)=>Number(d)-Number(j)):[],[y]),T=S?.concepts??[],m=d=>{i(j=>j.includes(d)?j.filter(R=>R!==d):[...j,d])};return e.jsxs("section",{className:"rounded-lg border border-border bg-card p-4","data-testid":"success-rate-calculator",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:a("analytics.success_rate_calculator")}),e.jsx("p",{className:"text-sm text-muted-text",children:a("analytics.success_calculator_desc")})]}),e.jsxs("div",{className:"mb-1 flex flex-wrap items-center gap-x-1.5 text-xs font-medium text-muted-text",children:[e.jsx("span",{children:a("analytics.visa_subclass")}),e.jsxs("select",{value:n,onChange:d=>s(d.target.value),className:"rounded-md border border-border bg-background px-2 py-1.5 text-sm text-foreground",children:[e.jsx("option",{value:"",children:a("common.all")}),z.map(d=>e.jsx("option",{value:d,children:d},d))]}),e.jsx("span",{className:"ml-2",children:a("analytics.case_nature")}),e.jsxs("select",{value:o,onChange:d=>r(d.target.value),className:"rounded-md border border-border bg-background px-2 py-1.5 text-sm text-foreground",children:[e.jsx("option",{value:"",children:a("common.all")}),(p?.natures??[]).map(d=>e.jsx("option",{value:d,children:d},d))]}),e.jsx("span",{className:"ml-2",children:a("analytics.legal_concepts_label")}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:T.slice(0,12).map(d=>{const j=c.includes(d.name);return e.jsx("button",{type:"button",onClick:()=>m(d.name),className:E("rounded-full px-2 py-1 text-xs",j?"bg-accent text-white":"bg-surface text-secondary-text hover:bg-accent-muted hover:text-accent"),children:d.name},d.name)})})]}),M||!h?e.jsx("div",{className:"mt-4 text-sm text-muted-text",children:a("analytics.loading_calculator")}):e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid gap-4 lg:grid-cols-4",children:[e.jsxs("div",{className:"rounded-md border border-border p-3",children:[e.jsx("p",{className:"text-xs font-medium uppercase tracking-wide text-muted-text",children:a("analytics.success_rate")}),e.jsxs("p",{className:"mt-1 text-3xl font-bold text-foreground","data-testid":"success-rate-number",children:[h.success_rate.overall.toFixed(1),"%"]}),e.jsxs("p",{className:"mt-1 text-xs text-secondary-text",children:[h.query.total_matching.toLocaleString()," ",a("analytics.matching_cases")]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(ee,{totalMatching:h.query.total_matching}),e.jsxs("button",{type:"button",onClick:()=>u(!0),className:"inline-flex items-center gap-1 rounded-md border border-border px-2 py-1 text-xs text-secondary-text hover:bg-surface hover:text-foreground",children:[e.jsx(Te,{className:"h-3 w-3"}),a("analytics.deep_dive",{defaultValue:"Deep Dive"})]})]})]}),e.jsx("div",{className:"flex items-center justify-center rounded-md border border-border p-3",children:e.jsx(at,{score:h.success_rate.overall,label:h.success_rate.overall>=65?a("analytics.favourable",{defaultValue:"Favourable"}):h.success_rate.overall>=40?a("analytics.moderate",{defaultValue:"Moderate"}):a("analytics.unfavourable",{defaultValue:"Unfavourable"})})}),e.jsxs("div",{className:"rounded-md border border-border p-3 lg:col-span-2",children:[e.jsx("p",{className:"mb-2 text-xs font-medium uppercase tracking-wide text-muted-text",children:a("analytics.outcome_funnel")}),e.jsx(Pe,{winCount:h.success_rate.win_count,lossCount:h.success_rate.loss_count})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs("div",{className:"rounded-md border border-border p-3",children:[e.jsx("p",{className:"mb-2 text-xs font-medium uppercase tracking-wide text-muted-text",children:a("analytics.top_concept_lift")}),e.jsx("div",{className:"space-y-2",children:h.by_concept.slice(0,6).map(d=>e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-foreground",children:d.concept}),e.jsxs("span",{className:"text-secondary-text",children:[d.win_rate.toFixed(1),"%"]})]}),e.jsx("div",{className:"h-2 rounded bg-surface",children:e.jsx("div",{className:"h-2 rounded bg-accent",style:{width:`${Math.min(d.win_rate,100)}%`}})})]},d.concept))})]}),e.jsxs("div",{className:"rounded-md border border-border p-3",children:[e.jsx("p",{className:"mb-2 text-xs font-medium uppercase tracking-wide text-muted-text",children:a("analytics.win_trend")}),e.jsx(k,{width:"100%",height:180,children:e.jsxs(G,{data:h.trend,margin:{top:5,right:5,left:-20,bottom:0},children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"var(--color-border)",opacity:.35}),e.jsx(C,{dataKey:"year",tick:{fontSize:11,fill:"var(--color-text-secondary)"}}),e.jsx(v,{tick:{fontSize:11,fill:"var(--color-text-secondary)"}}),e.jsx(N,{formatter:d=>[`${Number(d??0).toFixed(1)}%`,a("analytics.success_rate")],contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)"}}),e.jsx(W,{type:"monotone",dataKey:"rate",stroke:"var(--color-primary)",strokeWidth:2,dot:{r:2}})]})})]})]}),e.jsxs("div",{className:"rounded-md border border-border p-3",children:[e.jsx("p",{className:"mb-2 text-xs font-medium uppercase tracking-wide text-muted-text",children:a("analytics.top_concept_combinations")}),e.jsx(He,{combos:h.top_combos})]})]}),h&&e.jsx(Qe,{open:x,onClose:()=>u(!1),filters:t,currentRate:h.success_rate.overall,totalMatching:h.query.total_matching})]})}function rt({title:t,children:a,isLoading:n,isEmpty:s,className:o}){const{t:r}=f();return e.jsxs("div",{style:{contentVisibility:"auto",containIntrinsicSize:"auto 400px"},className:`flex h-full flex-col rounded-lg border border-border bg-card p-4 ${o??""}`,children:[e.jsx("h3",{className:"mb-3 font-heading text-base font-semibold text-foreground",children:t}),n?e.jsxs("div",{className:"flex flex-1 flex-col gap-3 pt-2",children:[e.jsx("div",{className:"h-4 w-3/4 animate-pulse rounded bg-border/40"}),e.jsx("div",{className:"h-4 w-1/2 animate-pulse rounded bg-border/40"}),e.jsx("div",{className:"h-32 w-full animate-pulse rounded bg-border/40"}),e.jsx("div",{className:"h-4 w-2/3 animate-pulse rounded bg-border/40"})]}):s?e.jsx("div",{className:"flex flex-1 items-center justify-center text-sm text-muted-text",children:r("chart.no_data")}):e.jsx("div",{className:"min-h-0 flex-1",children:a})]})}const b=l.memo(rt),nt={Affirmed:"#2d7d46",Dismissed:"#a83232",Remitted:"#2a6496","Set Aside":"#6c3483",Allowed:"#117864",Refused:"#b9770e",Withdrawn:"#8b8680",Other:"#c0b8a8"};function ot({data:t}){const a=new Set;for(const o of Object.values(t))for(const r of Object.keys(o))a.add(r);const n=[...a].sort(),s=Object.entries(t).map(([o,r])=>{const c=Object.values(r).reduce((x,u)=>x+u,0),i={court:o,_total:c};for(const x of n)i[x]=c>0?Math.round((r[x]??0)/c*1e3)/10:0;return i}).sort((o,r)=>r._total-o._total);return e.jsx(k,{width:"100%",height:s.length*36+50,children:e.jsxs(F,{data:s,layout:"vertical",margin:{top:0,right:20,bottom:30,left:5},children:[e.jsx(C,{type:"number",domain:[0,100],tickFormatter:o=>`${o}%`,tick:{fontSize:11,fill:"var(--color-text-secondary)"},axisLine:!1,tickLine:!1}),e.jsx(v,{type:"category",dataKey:"court",tick:{fontSize:11,fill:"var(--color-text-secondary)"},width:85,axisLine:!1,tickLine:!1}),e.jsx(N,{formatter:(o,r)=>[`${Number(o??0).toFixed(1)}%`,r??""],contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)",fontSize:12,padding:"8px 12px"},itemStyle:{fontSize:12,padding:"1px 0"},labelStyle:{fontSize:12,fontWeight:600,marginBottom:4}}),e.jsx(I,{wrapperStyle:{fontSize:11,paddingTop:8,color:"var(--color-text-secondary)"},iconSize:10}),n.map(o=>e.jsx($,{dataKey:o,stackId:"stack",fill:nt[o]??"#8b8680",maxBarSize:24},o))]})})}const ct=l.memo(ot);function it({data:t}){const{t:a}=f(),n=Object.entries(t).map(([s,o])=>{const r=Object.values(o).reduce((y,S)=>y+S,0),c=o.Affirmed??0,i=o["Set Aside"]??0,x=o.Remitted??0,u=o.Allowed??0,p=i+x+u;return{year:Number(s),affirmedRate:r>0?Math.round(c/r*1e3)/10:0,applicantWinRate:r>0?Math.round(p/r*1e3)/10:0,total:r}}).filter(s=>s.total>=10).sort((s,o)=>s.year-o.year);return e.jsx(k,{width:"100%",height:"100%",minHeight:300,children:e.jsxs(je,{data:n,margin:{top:5,right:15,bottom:5,left:-10},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"affirmedGrad-trend",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#2d7d46",stopOpacity:.2}),e.jsx("stop",{offset:"95%",stopColor:"#2d7d46",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"applicantGrad-trend",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#2a6496",stopOpacity:.2}),e.jsx("stop",{offset:"95%",stopColor:"#2a6496",stopOpacity:0})]})]}),e.jsx(K,{strokeDasharray:"3 3",stroke:"var(--color-border)",opacity:.2}),e.jsx(C,{dataKey:"year",tick:{fontSize:11,fill:"var(--color-text-secondary)"},tickFormatter:s=>`'${String(s).slice(2)}`,axisLine:!1,tickLine:!1}),e.jsx(v,{domain:[0,100],tickFormatter:s=>`${s}%`,tick:{fontSize:11,fill:"var(--color-text-secondary)"},axisLine:!1,tickLine:!1}),e.jsx(N,{formatter:(s,o)=>[`${Number(s??0).toFixed(1)}%`,o??""],labelFormatter:s=>`${a("analytics.year_label")} ${s}`,contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)",fontSize:12,padding:"8px 12px"},itemStyle:{fontSize:12,padding:"1px 0"},labelStyle:{fontSize:12,fontWeight:600,marginBottom:4}}),e.jsx(I,{wrapperStyle:{fontSize:11,color:"var(--color-text-secondary)"},iconSize:8}),e.jsx(V,{type:"monotone",dataKey:"affirmedRate",name:a("analytics.affirmed_rate"),stroke:"#2d7d46",strokeWidth:2,fill:"url(#affirmedGrad-trend)",dot:{r:2,fill:"#2d7d46",strokeWidth:0},activeDot:{r:4,fill:"#2d7d46",strokeWidth:2,stroke:"#fff"}}),e.jsx(V,{type:"monotone",dataKey:"applicantWinRate",name:a("analytics.applicant_win_rate"),stroke:"#2a6496",strokeWidth:2,fill:"url(#applicantGrad-trend)",dot:{r:2,fill:"#2a6496",strokeWidth:0},activeDot:{r:4,fill:"#2a6496",strokeWidth:2,stroke:"#fff"}})]})})}const lt=l.memo(it);function dt({data:t,limit:a=12}){const{t:n}=f(),s=Object.entries(t).map(([r,c])=>{const i=Object.values(c).reduce((u,p)=>u+p,0),x=c.Affirmed??0;return{subclass:r,affirmedRate:i>0?Math.round(x/i*1e3)/10:0,total:i}}).filter(r=>r.total>=20).sort((r,c)=>c.total-r.total).slice(0,a),o=r=>r>=55?"#2d7d46":r>=35?"#b9770e":"#a83232";return e.jsx(k,{width:"100%",height:s.length*32+30,children:e.jsxs(F,{data:s,layout:"vertical",margin:{top:0,right:30,bottom:0,left:0},children:[e.jsx(C,{type:"number",domain:[0,100],tickFormatter:r=>`${r}%`,tick:{fontSize:10,fill:"var(--color-text-secondary)"},axisLine:!1,tickLine:!1}),e.jsx(v,{type:"category",dataKey:"subclass",tick:{fontSize:10,fill:"var(--color-text-secondary)"},width:45,axisLine:!1,tickLine:!1}),e.jsx(N,{formatter:r=>[`${Number(r??0).toFixed(1)}%`,n("analytics.affirmed_rate")],labelFormatter:r=>`${n("analytics.visa_subclass")} ${r}`,contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)",fontSize:12,padding:"8px 12px"},itemStyle:{fontSize:12,padding:"1px 0"},labelStyle:{fontSize:12,fontWeight:600,marginBottom:4}}),e.jsx($,{dataKey:"affirmedRate",name:"Affirmed Rate",maxBarSize:20,radius:[0,3,3,0],label:{position:"right",fontSize:10,fill:"var(--color-text-secondary)",formatter:r=>`${Number(r)}%`},children:s.map(r=>e.jsx(D,{fill:o(r.affirmedRate)},r.subclass))})]})})}const xt=l.memo(dt);function mt(t){return t.split(/\s+/).map(a=>a.length<=2?a:a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()).join(" ")}function ut({data:t}){const{t:a}=f(),n=t.slice(0,12).map(s=>{const o=mt(s.name);return{...s,displayName:o.length>18?o.slice(0,16)+"…":o,fullName:o}});return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(ne,{to:"/judge-profiles",className:"text-xs font-medium text-accent hover:underline",children:[a("buttons.view_all")," ",e.jsx("span",{"aria-hidden":"true",children:"→"})]})}),e.jsx(k,{width:"100%",height:n.length*38+35,children:e.jsxs(F,{data:n,layout:"vertical",margin:{top:0,right:45,bottom:0,left:5},children:[e.jsx(C,{type:"number",hide:!0}),e.jsx(v,{type:"category",dataKey:"displayName",tick:{fontSize:12,fill:"var(--color-text-secondary)"},width:110,axisLine:!1,tickLine:!1}),e.jsx(N,{formatter:s=>[Number(s??0).toLocaleString(),a("chart.cases")],labelFormatter:(s,o)=>{const r=o?.[0]?.payload;return r?`${r.fullName??r.name} (${r.courts.join(", ")})`:""},contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)",fontSize:12,padding:"8px 12px"},itemStyle:{fontSize:12,padding:"1px 0"},labelStyle:{fontSize:12,fontWeight:600,marginBottom:4}}),e.jsx($,{dataKey:"count",fill:"var(--color-primary)",radius:[0,3,3,0],maxBarSize:22,label:{position:"right",fontSize:11,fill:"var(--color-text-secondary)",formatter:s=>{const o=Number(s);return o>=1e3?`${(o/1e3).toFixed(1)}k`:String(o)}}})]})})]})}const ht=l.memo(ut);function ft({data:t}){const{t:a}=f(),n=t.slice(0,12).map(s=>({...s,displayName:s.name.length>18?s.name.slice(0,16)+"…":s.name}));return e.jsx(k,{width:"100%",height:n.length*38+35,children:e.jsxs(F,{data:n,layout:"vertical",margin:{top:0,right:45,bottom:0,left:5},children:[e.jsx(C,{type:"number",hide:!0}),e.jsx(v,{type:"category",dataKey:"displayName",tick:{fontSize:12,fill:"var(--color-text-secondary)"},width:120,axisLine:!1,tickLine:!1}),e.jsx(N,{formatter:s=>[Number(s??0).toLocaleString(),a("chart.cases")],labelFormatter:(s,o)=>o?.[0]?.payload?.name??"",contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)",fontSize:12,padding:"8px 12px"},itemStyle:{fontSize:12,padding:"1px 0"},labelStyle:{fontSize:12,fontWeight:600,marginBottom:4}}),e.jsx($,{dataKey:"count",fill:"var(--color-accent)",radius:[0,3,3,0],maxBarSize:22,label:{position:"right",fontSize:11,fill:"var(--color-text-secondary)",formatter:s=>{const o=Number(s);return o>=1e3?`${(o/1e3).toFixed(1)}k`:String(o)}}})]})})}const pt=l.memo(ft);function yt({filters:t}){const{t:a}=f(),{data:n,isLoading:s}=J(t),{data:o,isLoading:r}=Ke(t),{data:c,isLoading:i}=U(t),{data:x,isLoading:u}=X(t);return e.jsxs(e.Fragment,{children:[e.jsx(b,{title:a("analytics.outcome_rate_by_court"),isLoading:s,isEmpty:!n||Object.keys(n.by_court).length===0,children:n&&e.jsx(ct,{data:n.by_court})}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsx(b,{title:a("analytics.affirmed_rate_trend"),isLoading:s,isEmpty:!n||Object.keys(n.by_year).length===0,children:n&&e.jsx(lt,{data:n.by_year})}),e.jsx(b,{title:a("analytics.affirmed_rate_visa"),isLoading:s,isEmpty:!n||Object.keys(n.by_subclass).length===0,children:n&&e.jsx(xt,{data:n.by_subclass})})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsx(b,{title:a("analytics.active_judges"),isLoading:r,isEmpty:!o||o.judges.length===0,children:o&&e.jsx(ht,{data:o.judges})}),e.jsx(b,{title:a("analytics.legal_concepts_frequency"),isLoading:i,isEmpty:!c||c.concepts.length===0,children:c&&e.jsx(pt,{data:c.concepts})})]}),e.jsx(b,{title:a("analytics.nature_outcome_matrix"),isLoading:u,isEmpty:!x||x.natures.length===0,children:x&&e.jsx(te,{data:x})})]})}const gt=l.memo(yt),bt={court:"Court",nature:"Case Nature",outcome:"Outcome"},jt={court:"var(--color-primary)",nature:"var(--color-accent)",outcome:"var(--color-success, #22c55e)"};function vt({x:t,y:a,width:n,height:s,index:o,payload:r}){const c=r.layer??"court";return e.jsxs(Ne,{children:[e.jsx(ke,{x:t,y:a,width:n,height:s,fill:jt[c]??"var(--color-muted)",fillOpacity:.85}),s>14&&e.jsx("text",{x:t+n+6,y:a+s/2,textAnchor:"start",dominantBaseline:"middle",fontSize:11,fill:"var(--color-text, currentColor)",children:r.name})]},`node-${o}`)}function Nt(t){const[a,n]=l.useState(700);return l.useEffect(()=>{const s=t.current;if(!s)return;const o=new ResizeObserver(r=>{const c=r[0];c&&n(Math.floor(c.contentRect.width))});return o.observe(s),n(Math.floor(s.getBoundingClientRect().width)),()=>o.disconnect()},[t]),a}function kt({data:t}){const a=l.useRef(null),n=Nt(a),s=!t.nodes.length||!t.links.length,o=l.useMemo(()=>{const r=new Set;for(const c of t.nodes)c.layer&&r.add(c.layer);return Array.from(r)},[t.nodes]);return s?e.jsx("div",{"data-testid":"flow-sankey-chart",className:"py-12 text-center text-muted-text",children:"No flow data available"}):e.jsxs("div",{"data-testid":"flow-sankey-chart",ref:a,className:"space-y-2",children:[e.jsx("div",{className:"flex justify-between px-4 text-xs font-medium text-muted-text",children:o.map(r=>e.jsx("span",{children:bt[r]??r},r))}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(ve,{width:Math.max(n,300),height:400,data:{nodes:t.nodes,links:t.links},node:e.jsx(vt,{x:0,y:0,width:0,height:0,index:0,payload:{name:""}}),link:{stroke:"var(--color-border, #d1d5db)"},margin:{top:10,right:120,bottom:10,left:10},children:e.jsx(N,{})})})]})}const Ct=l.memo(kt);function St({data:t}){return t.series.length?e.jsxs("div",{"data-testid":"monthly-trends-chart",className:"space-y-2",children:[e.jsx(k,{width:"100%",height:300,children:e.jsxs(Ce,{data:t.series,margin:{top:10,right:20,left:-10,bottom:0},children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"var(--color-border)",opacity:.35}),e.jsx(C,{dataKey:"month",tick:{fontSize:10,fill:"var(--color-text-secondary)"},interval:"preserveStartEnd"}),e.jsx(v,{yAxisId:"left",tick:{fontSize:10,fill:"var(--color-text-secondary)"}}),e.jsx(v,{yAxisId:"right",orientation:"right",tick:{fontSize:10,fill:"var(--color-text-secondary)"},domain:[0,100],tickFormatter:a=>`${a}%`}),e.jsx(N,{contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)"}}),e.jsx($,{yAxisId:"left",dataKey:"total",fill:"var(--color-primary)",fillOpacity:.3,name:"Cases"}),e.jsx(W,{yAxisId:"right",type:"monotone",dataKey:"win_rate",stroke:"var(--color-accent)",strokeWidth:2,dot:!1,name:"Win Rate %"}),t.events.map(a=>e.jsx(Se,{yAxisId:"left",x:a.month,stroke:"var(--color-danger, #ef4444)",strokeDasharray:"4 4",label:{value:a.label,position:"top",fontSize:10,fill:"var(--color-danger, #ef4444)"}},a.month))]})}),t.events.length>0&&e.jsx("div",{className:"flex flex-wrap gap-3 text-xs text-muted-text",children:t.events.map(a=>e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{className:"inline-block h-2 w-2 rounded-full bg-red-500"}),e.jsx("span",{className:"font-medium",children:a.month}),e.jsx("span",{children:a.label})]},a.month))})]}):e.jsx("div",{"data-testid":"monthly-trends-chart",className:"py-12 text-center text-muted-text",children:"No monthly data available"})}const wt=l.memo(St);function _t({filters:t}){const{t:a}=f(),{data:n,isLoading:s}=We(t),{data:o,isLoading:r}=qe(t);return e.jsxs(e.Fragment,{children:[e.jsx(b,{title:a("analytics.flow_sankey",{defaultValue:"Case Flow (Court → Nature → Outcome)"}),isLoading:s,isEmpty:!n||n.nodes.length===0,children:n&&e.jsx(Ct,{data:n})}),e.jsx(b,{title:a("analytics.monthly_trends",{defaultValue:"Monthly Trends & Policy Events"}),isLoading:r,isEmpty:!o||o.series.length===0,children:o&&e.jsx(wt,{data:o})})]})}const Lt=l.memo(_t);function Ot({data:t}){const{t:a}=f(),n=t.concepts.slice(0,8),s=Array.from(new Set(n.flatMap(r=>Object.keys(r.by_court)))).slice(0,4),o=n.map(r=>{const c={name:r.name};return s.forEach(i=>{c[i]=r.by_court[i]?.win_rate??0}),c});return!o.length||!s.length?e.jsx("p",{className:"text-sm text-muted-text",children:a("analytics.no_court_data")}):e.jsx(k,{width:"100%",height:Math.max(o.length*38,260),children:e.jsxs(F,{data:o,layout:"vertical",margin:{top:0,right:10,left:20,bottom:0},children:[e.jsx(C,{type:"number",tick:{fontSize:11,fill:"var(--color-text-secondary)"},tickFormatter:r=>`${r}%`}),e.jsx(v,{type:"category",dataKey:"name",width:140,tick:{fontSize:11,fill:"var(--color-text-secondary)"},axisLine:!1,tickLine:!1}),e.jsx(N,{formatter:r=>[`${Number(r??0).toFixed(1)}%`,a("analytics.win_rate")],contentStyle:{backgroundColor:"var(--color-background-card)",border:"1px solid var(--color-border)",borderRadius:"var(--radius)",color:"var(--color-text)"}}),e.jsx(I,{wrapperStyle:{fontSize:11}}),s.map((r,c)=>e.jsx($,{dataKey:r,fill:["#1a5276","#2d7d46","#6c3483","#b9770e"][c%4],radius:[2,2,2,2]},r))]})})}const $t=l.memo(Ot);function Ft(t,a){return a===0?"var(--color-surface)":`rgba(26, 82, 118, ${Math.max(.15,Math.min(t/100,1))})`}function zt({data:t}){const{t:a}=f(),n=t.concepts.slice(0,12);return n.length?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"grid gap-px text-xs",style:{gridTemplateColumns:`180px repeat(${n.length}, minmax(70px, 1fr))`},children:[e.jsx("div",{className:"p-1.5 text-muted-text"}),n.map(s=>e.jsx("div",{className:"p-1.5 text-center text-[10px] font-semibold text-secondary-text",children:s},`head-${s}`)),n.map(s=>e.jsxs(l.Fragment,{children:[e.jsx("div",{className:"truncate p-1.5 text-[11px] font-medium text-foreground",title:s,children:s},`row-${s}`),n.map(o=>{const r=t.matrix[s]?.[o],c=r?.count??0,i=r?.win_rate??0;return e.jsx("div",{className:"flex items-center justify-center rounded-sm p-1.5 text-[10px]",style:{backgroundColor:Ft(i,c),color:c===0?"var(--color-text-muted)":i>30?"#fff":"var(--color-text-secondary)"},title:`${s} + ${o}: ${c.toLocaleString()} cases, ${i.toFixed(1)}%`,children:c>0?c.toLocaleString():"-"},`${s}-${o}`)})]},s))]})}):e.jsx("p",{className:"text-sm text-muted-text",children:a("analytics.no_cooccurrence_data")})}const Rt=l.memo(zt);function Mt({data:t}){const{t:a}=f(),n=t.emerging.length>0,s=t.declining.length>0;return!n&&!s?e.jsx("p",{className:"text-sm text-muted-text",children:a("analytics.no_concepts_detected")}):e.jsxs("div",{className:"space-y-3",children:[n&&e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-muted-text",children:a("analytics.emerging")}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.emerging.slice(0,8).map(o=>e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-100 px-2 py-1 text-xs font-medium text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-200",children:[e.jsx(Oe,{className:"h-3 w-3"}),o.name," (",o.growth_pct.toFixed(1),"%)"]},o.name))})]}),s&&e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-muted-text",children:a("analytics.declining")}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:t.declining.slice(0,8).map(o=>e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-rose-100 px-2 py-1 text-xs font-medium text-rose-800 dark:bg-rose-900/40 dark:text-rose-200",children:[e.jsx(_e,{className:"h-3 w-3"}),o.name," (",o.decline_pct.toFixed(1),"%)"]},o.name))})]})]})}const Tt=l.memo(Mt);function Et({filters:t}){const{t:a}=f(),{data:n,isLoading:s}=Q({...t,limit:30}),{data:o,isLoading:r}=Be({...t,limit:15,min_count:2}),{data:c,isLoading:i}=Z({...t,limit:10});return e.jsxs("section",{className:"space-y-4","data-testid":"concept-intelligence-section",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-foreground",children:a("analytics.concept_intelligence")}),e.jsx("p",{className:"text-sm text-muted-text",children:a("analytics.concept_intelligence_desc")||"Identify legal concepts that correlate with better outcomes and how they evolve over time."})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsx(b,{title:a("analytics.concept_effectiveness"),isLoading:s,isEmpty:!n||n.concepts.length===0,children:n&&e.jsx(ae,{data:n})}),e.jsx(b,{title:a("analytics.concept_by_court"),isLoading:s,isEmpty:!n||n.concepts.length===0,children:n&&e.jsx($t,{data:n})})]}),e.jsx(b,{title:a("analytics.concept_cooccurrence"),isLoading:r,isEmpty:!o||o.concepts.length===0,children:o&&e.jsx(Rt,{data:o})}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsx(b,{title:a("analytics.concept_trends"),isLoading:i,isEmpty:!c||Object.keys(c.series).length===0,children:c&&e.jsx(se,{data:c})}),e.jsx(b,{title:a("analytics.emerging_concepts"),isLoading:i,isEmpty:!c,children:c&&e.jsx(Tt,{data:c})})]})]})}const At=l.memo(Et),Dt=new Date().getFullYear(),Kt=["Affirmed","Dismissed","Remitted","Set Aside","Allowed","Refused","Withdrawn","Other"];function Jt(){const{t}=f(),[a,n]=l.useTransition(),[s,o]=l.useState(""),[r,c]=l.useState(2e3),[i,x]=l.useState(Dt),[u,p]=l.useState([]),[y,S]=l.useState([]),[g,h]=l.useState([]),M=O=>{n(()=>o(O))},z=(O,re)=>{n(()=>{c(O),x(re)})},T=O=>{n(()=>p(O))},m=O=>{n(()=>S(O))},d=O=>{n(()=>h(O))},{data:j}=Y(),R=l.useMemo(()=>({court:s||void 0,yearFrom:r,yearTo:i,caseNatures:u.length?u:void 0,visaSubclasses:y.length?y:void 0,outcomeTypes:g.length?g:void 0}),[s,r,i,u,y,g]);return e.jsxs("div",{className:`space-y-6 ${a?"opacity-70 transition-opacity":""}`,children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-semibold text-foreground",children:t("analytics.title")}),e.jsx("p",{className:"text-sm text-muted-text",children:t("analytics.subtitle")})]}),e.jsx(oe,{court:s,yearFrom:r,yearTo:i,onCourtChange:M,onYearRangeChange:z}),e.jsx(De,{caseNatures:j?.natures??[],visaSubclasses:j?.visa_types??[],outcomeTypes:Kt,selectedNatures:u,selectedSubclasses:y,selectedOutcomes:g,onNaturesChange:T,onSubclassesChange:m,onOutcomesChange:d})]}),e.jsx(st,{filters:R}),e.jsx(gt,{filters:R}),e.jsx(Lt,{filters:R}),e.jsx(At,{filters:R})]})}export{Jt as AnalyticsPage};
