import{j as a}from"./query-DQVcjD57.js";import{j as C,u as _,r as g}from"./vendor-CxW-pF4z.js";import{c as N,f as y}from"./use-cases-DtOm505J.js";import{B as w}from"./Breadcrumb-DgmWk9ZU.js";import{u as S,t as b}from"./index-Bnk0r1Pl.js";import{S as A}from"./save-BIREmgls.js";import"./api-mEKAgK73.js";import"./chevron-right-By1PNT4I.js";import"./charts-CKTqRh7i.js";const R=["","Migration","Refugee","Judicial Review","Citizenship","Visa Cancellation","Deportation","Character","Bridging Visa"],T=["","AATA","ARTA","FCA","FCCA","FedCFamC2G","HCA"];function M(){const{t:i}=S(),{id:l}=C(),c=_(),{data:r,isLoading:o}=N(l),u=y(),[s,h]=g.useState({}),[x,f]=g.useState(!1);g.useEffect(()=>{if(r?.case){const e=["title","citation","court","court_code","date","judges","outcome","visa_type","visa_subclass","visa_class_code","case_nature","legislation","legal_concepts","catchwords","url","source","tags","user_notes","applicant_name","respondent","country_of_origin","visa_subclass_number","hearing_date","is_represented","representative"],d={};for(const m of e)d[m]=String(r.case[m]??"");h(d)}},[r]),g.useEffect(()=>{if(!x)return;const e=d=>{d.preventDefault()};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[x]);const t=g.useCallback((e,d)=>{h(m=>({...m,[e]:d})),f(!0)},[]);if(o||!r)return a.jsx("div",{className:"flex h-64 items-center justify-center text-muted-text",children:"Loading..."});const j=async e=>{if(e.preventDefault(),!s.title?.trim()){b.error(i("pages.case_edit.title_required"));return}try{await u.mutateAsync({id:l,data:s}),b.success(i("pages.case_edit.success")),f(!1),c(`/cases/${l}`)}catch(d){b.error(d.message)}};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(w,{items:[{label:"Cases",href:"/cases"},{label:r.case.citation||"Case",href:`/cases/${l}`},{label:"Edit"}]}),x&&a.jsx("span",{className:"rounded-full bg-warning/10 px-2 py-0.5 text-xs font-medium text-warning",children:"Unsaved changes"})]}),a.jsx("form",{onSubmit:j,children:a.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[a.jsxs("div",{className:"rounded-lg border border-border bg-card p-5 lg:col-span-2",children:[a.jsx("h2",{className:"mb-3 font-heading text-base font-semibold",children:"Case Metadata"}),a.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[a.jsx(n,{label:"Title *",value:s.title,onChange:e=>t("title",e)}),a.jsx(n,{label:"Citation",value:s.citation,onChange:e=>t("citation",e)}),a.jsx(n,{label:"Court",value:s.court,onChange:e=>t("court",e)}),a.jsx(p,{label:"Court Code",value:s.court_code,options:T,onChange:e=>t("court_code",e)}),a.jsx(n,{label:"Date",value:s.date,onChange:e=>t("date",e),placeholder:"DD Month YYYY"}),a.jsx(n,{label:"Year",value:s.year,onChange:e=>t("year",e),type:"number"}),a.jsx(n,{label:"Judges",value:s.judges,onChange:e=>t("judges",e)}),a.jsx(n,{label:"Outcome",value:s.outcome,onChange:e=>t("outcome",e)}),a.jsx(n,{label:"Visa Type",value:s.visa_type,onChange:e=>t("visa_type",e)}),a.jsx(n,{label:"Visa Subclass",value:s.visa_subclass,onChange:e=>t("visa_subclass",e)}),a.jsx(n,{label:"Visa Class Code",value:s.visa_class_code,onChange:e=>t("visa_class_code",e)}),a.jsx(p,{label:"Case Nature",value:s.case_nature,options:R,onChange:e=>t("case_nature",e)}),a.jsx(n,{label:"Legislation",value:s.legislation,onChange:e=>t("legislation",e),span2:!0}),a.jsx(n,{label:"Legal Concepts",value:s.legal_concepts,onChange:e=>t("legal_concepts",e),span2:!0,placeholder:"Semicolon-separated"}),a.jsx(n,{label:"URL",value:s.url,onChange:e=>t("url",e),span2:!0}),a.jsx(n,{label:"Source",value:s.source,onChange:e=>t("source",e)}),a.jsx(v,{label:"Catchwords",value:s.catchwords,onChange:e=>t("catchwords",e),rows:3})]}),a.jsx("h2",{className:"mb-3 mt-5 font-heading text-base font-semibold",children:"Parties & Representation"}),a.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[a.jsx(n,{label:"Applicant Name",value:s.applicant_name,onChange:e=>t("applicant_name",e)}),a.jsx(n,{label:"Respondent",value:s.respondent,onChange:e=>t("respondent",e)}),a.jsx(n,{label:"Country of Origin",value:s.country_of_origin,onChange:e=>t("country_of_origin",e)}),a.jsx(n,{label:"Visa Subclass Number",value:s.visa_subclass_number,onChange:e=>t("visa_subclass_number",e)}),a.jsx(n,{label:"Hearing Date",value:s.hearing_date,onChange:e=>t("hearing_date",e),placeholder:"DD Month YYYY"}),a.jsx(p,{label:"Represented",value:s.is_represented,options:["","Yes","No","Self-represented"],onChange:e=>t("is_represented",e)}),a.jsx(n,{label:"Representative",value:s.representative,onChange:e=>t("representative",e),span2:!0})]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"rounded-lg border border-border bg-card p-5",children:[a.jsx("h2",{className:"mb-3 font-heading text-base font-semibold",children:"Annotations"}),a.jsx(n,{label:"Tags",value:s.tags,onChange:e=>t("tags",e),placeholder:"Comma-separated"}),a.jsx("div",{className:"mt-4",children:a.jsx(v,{label:"Notes",value:s.user_notes,onChange:e=>t("user_notes",e),rows:8})})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{type:"button",onClick:()=>c(-1),className:"flex-1 rounded-md border border-border px-4 py-2 text-sm text-foreground hover:bg-surface",children:"Cancel"}),a.jsxs("button",{type:"submit",disabled:u.isPending,className:"flex flex-1 items-center justify-center gap-1 rounded-md bg-accent px-4 py-2 text-sm font-medium text-white hover:bg-accent-light disabled:opacity-50",children:[a.jsx(A,{className:"h-4 w-4"}),u.isPending?"Saving...":"Save"]})]})]})]})})]})}function n({label:i,value:l,onChange:c,type:r="text",placeholder:o,span2:u}){return a.jsxs("div",{className:u?"sm:col-span-2":"",children:[a.jsx("label",{className:"mb-1 block text-xs font-medium text-secondary-text",children:i}),a.jsx("input",{type:r,value:l??"",onChange:s=>c(s.target.value),placeholder:o,className:"w-full rounded-md border border-border bg-surface px-3 py-1.5 text-sm text-foreground focus:border-accent focus:outline-none focus:ring-1 focus:ring-accent"})]})}function p({label:i,value:l,options:c,onChange:r}){return a.jsxs("div",{children:[a.jsx("label",{className:"mb-1 block text-xs font-medium text-secondary-text",children:i}),a.jsx("select",{value:l??"",onChange:o=>r(o.target.value),className:"w-full rounded-md border border-border bg-surface px-3 py-1.5 text-sm text-foreground focus:border-accent focus:outline-none focus:ring-1 focus:ring-accent",children:c.map(o=>a.jsx("option",{value:o,children:o||`Select ${i}...`},o))})]})}function v({label:i,value:l,onChange:c,rows:r=3}){return a.jsxs("div",{className:"sm:col-span-2",children:[a.jsx("label",{className:"mb-1 block text-xs font-medium text-secondary-text",children:i}),a.jsx("textarea",{value:l??"",onChange:o=>c(o.target.value),rows:r,className:"w-full rounded-md border border-border bg-surface px-3 py-1.5 text-sm text-foreground focus:border-accent focus:outline-none focus:ring-1 focus:ring-accent"})]})}export{M as CaseEditPage};
