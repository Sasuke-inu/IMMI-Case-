import{j as e}from"./query-DQVcjD57.js";import{i as T,u as U,r as i}from"./vendor-CxW-pF4z.js";import{u as M,a as R,b as D,c as E}from"./use-legislations-QfiV46Dl.js";import{B as q}from"./Breadcrumb-BGpauoZZ.js";import{P as B}from"./Pagination-BTOSZNaB.js";import{E as I}from"./EmptyState-G-Z6VqX3.js";import{c as A,u as $,a as x,S as z}from"./index-BVFuTJQG.js";import{C as H}from"./chevron-right-VPXu-Cmy.js";import"./api-BvrL3ogf.js";import"./chevron-left-BRQB90ZX.js";import"./charts-CKTqRh7i.js";const J=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],O=A("refresh-cw",J);function Q(s){if(!s)return"";const r=new Date(s);return isNaN(r.getTime())?s:r.toLocaleDateString("en-AU",{day:"numeric",month:"short",year:"numeric"})}function ne(){const{t:s}=$(),[r,d]=T(),g=U(),n=r.get("q")??"",j=Number(r.get("page")??1),p=20,[N,v]=i.useState(n),l=i.useRef(null);i.useEffect(()=>()=>{l.current&&clearTimeout(l.current)},[]);const w=M(),b=R(),a=w.data?.status,{data:o,isLoading:y}=D(n?1:j,p),{data:h,isLoading:_}=E(n,p),u=n?h:o,L=n?_:y,f=i.useMemo(()=>u?n?u.data||[]:u.data||[]:[],[u,n]),S=i.useMemo(()=>n?h?.meta?.total_results??0:o?.meta?.total??0,[o,h,n]),V=i.useMemo(()=>n?1:o?.meta?.pages??1,[o,n]),C=i.useCallback(t=>{v(t),l.current&&clearTimeout(l.current);const m=setTimeout(()=>{const c=new URLSearchParams;t?(c.set("q",t),c.set("page","1")):(c.delete("q"),c.set("page","1")),d(c)},300);l.current=m},[d]),k=i.useCallback(t=>{const m=new URLSearchParams(r);m.set("page",String(t)),d(m),window.scrollTo({top:0,behavior:"smooth"})},[r,d]),P=i.useCallback(t=>{g(`/legislations/${t}`)},[g]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx(q,{items:[{label:s("common.dashboard"),href:"/"},{label:s("legislations.title",{defaultValue:"Legislations"})}]}),e.jsxs("div",{className:"rounded-lg border border-border bg-card p-5",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"font-heading text-2xl font-semibold text-foreground",children:s("legislations.title",{defaultValue:"Legislations"})}),e.jsx("p",{className:"mt-1 text-sm text-secondary-text",children:s("legislations.description",{defaultValue:"Browse and search legislation relevant to immigration law"})})]}),e.jsxs("button",{onClick:()=>b.mutate(void 0),disabled:a?.running||b.isPending,className:x("flex shrink-0 items-center gap-2 rounded-md border border-border px-3 py-2 text-sm font-medium","text-foreground transition-colors hover:bg-surface disabled:cursor-not-allowed disabled:opacity-50"),children:[e.jsx(O,{className:x("h-4 w-4",a?.running&&"animate-spin")}),a?.running?s("legislations.updating",{defaultValue:"Updating..."}):s("legislations.update_laws",{defaultValue:"Update Laws"})]})]}),a?.running&&a.total>0&&e.jsxs("div",{className:"mt-4 space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between text-xs text-muted-text",children:[e.jsx("span",{className:"truncate font-mono",children:a.section_id}),e.jsxs("span",{children:[a.current,"/",a.total]})]}),e.jsx("div",{className:"h-1.5 w-full overflow-hidden rounded-full bg-surface",children:e.jsx("div",{className:"h-full bg-accent transition-all duration-300",style:{width:`${Math.round(a.current/a.total*100)}%`}})}),e.jsxs("p",{className:"text-xs text-muted-text",children:[s("legislations.scraping_law",{defaultValue:"Downloading"})," ",e.jsx("span",{className:"font-medium text-foreground",children:a.law_id})]})]}),!a?.running&&(a?.completed_laws?.length??0)>0&&e.jsxs("p",{className:"mt-3 text-xs text-success",children:["✓"," ",s("legislations.update_complete",{defaultValue:"Updated {{count}} law(s)",count:a.completed_laws.length}),(a?.failed_laws?.length??0)>0&&e.jsxs("span",{className:"ml-2 text-danger",children:["· ",a.failed_laws.length," failed"]})]})]}),e.jsx("div",{className:"rounded-lg border border-border bg-card p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-text"}),e.jsx("input",{type:"text",placeholder:s("common.search",{defaultValue:"Search legislations..."}),value:N,onChange:t=>C(t.target.value),className:x("w-full rounded-md border border-border bg-surface px-3 py-2 pl-10 text-sm","text-foreground placeholder:text-muted-text","focus:border-accent focus:outline-none focus:ring-1 focus:ring-accent/50")})]})}),L?e.jsx("div",{className:"flex h-64 items-center justify-center text-muted-text",children:s("common.loading_ellipsis")}):f.length===0?e.jsx(I,{icon:"BookOpen",title:n?s("common.no_results",{defaultValue:"No results found"}):s("common.no_data",{defaultValue:"No legislations"}),description:n?s("common.try_different_search",{defaultValue:"Try adjusting your search terms"}):s("legislations.no_data_description",{defaultValue:"No legislations available yet"})}):e.jsx("div",{className:"space-y-3",children:f.map(t=>e.jsx("button",{onClick:()=>P(t.id),className:x("w-full rounded-lg border border-border bg-card p-4 text-left","transition-colors hover:border-accent hover:bg-surface"),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-heading text-base font-semibold text-foreground",children:t.title}),t.shortcode&&e.jsx("span",{className:"inline-flex items-center rounded-md bg-accent/10 px-2 py-0.5 text-xs font-medium text-accent",children:t.shortcode})]}),t.description&&e.jsx("p",{className:"mt-1.5 line-clamp-2 text-sm text-secondary-text",children:t.description}),e.jsxs("div",{className:"mt-2.5 flex flex-wrap gap-3 text-xs text-muted-text",children:[t.jurisdiction&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"font-medium",children:[s("legislations.jurisdiction",{defaultValue:"Jurisdiction"}),":"]}),e.jsx("span",{children:t.jurisdiction})]}),t.type&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"font-medium",children:[s("legislations.type",{defaultValue:"Type"}),":"]}),e.jsx("span",{children:t.type})]}),t.sections_count>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"font-medium",children:[s("legislations.sections",{defaultValue:"Sections"}),":"]}),e.jsx("span",{children:t.sections_count})]}),t.last_amended&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"font-medium",children:[s("legislations.last_amended",{defaultValue:"Amended"}),":"]}),e.jsx("span",{children:t.last_amended})]}),t.last_scraped&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"font-medium",children:[s("legislations.last_scraped",{defaultValue:"Scraped"}),":"]}),e.jsx("span",{children:Q(t.last_scraped)})]})]})]}),e.jsx(H,{className:"mt-1 h-5 w-5 shrink-0 text-muted-text transition-transform group-hover:translate-x-0.5"})]})},t.id))}),!n&&f.length>0&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(B,{currentPage:j,totalPages:V,totalItems:S,pageSize:p,onPageChange:k})})]})}export{ne as LegislationsPage};
