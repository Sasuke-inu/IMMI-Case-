import{u as $,j as e}from"./query-DQVcjD57.js";import{u as M,r as d}from"./vendor-CxW-pF4z.js";import{f as q}from"./api-BvrL3ogf.js";import{c as A,u as P,S as R,F as _}from"./index-BVFuTJQG.js";import{D}from"./database-DiIJDpCG.js";import{D as f}from"./download-DztvrjPX.js";import{C as b}from"./clock-BiqF7OHD.js";import{L as B}from"./loader-circle-D5icnang.js";import{C as F,a as z}from"./circle-check-big-BebVITv7.js";import{C as J,a as U}from"./chevron-up-BL41EbLS.js";import{A as K}from"./arrow-right-z14XMCc9.js";import"./charts-CKTqRh7i.js";const Q=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],C=A("circle-x",Q),V={search:{label:"Search",icon:R,color:"text-info"},download:{label:"Download",icon:f,color:"text-success"},"bulk download":{label:"Bulk Download",icon:f,color:"text-success"},update:{label:"Update DB",icon:D,color:"text-accent"}};function ne(){const{t}=P(),j=M(),[h,k]=d.useState(!1),[N]=d.useState(()=>Date.now()),[E,S]=d.useState(0),o=d.useRef(null),{data:a}=$({queryKey:["job-status"],queryFn:q,refetchInterval:s=>s.state.data?.running?2e3:5e3});if(d.useEffect(()=>(a?.running?o.current=setInterval(()=>{S(Math.floor((Date.now()-N)/1e3))},1e3):o.current&&(clearInterval(o.current),o.current=null),()=>{o.current&&clearInterval(o.current)}),[a?.running,N]),!a)return e.jsx("div",{className:"flex h-64 items-center justify-center text-muted-text",children:t("common.loading_ellipsis")});const r=a.running,v=a.type??"",i=V[v],T=i?.icon??_,m=a.total??0,p=a.completed??0,w=m>0?Math.round(p/m*100):0,x=a.errors??[],g=a.results??[],y=a.message??a.progress??"",c=!r&&(p>0||g.length>0),u=!r&&x.length>0&&!c,I=s=>{const n=Math.floor(s/60),l=s%60;return n>0?`${n}m ${l}s`:`${l}s`},L=[{label:"View Cases",icon:_,to:"/cases"},{label:"Dashboard",icon:D,to:"/"},{label:"Download",icon:f,to:"/download"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"h-6 w-6 text-accent"}),e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:t("pages.job_status.title")})]}),e.jsxs("div",{className:"rounded-lg border border-border bg-card p-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`rounded-full p-3 ${r?"bg-accent-muted":u?"bg-danger/10":c?"bg-success/10":"bg-surface"}`,children:r?e.jsx(B,{className:"h-8 w-8 animate-spin text-accent"}):u?e.jsx(C,{className:"h-8 w-8 text-danger"}):c?e.jsx(F,{className:"h-8 w-8 text-success"}):e.jsx(b,{className:"h-8 w-8 text-muted-text"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:t(r?"pages.job_status.job_running":u?"pages.job_status.job_failed":c?"pages.job_status.job_completed":"pages.job_status.no_active_job")}),v&&i&&e.jsxs("span",{className:`flex items-center gap-1 rounded-full bg-surface px-2.5 py-0.5 text-xs font-medium ${i.color}`,children:[e.jsx(T,{className:"h-3 w-3"}),i.label]})]}),y&&e.jsx("p",{className:"mt-1 text-sm text-muted-text",children:y}),r&&e.jsxs("p",{className:"mt-1 flex items-center gap-1 text-xs text-muted-text",children:[e.jsx(b,{className:"h-3 w-3"})," ",t("pages.job_status.elapsed"),":"," ",I(E)]})]})]}),r&&m>0&&e.jsxs("div",{className:"mt-5",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-text",children:[p.toLocaleString()," / ",m.toLocaleString()]}),e.jsxs("span",{className:"font-mono text-foreground",children:[w,"%"]})]}),e.jsx("div",{className:"mt-1.5 h-3 rounded-full bg-surface",children:e.jsx("div",{className:"h-3 rounded-full bg-accent transition-all duration-300",style:{width:`${w}%`}})})]}),!r&&!c&&!u&&e.jsxs("div",{className:"mt-4 rounded-md bg-surface p-4 text-center",children:[e.jsx("p",{className:"text-sm text-muted-text",children:t("pages.job_status.no_job_running")}),e.jsx("div",{className:"mt-3 flex flex-wrap justify-center gap-2",children:[{label:"Download",to:"/download"},{label:"Pipeline",to:"/pipeline"}].map(s=>e.jsx("button",{onClick:()=>j(s.to),className:"rounded-md border border-border px-3 py-1.5 text-sm text-foreground hover:bg-card",children:s.label},s.to))})]})]}),g.length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-6",children:[e.jsx("h3",{className:"mb-4 font-heading text-lg font-semibold",children:t("pages.job_status.activity")}),e.jsx("div",{className:"space-y-3",children:g.slice(-10).reverse().map((s,n)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1 h-2 w-2 shrink-0 rounded-full bg-accent"}),e.jsx("p",{className:"text-sm text-foreground",children:s})]},n))})]}),x.length>0&&e.jsxs("div",{className:"rounded-lg border border-danger/30 bg-card",children:[e.jsxs("button",{onClick:()=>k(!h),className:"flex w-full items-center justify-between p-4",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-danger",children:[e.jsx(z,{className:"h-4 w-4"})," ",t("pages.job_status.error_count",{count:x.length})]}),h?e.jsx(J,{className:"h-4 w-4 text-muted-text"}):e.jsx(U,{className:"h-4 w-4 text-muted-text"})]}),h&&e.jsx("div",{className:"max-h-60 overflow-auto border-t border-danger/20 p-4",children:e.jsx("div",{className:"space-y-1.5",children:x.map((s,n)=>e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx(C,{className:"mt-0.5 h-3 w-3 shrink-0 text-danger"}),e.jsx("span",{className:"text-danger",children:s})]},n))})})]}),c&&!r&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-6",children:[e.jsx("h3",{className:"mb-3 font-heading text-lg font-semibold",children:t("pages.job_status.next_steps")}),e.jsx("div",{className:"grid gap-2 sm:grid-cols-4",children:L.map(({label:s,icon:n,to:l})=>e.jsxs("button",{onClick:()=>j(l),className:"flex items-center gap-3 rounded-lg border border-border p-3 text-left transition-all hover:border-accent hover:shadow-md",children:[e.jsx("div",{className:"rounded-md bg-accent-muted p-2 text-accent",children:e.jsx(n,{className:"h-4 w-4"})}),e.jsx("span",{className:"flex-1 text-sm font-medium text-foreground",children:s}),e.jsx(K,{className:"h-4 w-4 text-muted-text"})]},l))})]})]})}export{ne as JobStatusPage};
