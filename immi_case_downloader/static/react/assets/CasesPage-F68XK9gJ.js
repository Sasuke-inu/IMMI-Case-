import{j as e}from"./query-DQVcjD57.js";import{i as q,u as H,r as i}from"./vendor-CxW-pF4z.js";import{u as J,a as Q,b as W}from"./use-cases-CPKl1up0.js";import{C as Y}from"./CourtBadge-Dl3EUmwl.js";import{O as Z}from"./OutcomeBadge-CVrUrw_x.js";import{N as ee}from"./NatureBadge-BhB54YxF.js";import{C as te}from"./CaseCard-CbAbn9Wa.js";import{X as se,u as ae,t as L,a as D,S as re,F as oe}from"./index-BVFuTJQG.js";import{P as ce}from"./Pagination-BTOSZNaB.js";import{E as ne}from"./EmptyState-G-Z6VqX3.js";import{T as le,C as ie}from"./ConfirmModal-CgS6V9Dy.js";import{L as de,a as ue}from"./list-CVbwVHOA.js";import{C as $,a as U}from"./chevron-up-BL41EbLS.js";import{T as me}from"./tag-CybOeUmL.js";import{D as xe}from"./download-DztvrjPX.js";import{G as pe}from"./git-compare-7G4xxX3y.js";import"./api-BvrL3ogf.js";import"./BookmarkButton-C3sTjWjN.js";import"./tokens-CHeescls.js";import"./calendar-BkSjeb3F.js";import"./user-ZWo6XdK2.js";import"./briefcase-BSXe2ZaH.js";import"./charts-CKTqRh7i.js";import"./chevron-left-BRQB90ZX.js";import"./chevron-right-VPXu-Cmy.js";function he({label:s,value:c,onRemove:g}){return e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-accent-muted px-2.5 py-1 text-xs font-medium text-accent",children:[e.jsxs("span",{className:"text-accent/60",children:[s,":"]}),c,e.jsx("button",{onClick:g,className:"ml-0.5 rounded-full p-0.5 hover:bg-accent/20 transition-colors",children:e.jsx(se,{className:"h-3 w-3"})})]})}function ge(s){if(!s)return"";const c=new Date(s);return isNaN(c.getTime())?s:c.toLocaleDateString("en-AU",{day:"numeric",month:"short",year:"numeric"})}function Me(){const{t:s}=ae(),[c,g]=q(),x=H(),[f,E]=i.useState(()=>localStorage.getItem("cases-view-mode")==="cards"?"cards":"table"),[n,j]=i.useState(new Set),[N,F]=i.useState(!1),[p,P]=i.useState(-1),[I,C]=i.useState(!1),_=i.useRef(null),a={court:c.get("court")??"",year:c.get("year")?Number(c.get("year")):void 0,visa_type:c.get("visa_type")??"",nature:c.get("nature")??"",source:c.get("source")??"",tag:c.get("tag")??"",keyword:c.get("keyword")??"",sort_by:c.get("sort_by")??"date",sort_dir:c.get("sort_dir")??"desc",page:Number(c.get("page")??1),page_size:100},{data:l,isLoading:y}=J(a),{data:b}=Q(),T=W(),d=i.useCallback((t,o)=>{const r=new URLSearchParams(c);o?r.set(t,o):r.delete(t),t!=="page"&&r.set("page","1"),g(r)},[c,g]),z=i.useCallback(()=>{g(new URLSearchParams)},[g]),O=i.useCallback(t=>{j(o=>{const r=new Set(o);return r.has(t)?r.delete(t):r.add(t),r})},[]),B=i.useCallback(()=>{l&&(n.size===l.cases.length?j(new Set):j(new Set(l.cases.map(t=>t.case_id))))},[l,n.size]),R=i.useCallback(async t=>{if(n.size===0)return;const o=t==="tag"?prompt(s("cases.add_tag")||"Enter tag:"):void 0;if(!(t==="tag"&&!o))try{const r=await T.mutateAsync({action:t,ids:Array.from(n),tag:o??void 0});L.success(s("cases.batch_updated",{count:r.affected})),j(new Set),C(!1)}catch(r){L.error(r.message)}},[n,T]),M=i.useCallback(()=>{if(!l?.cases.length)return;const t=["citation","title","court_code","date","year","judges","outcome","visa_type","case_nature"],o=l.cases.map(S=>t.map(K=>{const w=String(S[K]??"");return w.includes(",")||w.includes('"')?`"${w.replace(/"/g,'""')}"`:w})),r=[t.join(","),...o.map(S=>S.join(","))].join(`
`),v=new Blob([r],{type:"text/csv"}),m=URL.createObjectURL(v),k=document.createElement("a");k.href=m,k.download=`cases-export-${new Date().toISOString().slice(0,10)}.csv`,k.click(),URL.revokeObjectURL(m),L.success(s("cases.exported",{count:l.cases.length}))},[l]);i.useEffect(()=>{if(f!=="table")return;const t=o=>{const r=o.target;if(r.tagName==="INPUT"||r.tagName==="SELECT"||r.tagName==="TEXTAREA")return;const v=l?.cases.length??0;if(v!==0){if(o.key==="j")o.preventDefault(),P(m=>Math.min(m+1,v-1));else if(o.key==="k")o.preventDefault(),P(m=>Math.max(m-1,0));else if(o.key==="Enter"&&p>=0){o.preventDefault();const m=l?.cases[p];m&&x(`/cases/${m.case_id}`)}}};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[f,l,p,x]),i.useEffect(()=>{if(p<0||!_.current)return;_.current.children[p]?.scrollIntoView({block:"nearest"})},[p]);const h=l?.cases??[],A=l?.total??0,G=l?.total_pages??1,V=a.page??1,u=[];a.court&&u.push({key:"court",label:s("filters.court"),value:a.court}),a.year&&u.push({key:"year",label:s("units.year"),value:String(a.year)}),a.nature&&u.push({key:"nature",label:s("cases.nature"),value:a.nature}),a.visa_type&&u.push({key:"visa_type",label:s("cases.visa_subclass"),value:a.visa_type}),a.source&&u.push({key:"source",label:s("cases.source")||"Source",value:a.source}),a.tag&&u.push({key:"tag",label:s("common.tags")||"Tags",value:a.tag}),a.keyword&&u.push({key:"keyword",label:s("common.search"),value:a.keyword});const X=a.sort_by==="date"?s("filters.date")||"Date":a.sort_by==="year"?s("units.year"):a.sort_by==="title"?s("cases.title"):s("filters.court");return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:s("cases.title")}),e.jsxs("p",{className:"text-sm text-muted-text",children:[A.toLocaleString()," ",s("units.cases")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{E("table"),localStorage.setItem("cases-view-mode","table")},className:D("rounded-md p-1.5",f==="table"?"bg-accent-muted text-accent":"text-muted-text hover:text-foreground"),children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>{E("cards"),localStorage.setItem("cases-view-mode","cards")},className:D("rounded-md p-1.5",f==="cards"?"bg-accent-muted text-accent":"text-muted-text hover:text-foreground"),children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>x("/cases/add"),className:"rounded-md bg-accent px-3 py-1.5 text-sm font-medium text-white hover:bg-accent-light",children:s("buttons.add_case")})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("select",{value:a.court??"",onChange:t=>d("court",t.target.value),className:"rounded-md border border-border bg-card px-3 py-1.5 text-sm text-foreground",children:[e.jsx("option",{value:"",children:s("filters.all_courts")}),b?.courts?.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:a.year?.toString()??"",onChange:t=>d("year",t.target.value),className:"rounded-md border border-border bg-card px-3 py-1.5 text-sm text-foreground",children:[e.jsx("option",{value:"",children:s("filters.year_from")}),b?.years?.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:a.nature??"",onChange:t=>d("nature",t.target.value),className:"rounded-md border border-border bg-card px-3 py-1.5 text-sm text-foreground",children:[e.jsx("option",{value:"",children:s("filters.all_natures")}),b?.natures?.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-2.5 top-1/2 h-3.5 w-3.5 -translate-y-1/2 text-muted-text"}),e.jsx("input",{type:"text",placeholder:s("common.search_placeholder"),defaultValue:a.keyword,onBlur:t=>d("keyword",t.target.value),onKeyDown:t=>{t.key==="Enter"&&d("keyword",t.currentTarget.value)},className:"rounded-md border border-border bg-card py-1.5 pl-8 pr-3 text-sm text-foreground placeholder:text-muted-text"})]}),e.jsxs("button",{onClick:()=>F(!N),className:"flex items-center gap-1 rounded-md border border-border px-3 py-1.5 text-sm text-muted-text hover:text-foreground",children:[s("filters.filter"),N?e.jsx($,{className:"h-3.5 w-3.5"}):e.jsx(U,{className:"h-3.5 w-3.5"})]}),e.jsxs("div",{className:"ml-auto flex items-center gap-1.5",children:[e.jsxs("span",{className:"text-xs text-muted-text",children:[s("judges.sort_label"),":"]}),e.jsxs("select",{value:a.sort_by??"date",onChange:t=>d("sort_by",t.target.value),className:"rounded-md border border-border bg-card px-2 py-1.5 text-xs text-foreground",children:[e.jsx("option",{value:"date",children:s("cases.date")}),e.jsx("option",{value:"year",children:s("units.year")}),e.jsx("option",{value:"title",children:s("cases.title")}),e.jsx("option",{value:"court",children:s("filters.court")})]}),e.jsx("button",{onClick:()=>d("sort_dir",a.sort_dir==="asc"?"desc":"asc"),className:"rounded-md border border-border p-1.5 text-muted-text hover:text-foreground",title:`${s("cases.sorted")} ${X} ${a.sort_dir==="asc"?s("cases.ascending"):s("cases.descending")}`,children:a.sort_dir==="asc"?e.jsx($,{className:"h-3.5 w-3.5"}):e.jsx(U,{className:"h-3.5 w-3.5"})})]})]}),N&&e.jsxs("div",{className:"flex flex-wrap gap-2 rounded-md border border-border-light bg-surface p-3",children:[e.jsxs("select",{value:a.visa_type??"",onChange:t=>d("visa_type",t.target.value),className:"rounded-md border border-border bg-card px-3 py-1.5 text-sm text-foreground",children:[e.jsx("option",{value:"",children:s("filters.all_visa_types")}),b?.visa_types?.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:a.source??"",onChange:t=>d("source",t.target.value),className:"rounded-md border border-border bg-card px-3 py-1.5 text-sm text-foreground",children:[e.jsx("option",{value:"",children:s("filters.all_sources")}),b?.sources?.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:a.tag??"",onChange:t=>d("tag",t.target.value),className:"rounded-md border border-border bg-card px-3 py-1.5 text-sm text-foreground",children:[e.jsx("option",{value:"",children:s("filters.all_tags")}),b?.tags?.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),u.length>0&&e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[u.map(t=>e.jsx(he,{label:t.label,value:t.value,onRemove:()=>d(t.key,"")},t.key)),e.jsx("button",{onClick:z,className:"ml-1 text-xs text-muted-text hover:text-foreground",children:s("filters.clear_filters")})]}),n.size>0&&e.jsxs("div",{className:"flex items-center gap-3 rounded-md bg-accent-muted px-4 py-2 text-sm",children:[e.jsxs("span",{className:"font-medium text-accent",children:[n.size," ",s("cases.selected")||"selected"]}),e.jsxs("button",{onClick:()=>R("tag"),className:"flex items-center gap-1 text-accent hover:text-accent-light",children:[e.jsx(me,{className:"h-3.5 w-3.5"})," ",s("case_detail.tags")]}),e.jsxs("button",{onClick:M,className:"flex items-center gap-1 text-accent hover:text-accent-light",children:[e.jsx(xe,{className:"h-3.5 w-3.5"})," ",s("buttons.export_csv")]}),n.size>=2&&n.size<=5&&e.jsxs("button",{onClick:()=>{const t=Array.from(n),o=new URLSearchParams;t.forEach(r=>o.append("ids",r)),x(`/cases/compare?${o}`)},className:"flex items-center gap-1 text-accent hover:text-accent-light",children:[e.jsx(pe,{className:"h-3.5 w-3.5"})," Compare"]}),e.jsxs("button",{onClick:()=>C(!0),className:"flex items-center gap-1 text-danger hover:text-danger/80",children:[e.jsx(le,{className:"h-3.5 w-3.5"})," Delete"]}),e.jsx("button",{onClick:()=>j(new Set),className:"ml-auto text-muted-text hover:text-foreground",children:"Clear"})]}),y&&e.jsx("div",{className:"flex h-32 items-center justify-center text-muted-text",children:"Loading cases..."}),!y&&h.length===0&&e.jsx(ne,{icon:e.jsx(oe,{className:"h-8 w-8"}),title:"No cases found",description:u.length>0?"Try adjusting your filters or clearing them.":"Get started by searching or downloading cases.",action:u.length>0?e.jsx("button",{onClick:z,className:"rounded-md bg-accent px-4 py-2 text-sm font-medium text-white hover:bg-accent-light",children:"Clear Filters"}):e.jsx("button",{onClick:()=>x("/pipeline"),className:"rounded-md bg-accent px-4 py-2 text-sm font-medium text-white hover:bg-accent-light",children:"Run Pipeline"})}),!y&&h.length>0&&f==="table"&&e.jsx("div",{className:"overflow-x-auto rounded-lg border border-border bg-card",children:e.jsxs("table",{className:"w-full min-w-[1100px] text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border bg-surface",children:[e.jsx("th",{className:"w-10 px-2 py-2.5 text-left",children:e.jsx("input",{type:"checkbox",checked:n.size===h.length&&h.length>0,onChange:B,className:"rounded"})}),e.jsx("th",{className:"px-2 py-2.5 text-left font-medium text-secondary-text",children:"Title"}),e.jsx("th",{className:"whitespace-nowrap px-2 py-2.5 text-left font-medium text-secondary-text",children:"Citation"}),e.jsx("th",{className:"whitespace-nowrap px-2 py-2.5 text-left font-medium text-secondary-text",children:"Court"}),e.jsx("th",{className:"whitespace-nowrap px-2 py-2.5 text-left font-medium text-secondary-text",children:"Date"}),e.jsx("th",{className:"whitespace-nowrap px-2 py-2.5 text-left font-medium text-secondary-text",children:"Country"}),e.jsx("th",{className:"whitespace-nowrap px-2 py-2.5 text-left font-medium text-secondary-text",children:"Outcome"}),e.jsx("th",{className:"whitespace-nowrap px-2 py-2.5 text-left font-medium text-secondary-text",children:"Nature"})]})}),e.jsx("tbody",{ref:_,children:h.map((t,o)=>e.jsxs("tr",{className:D("border-b border-border-light transition-colors cursor-pointer",p===o?"bg-accent-muted":"hover:bg-surface/50",n.has(t.case_id)&&"bg-accent-muted/50"),onClick:()=>x(`/cases/${t.case_id}`),children:[e.jsx("td",{className:"w-10 px-2 py-2",onClick:r=>r.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:n.has(t.case_id),onChange:()=>O(t.case_id),className:"rounded"})}),e.jsxs("td",{className:"max-w-xs px-2 py-2",children:[e.jsx("span",{className:"block truncate font-medium text-foreground",title:t.title||t.citation,children:t.title||t.citation}),(t.applicant_name||t.judges)&&e.jsx("span",{className:"block truncate text-xs text-muted-text",title:t.applicant_name||t.judges,children:t.applicant_name?`Applicant: ${t.applicant_name}`:t.judges})]}),e.jsx("td",{className:"whitespace-nowrap px-2 py-2 text-xs text-muted-text",title:t.citation,children:t.citation}),e.jsx("td",{className:"whitespace-nowrap px-2 py-2",children:e.jsx(Y,{court:t.court_code})}),e.jsx("td",{className:"whitespace-nowrap px-2 py-2 text-xs text-muted-text",title:t.date,children:ge(t.date)}),e.jsx("td",{className:"whitespace-nowrap px-2 py-2 text-xs text-muted-text",children:t.country_of_origin||""}),e.jsx("td",{className:"whitespace-nowrap px-2 py-2",children:e.jsx(Z,{outcome:t.outcome})}),e.jsx("td",{className:"whitespace-nowrap px-2 py-2",children:e.jsx(ee,{nature:t.case_nature})})]},t.case_id))})]})}),!y&&h.length>0&&f==="cards"&&e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:h.map(t=>e.jsx(te,{case_:t,onClick:()=>x(`/cases/${t.case_id}`)},t.case_id))}),e.jsx(ce,{currentPage:V,totalPages:G,totalItems:A,pageSize:a.page_size??100,onPageChange:t=>d("page",String(t))}),e.jsx(ie,{open:I,title:"Delete Cases",message:`Are you sure you want to delete ${n.size} selected case${n.size>1?"s":""}? This action cannot be undone.`,confirmLabel:"Delete",variant:"danger",onConfirm:()=>R("delete"),onCancel:()=>C(!1)})]})}export{Me as CasesPage};
