import{j as e}from"./query-DQVcjD57.js";import{d as V}from"./use-legislations-CYPsaOj8.js";import{B as M}from"./Breadcrumb-wSQIylrK.js";import{r as x,j as D,u as U}from"./vendor-CxW-pF4z.js";import{c as O,S as R,X as z,a as y,u as $,B as F}from"./index-Cnpb2OEX.js";import{C as K,a as H}from"./chevron-up-BHLaLRH2.js";import{M as Z,a as G}from"./minimize-2-DMc6HBeI.js";import{C as X}from"./chevron-right-N6MYzFuX.js";import{E as q}from"./external-link-D8lGNDCe.js";import"./api-DED7AR2C.js";import"./charts-CKTqRh7i.js";const W=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],T=O("arrow-left",W);const Y=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],Q=O("link-2",Y),L=/^\s*\((\d+[A-Z]?)\)\s/,I=/^\s*\(([a-z]{1,2})\)\s/,_=/^\s*\((i{1,3}|iv|v{1,3}|vi{1,3}|ix|x{1,2})\)\s/i,J=/^\s*Note\s*\d*\s*:/i,ee=/^\s*Penalty\s*:/i,te=/^\s*Example\s*\d*\s*:/i,se=/^[A-Z][A-Z\s\d—–-]{4,80}$/;function re(t){return t.trim()?J.test(t)?"note":ee.test(t)?"penalty":te.test(t)?"example":_.test(t)?"subpara":I.test(t)?"paragraph":L.test(t)?"subsection":se.test(t.trim())?"heading":"body":"blank"}function ne(t){const s=new Map;for(const r of t)r.number&&s.set(r.number.trim().toLowerCase(),r.id);return s}const B=/\b(sections?\s+|subsections?\s+|paragraphs?\s+|s\.\s*)([A-Za-z]?\d[\d.A-Za-z]*(?:\([^)]*\))?)/g;function j(t,s,r){const a=[];let o=0,l;for(B.lastIndex=0;(l=B.exec(t))!==null;){const[n,i,m]=l,u=l.index;u>o&&a.push(t.slice(o,u));const h=m.trim().toLowerCase(),b=s.get(h);b?a.push(e.jsxs("button",{onClick:()=>r(b),className:"inline-flex items-center gap-0.5 rounded px-0.5 font-mono text-accent underline decoration-dotted underline-offset-2 hover:bg-accent/10 hover:decoration-solid",title:`Jump to section ${m}`,children:[e.jsx(Q,{className:"inline h-2.5 w-2.5 shrink-0 opacity-60"}),i,e.jsx("span",{className:"font-semibold",children:m})]},u)):a.push(n),o=u+n.length}return o<t.length&&a.push(t.slice(o)),a.length===0?t:e.jsx(e.Fragment,{children:a})}function ae(t,s,r,a,o){switch(s){case"blank":return e.jsx("div",{className:"h-1.5"},r);case"heading":return e.jsx("p",{className:"mt-4 mb-1 text-xs font-bold uppercase tracking-widest text-accent/80",children:t.trim()},r);case"subsection":{const l=t.replace(L,"").trimStart();return e.jsx("p",{className:"mt-2 font-mono text-xs leading-relaxed text-foreground whitespace-pre-wrap",children:l?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-1.5 font-bold text-accent",children:t.match(L)?.[0].trim()}),j(l,a,o)]}):t},r)}case"paragraph":{const l=t.replace(I,"").trimStart();return e.jsxs("p",{className:"ml-6 font-mono text-xs leading-relaxed text-foreground whitespace-pre-wrap",children:[e.jsx("span",{className:"mr-1 font-semibold text-secondary-text",children:t.match(I)?.[0].trim()}),j(l,a,o)]},r)}case"subpara":{const l=t.replace(_,"").trimStart();return e.jsxs("p",{className:"ml-12 font-mono text-xs leading-relaxed text-secondary-text whitespace-pre-wrap",children:[e.jsx("span",{className:"mr-1 text-muted-text",children:t.match(_)?.[0].trim()}),j(l,a,o)]},r)}case"note":return e.jsx("div",{className:"my-1.5 ml-4 rounded-r border-l-2 border-info/40 bg-info/5 px-3 py-1.5 font-mono text-xs text-secondary-text whitespace-pre-wrap",children:j(t,a,o)},r);case"penalty":return e.jsx("div",{className:"my-1.5 ml-4 rounded-r border-l-2 border-warning/50 bg-warning/5 px-3 py-1.5 font-mono text-xs font-semibold text-warning whitespace-pre-wrap",children:j(t,a,o)},r);case"example":return e.jsx("div",{className:"my-1.5 ml-4 rounded-r border-l-2 border-success/40 bg-success/5 px-3 py-1.5 font-mono text-xs text-secondary-text whitespace-pre-wrap",children:j(t,a,o)},r);default:return e.jsx("p",{className:"font-mono text-xs leading-relaxed text-foreground whitespace-pre-wrap",children:j(t,a,o)},r)}}function oe(t,s,r){return t.split(`
`).map((a,o)=>ae(a,re(a),o,s,r))}function le(t,s,r,a){if(!s||s.length<2)return e.jsx("pre",{className:"whitespace-pre-wrap font-mono text-xs leading-relaxed text-foreground",children:t});const o=t.toLowerCase(),l=s.toLowerCase(),n=[];let i=0,m=0,u=o.indexOf(l);for(;u!==-1;){u>i&&n.push(t.slice(i,u));const h=a+m;n.push(e.jsx("mark",{className:h===r?"active-match rounded-sm bg-warning px-0.5 text-foreground":"rounded-sm bg-warning/30 px-0.5",children:t.slice(u,u+s.length)},`m-${u}`)),i=u+s.length,m++,u=o.indexOf(l,i)}return i<t.length&&n.push(t.slice(i)),e.jsx("pre",{className:"whitespace-pre-wrap font-mono text-xs leading-relaxed text-foreground",children:n})}function ce(t){const s=[],r=new Map;for(const a of t){const o=a.part||"General Provisions",l=a.division||"";if(!r.has(o)){const i={part:o,divisions:new Map};r.set(o,i),s.push(i)}const n=r.get(o);n.divisions.has(l)||n.divisions.set(l,[]),n.divisions.get(l).push(a)}return s}function ie({sections:t,activeId:s,onJump:r,expanded:a}){const o=x.useMemo(()=>ce(t),[t]),[l,n]=x.useState(new Set),i=x.useCallback(m=>{n(u=>{const h=new Set(u);return h.has(m)?h.delete(m):h.add(m),h})},[]);return e.jsxs("nav",{className:y("overflow-y-auto border-r border-border bg-card",a?"max-h-none":"max-h-[680px]"),children:[e.jsx("p",{className:"sticky top-0 z-10 bg-card px-3 pt-3 pb-1.5 text-[10px] font-semibold uppercase tracking-wider text-muted-text",children:"Contents"}),e.jsx("div",{className:"pb-3",children:o.map(({part:m,divisions:u})=>{const h=l.has(m);return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>i(m),className:"flex w-full items-start gap-1 px-3 py-1.5 text-left hover:bg-surface",children:[e.jsx(X,{className:y("mt-0.5 h-3 w-3 shrink-0 text-muted-text transition-transform",!h&&"rotate-90")}),e.jsx("span",{className:"text-[11px] font-semibold leading-tight text-secondary-text",children:m})]}),!h&&Array.from(u.entries()).map(([b,w])=>e.jsxs("div",{children:[b&&e.jsx("p",{className:"ml-5 px-2 py-1 text-[10px] font-medium italic text-muted-text",children:b}),w.map(f=>{const v=s===f.id;return e.jsxs("button",{onClick:()=>r(f.id),className:y("w-full border-l-2 py-0.5 pr-2 pl-6 text-left text-[11px] leading-snug transition-colors",v?"border-accent bg-accent/5 font-medium text-accent":"border-transparent text-muted-text hover:bg-surface hover:text-foreground"),children:[e.jsx("span",{className:"font-mono text-[10px]",children:f.number}),f.title&&e.jsx("span",{className:"ml-1 opacity-80",children:f.title})]},f.id)})]},b||"__nodiv"))]},m)})})]})}function de({section:t,searchTerm:s,activeMatchIdx:r,matchOffsetBefore:a,searching:o,sectionMap:l,onJump:n}){return e.jsxs("div",{id:t.id,className:"scroll-mt-4 rounded-lg border border-border bg-card",children:[e.jsxs("div",{className:"flex items-baseline gap-2 border-b border-border px-4 py-2.5",children:[e.jsx("span",{className:"font-mono text-sm font-bold text-accent",children:t.number}),t.title&&e.jsx("span",{className:"font-heading text-sm font-semibold text-foreground",children:t.title}),t.part&&e.jsx("span",{className:"ml-auto shrink-0 rounded bg-surface px-1.5 py-0.5 text-[10px] text-muted-text",children:t.part.length>30?`${t.part.slice(0,30)}…`:t.part})]}),e.jsx("div",{className:"px-4 py-3",children:o&&s.length>=2?le(t.text,s,r,a):oe(t.text,l,n)})]})}function xe({sections:t}){const[s,r]=x.useState(""),[a,o]=x.useState(0),[l,n]=x.useState(!1),[i,m]=x.useState(!1),[u,h]=x.useState(t[0]?.id??null),b=x.useMemo(()=>ne(t),[t]),w=x.useRef(null),f=x.useRef(null),v=x.useMemo(()=>{if(!s||s.length<2)return t.map(()=>0);const c=s.toLowerCase();return t.map(d=>{const g=d.text.toLowerCase();let k=0,E=g.indexOf(c);for(;E!==-1;)k++,E=g.indexOf(c,E+1);return k})},[s,t]),p=x.useMemo(()=>v.reduce((c,d)=>c+d,0),[v]),P=x.useMemo(()=>{const c=[];let d=0;for(const g of v)c.push(d),d+=g;return c},[v]);x.useEffect(()=>{o(0)},[p]),x.useEffect(()=>{if(p===0)return;w.current?.querySelector(".active-match")?.scrollIntoView({block:"center",behavior:"smooth"})},[a,p]),x.useEffect(()=>{if(t.length===0)return;const c=new IntersectionObserver(d=>{const g=d.filter(k=>k.isIntersecting);g.length>0&&h(g[0].target.id)},{root:w.current,rootMargin:"0px 0px -70% 0px",threshold:0});return t.forEach(d=>{const g=document.getElementById(d.id);g&&c.observe(g)}),()=>c.disconnect()},[t,i]),x.useEffect(()=>{const c=d=>{(d.metaKey||d.ctrlKey)&&d.key==="f"&&(d.preventDefault(),n(!0),setTimeout(()=>f.current?.focus(),50)),d.key==="Escape"&&l&&(n(!1),r(""))};return document.addEventListener("keydown",c),()=>document.removeEventListener("keydown",c)},[l]);const S=x.useCallback(c=>{p!==0&&o(d=>(d+c+p)%p)},[p]),A=x.useCallback(c=>{document.getElementById(c)?.scrollIntoView({behavior:"smooth",block:"start"}),h(c)},[]),C=l&&s.length>=2;return e.jsxs("div",{className:"overflow-hidden rounded-lg border border-border bg-card",children:[e.jsxs("div",{className:"flex items-center gap-2 border-b border-border px-4 py-2",children:[e.jsx("h2",{className:"font-heading text-base font-semibold text-foreground",children:"Sections"}),e.jsx("span",{className:"ml-1 rounded-full bg-surface px-2 py-0.5 text-xs text-muted-text",children:t.length}),e.jsxs("div",{className:"ml-auto flex items-center gap-1.5",children:[l?e.jsxs("div",{className:"flex items-center gap-1 rounded-md border border-border bg-surface px-2 py-1",children:[e.jsx(R,{className:"h-3.5 w-3.5 text-muted-text"}),e.jsx("input",{ref:f,type:"text",value:s,onChange:c=>r(c.target.value),onKeyDown:c=>{c.key==="Enter"&&S(c.shiftKey?-1:1)},placeholder:"Search sections…",className:"w-44 bg-transparent text-sm text-foreground outline-none placeholder:text-muted-text"}),C&&p>0&&e.jsxs("span",{className:"whitespace-nowrap text-xs text-muted-text",children:[a+1,"/",p]}),C&&p===0&&s.length>=2&&e.jsx("span",{className:"whitespace-nowrap text-xs text-danger",children:"No results"}),e.jsx("button",{onClick:()=>S(-1),className:"p-0.5 text-muted-text hover:text-foreground",children:e.jsx(K,{className:"h-3.5 w-3.5"})}),e.jsx("button",{onClick:()=>S(1),className:"p-0.5 text-muted-text hover:text-foreground",children:e.jsx(H,{className:"h-3.5 w-3.5"})}),e.jsx("button",{onClick:()=>{n(!1),r("")},className:"p-0.5 text-muted-text hover:text-foreground",children:e.jsx(z,{className:"h-3.5 w-3.5"})})]}):e.jsx("button",{onClick:()=>{n(!0),setTimeout(()=>f.current?.focus(),50)},className:"rounded-md p-1.5 text-muted-text hover:bg-surface hover:text-foreground",title:"Search sections (⌘F)",children:e.jsx(R,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>m(!i),className:"rounded-md p-1.5 text-muted-text hover:bg-surface hover:text-foreground",title:i?"Collapse":"Expand",children:i?e.jsx(Z,{className:"h-4 w-4"}):e.jsx(G,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-56 flex-shrink-0",children:e.jsx(ie,{sections:t,activeId:u,onJump:A,expanded:i})}),e.jsx("div",{ref:w,className:y("flex-1 overflow-auto border-l border-border",i?"max-h-none":"max-h-[680px]"),children:e.jsx("div",{className:"space-y-3 p-4",children:t.map((c,d)=>e.jsx(de,{section:c,searchTerm:s,activeMatchIdx:a,matchOffsetBefore:P[d]??0,searching:C,sectionMap:b,onJump:A},c.id))})})]})]})}const me="https://www.austlii.edu.au/au/legis/cth";function N({label:t,value:s,mono:r}){return!s&&s!==0?null:e.jsxs("div",{children:[e.jsx("dt",{className:"text-xs font-medium text-secondary-text",children:t}),e.jsx("dd",{className:y("mt-0.5 text-sm text-foreground",r&&"font-mono text-xs"),children:s})]})}function ue({onUpdate:t}){return e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg border border-dashed border-border bg-card p-12 text-center",children:[e.jsx(F,{className:"mb-3 h-10 w-10 text-muted-text"}),e.jsx("h3",{className:"font-heading text-base font-semibold text-foreground",children:"Full text not yet downloaded"}),e.jsx("p",{className:"mt-1 text-sm text-secondary-text",children:'Click "Update Laws" on the legislations list to download section text from AustLII.'}),e.jsx("button",{onClick:t,className:"mt-4 rounded-md bg-accent px-4 py-2 text-sm font-medium text-accent-foreground hover:bg-accent/90",children:"Go to Legislations"})]})}function Se(){const{t}=$(),{id:s}=D(),r=U(),{data:a,isLoading:o,error:l}=V(s??null);if(l)return e.jsxs("div",{className:"space-y-4",children:[e.jsx(M,{items:[{label:t("common.dashboard"),href:"/"},{label:t("legislations.title",{defaultValue:"Legislations"}),href:"/legislations"},{label:t("common.not_found")}]}),e.jsxs("div",{className:"flex h-64 flex-col items-center justify-center rounded-lg border border-danger/30 bg-danger/5 p-8 text-center",children:[e.jsx("h2",{className:"font-heading text-lg font-semibold text-foreground",children:t("common.not_found")}),e.jsx("p",{className:"mt-2 text-sm text-secondary-text",children:t("legislations.not_found_description",{defaultValue:"This legislation could not be found"})}),e.jsxs("button",{onClick:()=>r("/legislations"),className:"mt-4 flex items-center gap-2 rounded-md bg-accent px-3 py-2 text-sm font-medium text-accent-foreground hover:bg-accent/90",children:[e.jsx(T,{className:"h-4 w-4"}),t("common.back")]})]})]});if(o||!a)return e.jsx("div",{className:"flex h-64 items-center justify-center text-muted-text",children:t("common.loading_ellipsis")});const n=a.data,i=n.sections??[],m=`${me}/${n.austlii_id}/`;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(M,{items:[{label:t("common.dashboard"),href:"/"},{label:t("legislations.title",{defaultValue:"Legislations"}),href:"/legislations"},{label:n.title}]}),e.jsxs("button",{onClick:()=>r("/legislations"),className:"flex items-center gap-2 rounded-md border border-border px-3 py-1.5 text-sm text-foreground hover:bg-surface",children:[e.jsx(T,{className:"h-3.5 w-3.5"}),t("common.back")]})]}),e.jsx("div",{className:"rounded-lg border border-border bg-card p-5",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"font-heading text-2xl font-semibold text-foreground",children:n.title}),n.description&&e.jsx("p",{className:"mt-2 text-sm leading-relaxed text-secondary-text",children:n.description})]}),n.shortcode&&e.jsx("div",{className:"shrink-0 rounded-md bg-accent/10 px-3 py-1.5 text-sm font-medium text-accent",children:n.shortcode})]})}),e.jsxs("div",{className:"rounded-lg border border-border bg-card p-5",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h2",{className:"font-heading text-base font-semibold text-foreground",children:t("legislations.information",{defaultValue:"Legislation Information"})}),e.jsxs("a",{href:m,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-xs text-accent hover:underline",children:[e.jsx(q,{className:"h-3 w-3"}),"AustLII"]})]}),e.jsxs("dl",{className:"grid gap-x-6 gap-y-2.5 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsx(N,{label:"Shortcode",value:n.shortcode,mono:!0}),e.jsx(N,{label:"AustLII ID",value:n.austlii_id,mono:!0}),e.jsx(N,{label:"Jurisdiction",value:n.jurisdiction}),e.jsx(N,{label:"Type",value:n.type}),e.jsx(N,{label:t("legislations.sections",{defaultValue:"Sections"}),value:n.sections_count||void 0}),e.jsx(N,{label:t("legislations.last_amended",{defaultValue:"Last Amended"}),value:n.last_amended||void 0}),e.jsx(N,{label:t("legislations.last_scraped",{defaultValue:"Last Scraped"}),value:n.last_scraped?new Date(n.last_scraped).toLocaleDateString("en-AU"):void 0})]})]}),i.length===0?e.jsx(ue,{onUpdate:()=>r("/legislations")}):e.jsx(xe,{sections:i})]})}export{Se as LegislationDetailPage};
