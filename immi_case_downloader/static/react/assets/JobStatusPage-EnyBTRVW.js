import{u as M,j as e}from"./query-DQVcjD57.js";import{u as q,r as d}from"./vendor-CxW-pF4z.js";import{f as P}from"./api-aTUBEVUX.js";import{c as k,u as R,S as z,F as _}from"./index-C09Lid14.js";import{D}from"./database-DEbe7Ffv.js";import{D as j}from"./download-PWp1J724.js";import{C as b}from"./clock-wDx_5H-L.js";import{L as A}from"./loader-circle-C7s95cA_.js";import{C as B,a as F}from"./circle-check-big-DpRAHeND.js";import{C as J,a as U}from"./chevron-up-BfQ7NQB_.js";import"./charts-CKTqRh7i.js";const K=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Q=k("arrow-right",K);const V=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],C=k("circle-x",V),X={search:{label:"Search",icon:z,color:"text-info"},download:{label:"Download",icon:j,color:"text-success"},"bulk download":{label:"Bulk Download",icon:j,color:"text-success"},update:{label:"Update DB",icon:D,color:"text-accent"}};function ce(){const{t}=R(),f=q(),[h,E]=d.useState(!1),[N]=d.useState(()=>Date.now()),[S,T]=d.useState(0),n=d.useRef(null),{data:a}=M({queryKey:["job-status"],queryFn:P,refetchInterval:s=>s.state.data?.running?2e3:5e3});if(d.useEffect(()=>(a?.running?n.current=setInterval(()=>{T(Math.floor((Date.now()-N)/1e3))},1e3):n.current&&(clearInterval(n.current),n.current=null),()=>{n.current&&clearInterval(n.current)}),[a?.running,N]),!a)return e.jsx("div",{className:"flex h-64 items-center justify-center text-muted-text",children:t("common.loading_ellipsis")});const r=a.running,v=a.type??"",i=X[v],$=i?.icon??_,m=a.total??0,p=a.completed??0,w=m>0?Math.round(p/m*100):0,x=a.errors??[],g=a.results??[],y=a.message??a.progress??"",o=!r&&(p>0||g.length>0),u=!r&&x.length>0&&!o,I=s=>{const c=Math.floor(s/60),l=s%60;return c>0?`${c}m ${l}s`:`${l}s`},L=[{label:"View Cases",icon:_,to:"/cases"},{label:"Dashboard",icon:D,to:"/"},{label:"Download",icon:j,to:"/download"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"h-6 w-6 text-accent"}),e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:t("pages.job_status.title")})]}),e.jsxs("div",{className:"rounded-lg border border-border bg-card p-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`rounded-full p-3 ${r?"bg-accent-muted":u?"bg-danger/10":o?"bg-success/10":"bg-surface"}`,children:r?e.jsx(A,{className:"h-8 w-8 animate-spin text-accent"}):u?e.jsx(C,{className:"h-8 w-8 text-danger"}):o?e.jsx(B,{className:"h-8 w-8 text-success"}):e.jsx(b,{className:"h-8 w-8 text-muted-text"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:t(r?"pages.job_status.job_running":u?"pages.job_status.job_failed":o?"pages.job_status.job_completed":"pages.job_status.no_active_job")}),v&&i&&e.jsxs("span",{className:`flex items-center gap-1 rounded-full bg-surface px-2.5 py-0.5 text-xs font-medium ${i.color}`,children:[e.jsx($,{className:"h-3 w-3"}),i.label]})]}),y&&e.jsx("p",{className:"mt-1 text-sm text-muted-text",children:y}),r&&e.jsxs("p",{className:"mt-1 flex items-center gap-1 text-xs text-muted-text",children:[e.jsx(b,{className:"h-3 w-3"})," ",t("pages.job_status.elapsed"),":"," ",I(S)]})]})]}),r&&m>0&&e.jsxs("div",{className:"mt-5",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-text",children:[p.toLocaleString()," / ",m.toLocaleString()]}),e.jsxs("span",{className:"font-mono text-foreground",children:[w,"%"]})]}),e.jsx("div",{className:"mt-1.5 h-3 rounded-full bg-surface",children:e.jsx("div",{className:"h-3 rounded-full bg-accent transition-all duration-300",style:{width:`${w}%`}})})]}),!r&&!o&&!u&&e.jsxs("div",{className:"mt-4 rounded-md bg-surface p-4 text-center",children:[e.jsx("p",{className:"text-sm text-muted-text",children:t("pages.job_status.no_job_running")}),e.jsx("div",{className:"mt-3 flex flex-wrap justify-center gap-2",children:[{label:"Download",to:"/download"},{label:"Pipeline",to:"/pipeline"}].map(s=>e.jsx("button",{onClick:()=>f(s.to),className:"rounded-md border border-border px-3 py-1.5 text-sm text-foreground hover:bg-card",children:s.label},s.to))})]})]}),g.length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-6",children:[e.jsx("h3",{className:"mb-4 font-heading text-lg font-semibold",children:t("pages.job_status.activity")}),e.jsx("div",{className:"space-y-3",children:g.slice(-10).reverse().map((s,c)=>e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1 h-2 w-2 shrink-0 rounded-full bg-accent"}),e.jsx("p",{className:"text-sm text-foreground",children:s})]},c))})]}),x.length>0&&e.jsxs("div",{className:"rounded-lg border border-danger/30 bg-card",children:[e.jsxs("button",{onClick:()=>E(!h),className:"flex w-full items-center justify-between p-4",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-danger",children:[e.jsx(F,{className:"h-4 w-4"})," ",t("pages.job_status.error_count",{count:x.length})]}),h?e.jsx(J,{className:"h-4 w-4 text-muted-text"}):e.jsx(U,{className:"h-4 w-4 text-muted-text"})]}),h&&e.jsx("div",{className:"max-h-60 overflow-auto border-t border-danger/20 p-4",children:e.jsx("div",{className:"space-y-1.5",children:x.map((s,c)=>e.jsxs("div",{className:"flex items-start gap-2 text-xs",children:[e.jsx(C,{className:"mt-0.5 h-3 w-3 shrink-0 text-danger"}),e.jsx("span",{className:"text-danger",children:s})]},c))})})]}),o&&!r&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-6",children:[e.jsx("h3",{className:"mb-3 font-heading text-lg font-semibold",children:t("pages.job_status.next_steps")}),e.jsx("div",{className:"grid gap-2 sm:grid-cols-4",children:L.map(({label:s,icon:c,to:l})=>e.jsxs("button",{onClick:()=>f(l),className:"flex items-center gap-3 rounded-lg border border-border p-3 text-left transition-all hover:border-accent hover:shadow-md",children:[e.jsx("div",{className:"rounded-md bg-accent-muted p-2 text-accent",children:e.jsx(c,{className:"h-4 w-4"})}),e.jsx("span",{className:"flex-1 text-sm font-medium text-foreground",children:s}),e.jsx(Q,{className:"h-4 w-4 text-muted-text"})]},l))})]})]})}export{ce as JobStatusPage};
