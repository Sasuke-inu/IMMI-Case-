/* ═══════════════════════════════════════════════════════════════════════
   IMMI-Case  ·  Professional Legal Design System
   Australian Immigration Case Manager
   ═══════════════════════════════════════════════════════════════════════ */

/* ── Light Theme Variables ──────────────────────────────────────────── */
:root {
  /* Primary palette — conservative navy & gold */
  --immi-primary: #1b2838;
  --immi-primary-light: #2a3f55;
  --immi-primary-lighter: #3a5572;
  --immi-accent: #b8860b;
  --immi-accent-light: #d4a017;
  --immi-accent-muted: rgba(184, 134, 11, 0.12);

  /* Backgrounds */
  --immi-bg: #f5f4f1;
  --immi-card-bg: #ffffff;
  --immi-sidebar-bg: #faf9f7;
  --immi-surface: #f0efec;

  /* Borders & lines */
  --immi-border: #e0ded8;
  --immi-border-light: #eae8e3;

  /* Text */
  --immi-text: #1b2838;
  --immi-text-secondary: #4a5568;
  --immi-muted: #8b8680;

  /* Semantic */
  --immi-success: #2d7d46;
  --immi-warning: #b8860b;
  --immi-danger: #a83232;
  --immi-info: #2a6496;

  /* Typography */
  --font-heading: 'Crimson Text', Georgia, 'Times New Roman', serif;
  --font-body: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  --font-mono: 'SF Mono', 'Fira Code', 'Consolas', monospace;

  /* Spacing (4px base) */
  --sp-1: 0.25rem;
  --sp-2: 0.5rem;
  --sp-3: 0.75rem;
  --sp-4: 1rem;
  --sp-5: 1.25rem;
  --sp-6: 1.5rem;
  --sp-8: 2rem;

  /* Radii */
  --radius-sm: 0.25rem;
  --radius: 0.375rem;
  --radius-lg: 0.5rem;
  --radius-pill: 2rem;

  /* Shadows */
  --shadow-xs: 0 1px 2px rgba(27, 40, 56, 0.04);
  --shadow-sm: 0 1px 3px rgba(27, 40, 56, 0.06), 0 1px 2px rgba(27, 40, 56, 0.04);
  --shadow: 0 2px 6px rgba(27, 40, 56, 0.08);
  --shadow-lg: 0 4px 12px rgba(27, 40, 56, 0.1);

  /* Transitions */
  --transition: 0.2s ease;
  --transition-slow: 0.3s ease;
}

/* ── Dark Theme Variables ───────────────────────────────────────────── */
[data-theme="dark"] {
  --immi-primary: #c9cdd3;
  --immi-primary-light: #a0aab5;
  --immi-primary-lighter: #8895a3;
  --immi-accent: #d4a017;
  --immi-accent-light: #e8b92e;
  --immi-accent-muted: rgba(212, 160, 23, 0.15);

  --immi-bg: #141a22;
  --immi-card-bg: #1b2332;
  --immi-sidebar-bg: #161d28;
  --immi-surface: #1e2737;

  --immi-border: #2a3545;
  --immi-border-light: #243040;

  --immi-text: #e0ddd8;
  --immi-text-secondary: #a0a8b4;
  --immi-muted: #6b7585;

  --immi-success: #3da55d;
  --immi-warning: #d4a017;
  --immi-danger: #d04848;
  --immi-info: #4a90c4;

  --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.2);
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.25);
  --shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
  --shadow-lg: 0 4px 12px rgba(0, 0, 0, 0.35);
}

/* Dark theme overrides for Bootstrap components */
[data-theme="dark"] .card { background: var(--immi-card-bg); border-color: var(--immi-border); }
[data-theme="dark"] .card-header { background: var(--immi-surface); border-color: var(--immi-border); color: var(--immi-text); }
[data-theme="dark"] .table { color: var(--immi-text); --bs-table-bg: transparent; --bs-table-hover-bg: rgba(255,255,255,0.03); }
[data-theme="dark"] .table thead { --bs-table-bg: var(--immi-surface); }
[data-theme="dark"] .form-control, [data-theme="dark"] .form-select {
  background: var(--immi-surface); border-color: var(--immi-border); color: var(--immi-text);
}
[data-theme="dark"] .form-control:focus, [data-theme="dark"] .form-select:focus {
  background: var(--immi-card-bg); border-color: var(--immi-accent); color: var(--immi-text);
}
[data-theme="dark"] .form-control::placeholder { color: var(--immi-muted); }
[data-theme="dark"] .btn-outline-secondary { color: var(--immi-text-secondary); border-color: var(--immi-border); }
[data-theme="dark"] .btn-outline-secondary:hover { background: var(--immi-surface); color: var(--immi-text); }
[data-theme="dark"] .btn-outline-primary { color: var(--immi-accent); border-color: var(--immi-accent); }
[data-theme="dark"] .btn-outline-primary:hover { background: var(--immi-accent); color: #fff; }
[data-theme="dark"] .breadcrumb-item a { color: var(--immi-accent); }
[data-theme="dark"] .breadcrumb-item.active { color: var(--immi-muted); }
[data-theme="dark"] .text-muted { color: var(--immi-muted) !important; }
[data-theme="dark"] .bg-light { background: var(--immi-surface) !important; }
[data-theme="dark"] .border { border-color: var(--immi-border) !important; }
[data-theme="dark"] .table-light { --bs-table-bg: var(--immi-surface); }
[data-theme="dark"] .progress { background: var(--immi-surface); }
[data-theme="dark"] .offcanvas { background: var(--immi-card-bg); color: var(--immi-text); }
[data-theme="dark"] .badge.bg-light { background: var(--immi-surface) !important; color: var(--immi-text) !important; }

/* ── Base ───────────────────────────────────────────────────────────── */
body {
  background: var(--immi-bg);
  color: var(--immi-text);
  font-family: var(--font-body);
  font-size: 0.9rem;
  line-height: 1.55;
  -webkit-font-smoothing: antialiased;
}

h1, h2, h3, h4, h5, h6,
.heading { font-family: var(--font-heading); font-weight: 600; letter-spacing: -0.01em; }

/* ── Accessibility ──────────────────────────────────────────────────── */
:focus-visible {
  outline: 2px solid var(--immi-accent);
  outline-offset: 2px;
}

.skip-link {
  position: absolute;
  top: -100%;
  left: var(--sp-4);
  z-index: 9999;
  background: var(--immi-accent);
  color: #fff;
  padding: var(--sp-2) var(--sp-4);
  border-radius: var(--radius);
  font-weight: 600;
}
.skip-link:focus { top: var(--sp-2); }

@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* ── Navbar ──────────────────────────────────────────────────────────── */
.immi-navbar {
  background: var(--immi-primary) !important;
  padding: 0.45rem 1rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
  border-bottom: 2px solid var(--immi-accent);
  position: sticky;
  top: 0;
  z-index: 1030;
}
[data-theme="dark"] .immi-navbar { background: #0f1520 !important; }

.immi-navbar .navbar-brand {
  font-family: var(--font-heading);
  font-weight: 700;
  letter-spacing: 0.02em;
  font-size: 1.2rem;
}
.immi-navbar .navbar-brand i { font-size: 1.1rem; color: var(--immi-accent-light); }

/* Global search in navbar */
.global-search { max-width: 360px; position: relative; }
.global-search .form-control {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.15);
  color: #fff;
  font-size: 0.82rem;
  border-radius: var(--radius-pill);
  padding: 0.35rem 1rem 0.35rem 2.2rem;
  transition: var(--transition);
}
.global-search .form-control::placeholder { color: rgba(255, 255, 255, 0.5); }
.global-search .form-control:focus {
  background: rgba(255, 255, 255, 0.95);
  color: var(--immi-text);
  border-color: var(--immi-accent);
  box-shadow: 0 0 0 0.2rem rgba(184, 134, 11, 0.2);
}
.global-search .form-control:focus::placeholder { color: var(--immi-muted); }
.global-search .search-icon {
  position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%);
  color: rgba(255, 255, 255, 0.5); font-size: 0.82rem; pointer-events: none; z-index: 5;
}
.global-search .form-control:focus ~ .search-icon { color: var(--immi-muted); }
.global-search .kbd-hint {
  position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%);
  font-size: 0.62rem; background: rgba(255, 255, 255, 0.12); border-radius: 0.2rem;
  padding: 1px 6px; color: rgba(255, 255, 255, 0.4); pointer-events: none;
  font-family: var(--font-mono);
}
.global-search .form-control:focus ~ .kbd-hint { display: none; }

/* Mobile search toggle */
.mobile-search-toggle {
  background: none; border: none; color: rgba(255,255,255,0.8);
  font-size: 1.1rem; padding: 0.25rem 0.5rem;
}
.mobile-search-toggle:hover { color: #fff; }
.mobile-search-bar {
  display: none; padding: 0.5rem 1rem; background: var(--immi-primary);
  border-top: 1px solid rgba(255,255,255,0.08);
}
.mobile-search-bar.show { display: block; }
.mobile-search-bar .form-control {
  background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.15);
  color: #fff; font-size: 0.85rem; border-radius: var(--radius-pill);
  padding: 0.4rem 1rem;
}
.mobile-search-bar .form-control::placeholder { color: rgba(255,255,255,0.5); }
.mobile-search-bar .form-control:focus {
  background: rgba(255,255,255,0.9); color: var(--immi-text);
  border-color: var(--immi-accent);
}

/* Job indicator pill */
.job-indicator {
  display: inline-flex; align-items: center; gap: 0.35rem;
  background: rgba(255, 255, 255, 0.1); border-radius: var(--radius-pill);
  padding: 0.25rem 0.75rem; font-size: 0.76rem; color: rgba(255, 255, 255, 0.85);
  text-decoration: none; transition: var(--transition);
}
.job-indicator:hover { background: rgba(255, 255, 255, 0.18); color: #fff; }
.job-indicator .spinner-grow { width: 0.55rem; height: 0.55rem; }

/* Dark mode toggle */
.theme-toggle {
  background: none; border: 1px solid rgba(255,255,255,0.15);
  color: rgba(255,255,255,0.7); border-radius: var(--radius);
  padding: 0.2rem 0.45rem; font-size: 0.95rem; cursor: pointer;
  transition: var(--transition); line-height: 1;
}
.theme-toggle:hover { background: rgba(255,255,255,0.1); color: #fff; border-color: rgba(255,255,255,0.25); }

/* ── Sidebar ─────────────────────────────────────────────────────────── */
.immi-sidebar {
  min-height: calc(100vh - 54px);
  background: var(--immi-sidebar-bg);
  border-right: 1px solid var(--immi-border);
  padding-top: var(--sp-4);
  position: sticky;
  top: 54px;
  overflow-y: auto;
  max-height: calc(100vh - 54px);
}
.immi-sidebar .nav-link {
  color: var(--immi-text-secondary);
  padding: 0.5rem 0.85rem;
  border-radius: 0;
  border-left: 3px solid transparent;
  margin: 1px 0;
  font-size: 0.85rem;
  display: flex;
  align-items: center;
  transition: var(--transition);
  text-decoration: none;
}
.immi-sidebar .nav-link i { width: 22px; font-size: 0.9rem; opacity: 0.6; }
.immi-sidebar .nav-link:hover {
  background: var(--immi-accent-muted);
  color: var(--immi-accent);
  border-left-color: var(--immi-accent);
}
.immi-sidebar .nav-link:hover i { opacity: 1; }
.immi-sidebar .nav-link.active {
  background: var(--immi-accent-muted);
  color: var(--immi-accent);
  border-left-color: var(--immi-accent);
  font-weight: 600;
}
.immi-sidebar .nav-link.active i { opacity: 1; color: var(--immi-accent); }
.immi-sidebar .sidebar-section {
  font-size: 0.65rem;
  text-transform: uppercase;
  letter-spacing: 0.1em;
  color: var(--immi-muted);
  padding: 0.75rem 0.85rem 0.2rem;
  margin-top: 0.25rem;
  border-top: 1px solid var(--immi-border-light);
}
.immi-sidebar .sidebar-section:first-child { border-top: none; margin-top: 0; }

/* Mobile bottom nav */
.mobile-nav {
  position: fixed; bottom: 0; left: 0; right: 0; z-index: 1030;
  background: var(--immi-card-bg);
  border-top: 1px solid var(--immi-border);
  box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.06);
  display: flex; justify-content: space-around; padding: 0.3rem 0;
}
.mobile-nav a {
  display: flex; flex-direction: column; align-items: center;
  font-size: 0.62rem; color: var(--immi-muted); text-decoration: none;
  padding: 0.25rem 0.5rem; transition: var(--transition);
}
.mobile-nav a i { font-size: 1.1rem; margin-bottom: 0.1rem; }
.mobile-nav a.active, .mobile-nav a:hover { color: var(--immi-accent); }
@media (min-width: 768px) { .mobile-nav { display: none; } }
@media (max-width: 767px) { main { padding-bottom: 4rem !important; } }

/* ── Cards ───────────────────────────────────────────────────────────── */
.card {
  border: 1px solid var(--immi-border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-xs);
  background: var(--immi-card-bg);
}
.card-header {
  background: var(--immi-surface);
  font-weight: 600;
  font-size: 0.88rem;
  font-family: var(--font-heading);
  border-bottom: 1px solid var(--immi-border);
  color: var(--immi-text);
}

/* Stat cards */
.stat-card {
  border-left: 4px solid;
  transition: box-shadow var(--transition);
  cursor: default;
}
.stat-card:hover { box-shadow: var(--shadow-sm); }
.stat-card .stat-value {
  font-size: 1.75rem;
  font-weight: 700;
  font-family: var(--font-heading);
  line-height: 1.2;
  color: var(--immi-text);
}
.stat-card .stat-label {
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: var(--immi-muted);
}
.stat-card .stat-icon { font-size: 2rem; opacity: 0.12; }
.stat-card.blue { border-color: var(--immi-info); }
.stat-card.green { border-color: var(--immi-success); }
.stat-card.orange { border-color: var(--immi-warning); }
.stat-card.red { border-color: var(--immi-danger); }
.stat-card.purple { border-color: #6b4c8a; }

/* ── Court Badges (border-style) ─────────────────────────────────────── */
.badge-court {
  font-size: 0.68rem; font-weight: 600; letter-spacing: 0.04em;
  padding: 0.2em 0.5em; border-radius: var(--radius-sm);
  background: transparent;
}
.badge-AATA  { border: 1.5px solid #7c3aad; color: #7c3aad; }
.badge-ARTA  { border: 1.5px solid #5b21b6; color: #5b21b6; }
.badge-FCA   { border: 1.5px solid #2a6496; color: #2a6496; }
.badge-FCCA  { border: 1.5px solid #1a7a6a; color: #1a7a6a; }
.badge-FedCFamC2G { border: 1.5px solid #2d7d46; color: #2d7d46; }
.badge-HCA   { border: 1.5px solid #a83232; color: #a83232; }
.badge-RRTA  { border: 1.5px solid #b35900; color: #b35900; }
.badge-MRTA  { border: 1.5px solid #c07600; color: #c07600; }

[data-theme="dark"] .badge-AATA  { border-color: #b07ed8; color: #b07ed8; }
[data-theme="dark"] .badge-ARTA  { border-color: #a78bfa; color: #a78bfa; }
[data-theme="dark"] .badge-FCA   { border-color: #5a9fd4; color: #5a9fd4; }
[data-theme="dark"] .badge-FCCA  { border-color: #3ab5a0; color: #3ab5a0; }
[data-theme="dark"] .badge-FedCFamC2G { border-color: #4caf6a; color: #4caf6a; }
[data-theme="dark"] .badge-HCA   { border-color: #e06060; color: #e06060; }
[data-theme="dark"] .badge-RRTA  { border-color: #e08030; color: #e08030; }
[data-theme="dark"] .badge-MRTA  { border-color: #daa020; color: #daa020; }

/* ── Case Nature Badges (border-style) ──────────────────────────────── */
.badge-nature {
  font-size: 0.68rem; font-weight: 600; letter-spacing: 0.03em;
  padding: 0.2em 0.5em; border-radius: var(--radius-sm);
  background: transparent;
}
.badge-nature-merits-review    { border: 1.5px solid #2a6496; color: #2a6496; }
.badge-nature-judicial-review  { border: 1.5px solid #5b2c6f; color: #5b2c6f; }
.badge-nature-appeal           { border: 1.5px solid #7c3aad; color: #7c3aad; }
.badge-nature-visa-cancellation { border: 1.5px solid #a83232; color: #a83232; }
.badge-nature-visa-refusal     { border: 1.5px solid #b35900; color: #b35900; }
.badge-nature-detention-challenge { border: 1.5px solid #2c3e50; color: #2c3e50; }
.badge-nature-deportation      { border: 1.5px solid #7a2020; color: #7a2020; }
.badge-nature-constitutional   { border: 1.5px solid #8b7000; color: #8b7000; }
.badge-nature-other            { border: 1.5px solid #6b7585; color: #6b7585; }

[data-theme="dark"] .badge-nature-merits-review    { border-color: #5a9fd4; color: #5a9fd4; }
[data-theme="dark"] .badge-nature-judicial-review  { border-color: #b07ed8; color: #b07ed8; }
[data-theme="dark"] .badge-nature-appeal           { border-color: #c090e0; color: #c090e0; }
[data-theme="dark"] .badge-nature-visa-cancellation { border-color: #e06060; color: #e06060; }
[data-theme="dark"] .badge-nature-visa-refusal     { border-color: #e08030; color: #e08030; }
[data-theme="dark"] .badge-nature-detention-challenge { border-color: #7090b0; color: #7090b0; }
[data-theme="dark"] .badge-nature-deportation      { border-color: #d05050; color: #d05050; }
[data-theme="dark"] .badge-nature-constitutional   { border-color: #d4a017; color: #d4a017; }
[data-theme="dark"] .badge-nature-other            { border-color: #8895a3; color: #8895a3; }

/* Legal concept tags */
.concept-tag {
  display: inline-block; font-size: 0.72rem; padding: 0.18em 0.55em;
  background: var(--immi-accent-muted); color: var(--immi-accent);
  border: 1px solid rgba(184, 134, 11, 0.2);
  border-radius: var(--radius-pill); text-decoration: none;
  margin: 0.15rem 0.1rem; transition: var(--transition);
}
.concept-tag:hover { background: var(--immi-accent); color: #fff; border-color: var(--immi-accent); }

/* ── Outcome Badges ──────────────────────────────────────────────────── */
.badge-outcome { font-size: 0.7rem; padding: 0.18em 0.5em; font-weight: 600; border-radius: var(--radius-sm); }
.badge-outcome.affirm, .badge-outcome.dismiss {
  background: transparent; border: 1.5px solid var(--immi-danger); color: var(--immi-danger);
}
.badge-outcome.setaside, .badge-outcome.allow, .badge-outcome.remit {
  background: transparent; border: 1.5px solid var(--immi-success); color: var(--immi-success);
}
.badge-outcome.unknown {
  background: transparent; border: 1.5px solid var(--immi-muted); color: var(--immi-muted);
}

/* ── Browse Table ────────────────────────────────────────────────────── */
.table-cases th {
  font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.05em;
  color: var(--immi-muted); border-bottom: 2px solid var(--immi-border);
  white-space: nowrap; padding: 0.55rem 0.75rem;
  font-family: var(--font-body);
}
.table-cases td { font-size: 0.84rem; vertical-align: middle; padding: 0.5rem 0.75rem; }
.table-cases tbody tr { transition: background var(--transition); }
.table-cases tbody tr:hover { background: var(--immi-accent-muted); }
.table-cases .title-cell { max-width: 350px; }
.table-cases .title-cell .title-text {
  display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.table-cases .title-cell .title-text:hover { white-space: normal; }

/* Row inline preview */
.case-preview-row td { background: var(--immi-surface); padding: 0.5rem 1rem; font-size: 0.82rem; }
.case-preview-row .preview-content { max-height: 120px; overflow: hidden; }

/* ── Mobile Case Cards ───────────────────────────────────────────────── */
.case-card-mobile {
  border: 1px solid var(--immi-border);
  border-radius: var(--radius-lg);
  padding: var(--sp-3);
  background: var(--immi-card-bg);
  margin-bottom: var(--sp-2);
  transition: var(--transition);
}
.case-card-mobile:hover { box-shadow: var(--shadow-sm); }
.case-card-mobile .case-card-citation {
  font-family: var(--font-heading);
  font-weight: 600;
  font-size: 0.9rem;
  color: var(--immi-info);
  text-decoration: none;
}
.case-card-mobile .case-card-title {
  font-size: 0.8rem;
  color: var(--immi-text-secondary);
  margin-top: var(--sp-1);
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
.case-card-mobile .case-card-meta {
  display: flex; flex-wrap: wrap; gap: var(--sp-2);
  margin-top: var(--sp-2);
  align-items: center;
}

/* ── Filters Bar ─────────────────────────────────────────────────────── */
.filter-bar {
  background: var(--immi-card-bg);
  border: 1px solid var(--immi-border);
  border-radius: var(--radius-lg);
}
.filter-bar .form-label {
  font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.05em;
  color: var(--immi-muted); margin-bottom: 0.1rem;
}
.filter-bar .form-control, .filter-bar .form-select { font-size: 0.82rem; }
.filter-bar .active-filters { display: flex; flex-wrap: wrap; gap: 0.35rem; }
.filter-pill {
  display: inline-flex; align-items: center; gap: 0.3rem;
  background: var(--immi-accent-muted); color: var(--immi-accent);
  border: 1px solid rgba(184, 134, 11, 0.2);
  border-radius: var(--radius-pill); padding: 0.12rem 0.55rem; font-size: 0.72rem;
}
.filter-pill .btn-close { font-size: 0.45rem; }

/* Collapsible advanced filters */
.filter-toggle-btn { font-size: 0.78rem; }

/* ── Batch Operations ────────────────────────────────────────────────── */
.batch-bar {
  position: fixed; bottom: 0; left: 0; right: 0; z-index: 1020;
  background: var(--immi-primary); color: #fff;
  padding: var(--sp-3) var(--sp-4);
  display: flex; align-items: center; gap: var(--sp-4);
  box-shadow: 0 -4px 16px rgba(0, 0, 0, 0.15);
  transform: translateY(100%); transition: transform 0.25s ease;
}
.batch-bar.show { transform: translateY(0); }
.batch-bar .batch-count { font-weight: 600; font-family: var(--font-heading); }
.batch-checkbox { width: 16px; height: 16px; accent-color: var(--immi-accent); cursor: pointer; }

/* ── Case Detail Page ────────────────────────────────────────────────── */
.case-hero {
  background: var(--immi-surface);
  border: 1px solid var(--immi-border);
  border-radius: var(--radius-lg);
  padding: var(--sp-6);
  margin-bottom: var(--sp-6);
}
.case-hero .citation-display {
  font-size: 1.5rem;
  font-family: var(--font-heading);
  font-weight: 700;
  color: var(--immi-text);
  display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap;
}
.case-hero .case-title { font-size: 0.95rem; color: var(--immi-text-secondary); margin-top: 0.35rem; }

.copy-btn {
  background: none; border: 1px solid var(--immi-border); border-radius: var(--radius-sm);
  padding: 0.2rem 0.4rem; font-size: 0.72rem; color: var(--immi-muted);
  cursor: pointer; transition: var(--transition);
}
.copy-btn:hover { background: var(--immi-accent); color: #fff; border-color: var(--immi-accent); }
.copy-btn.copied { background: var(--immi-success); color: #fff; border-color: var(--immi-success); }

.meta-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 0.75rem; }
.meta-item {
  padding: 0.6rem;
  background: var(--immi-surface);
  border-radius: var(--radius);
  border-left: 3px solid var(--immi-accent);
}
.meta-item .meta-label {
  font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.05em;
  color: var(--immi-muted); margin-bottom: 0.1rem;
}
.meta-item .meta-value { font-size: 0.88rem; font-weight: 500; color: var(--immi-text); }

/* Case text viewer */
.case-text-viewer {
  position: relative; border: 1px solid var(--immi-border);
  border-radius: var(--radius-lg); overflow: hidden;
}
.case-text-viewer .text-toolbar {
  display: flex; align-items: center; gap: 0.5rem;
  background: var(--immi-surface); padding: 0.4rem 0.75rem;
  border-bottom: 1px solid var(--immi-border); font-size: 0.82rem;
}
.case-text-viewer .text-toolbar input {
  flex: 1; max-width: 260px; font-size: 0.82rem;
  border: 1px solid var(--immi-border); border-radius: var(--radius);
  padding: 0.25rem 0.5rem; background: var(--immi-card-bg); color: var(--immi-text);
}
.case-text-viewer .text-content {
  max-height: 600px; overflow-y: auto;
  padding: 1.25rem 1.5rem;
  font-family: Georgia, 'Times New Roman', serif;
  font-size: 0.92rem;
  line-height: 1.8;
  white-space: pre-wrap;
  background: var(--immi-card-bg);
  color: var(--immi-text);
}
.case-text-viewer .text-content mark {
  background: rgba(184, 134, 11, 0.25);
  border-radius: 2px;
  padding: 0 2px;
}
[data-theme="dark"] .case-text-viewer .text-content mark { background: rgba(212, 160, 23, 0.3); }

/* ── Search Page ─────────────────────────────────────────────────────── */
.source-card {
  border: 2px solid var(--immi-border);
  border-radius: var(--radius-lg);
  padding: 0.75rem;
  transition: var(--transition);
  cursor: pointer;
  background: var(--immi-card-bg);
}
.source-card:hover { border-color: var(--immi-accent); background: var(--immi-accent-muted); }
.source-card.selected { border-color: var(--immi-accent); background: var(--immi-accent-muted); }
.source-card input[type="checkbox"] { display: none; }
.source-card .source-code { font-weight: 700; font-size: 0.9rem; color: var(--immi-text); }
.source-card .source-name { font-size: 0.8rem; color: var(--immi-text-secondary); }
.source-card .source-desc { font-size: 0.72rem; color: var(--immi-muted); }
.source-card .check-icon {
  width: 20px; height: 20px; border-radius: 50%;
  border: 2px solid var(--immi-border); display: flex;
  align-items: center; justify-content: center; transition: var(--transition);
}
.source-card.selected .check-icon {
  background: var(--immi-accent); border-color: var(--immi-accent); color: #fff;
}

/* ── Completion Ring (Download) ──────────────────────────────────────── */
.completion-ring { position: relative; width: 140px; height: 140px; }
.completion-ring svg { transform: rotate(-90deg); }
.completion-ring .ring-bg { fill: none; stroke: var(--immi-border); stroke-width: 8; }
.completion-ring .ring-progress {
  fill: none; stroke: var(--immi-accent); stroke-width: 8;
  stroke-linecap: round; transition: stroke-dashoffset 0.5s ease;
}
.completion-ring .ring-text {
  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
  text-align: center;
}
.completion-ring .ring-pct {
  font-size: 1.5rem; font-weight: 700;
  font-family: var(--font-heading);
  color: var(--immi-text);
}
.completion-ring .ring-label { font-size: 0.68rem; color: var(--immi-muted); }

/* ── Pipeline Phase Indicators ───────────────────────────────────────── */
.phase-indicator {
  width: 48px; height: 48px; border-radius: 50%;
  display: inline-flex; align-items: center; justify-content: center;
  font-size: 1.2rem; transition: var(--transition);
}
.phase-indicator.completed { background: var(--immi-success); color: #fff; }
.phase-indicator.active { background: var(--immi-info); color: #fff; }
.phase-indicator.pending { background: var(--immi-surface); color: var(--immi-muted); border: 1px solid var(--immi-border); }

/* ── Job Status ──────────────────────────────────────────────────────── */
.job-timeline .timeline-item {
  display: flex; gap: 0.75rem; padding: 0.35rem 0; font-size: 0.82rem;
}
.job-timeline .timeline-dot {
  width: 8px; height: 8px; border-radius: 50%; margin-top: 0.35rem; flex-shrink: 0;
}
.job-timeline .timeline-dot.success { background: var(--immi-success); }
.job-timeline .timeline-dot.error { background: var(--immi-danger); }
.job-timeline .timeline-dot.pending { background: var(--immi-border); }

/* ── Onboarding / Empty States ───────────────────────────────────────── */
.empty-state { text-align: center; padding: 3rem 1rem; }
.empty-state .empty-icon { font-size: 3rem; color: var(--immi-border); margin-bottom: 1rem; }
.empty-state h4, .empty-state h5 { font-family: var(--font-heading); font-weight: 600; color: var(--immi-text); }
.empty-state p { color: var(--immi-muted); max-width: 400px; margin: 0 auto; }

.onboarding-steps {
  display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-top: 1.5rem;
}
.onboarding-step {
  flex: 1; min-width: 180px; max-width: 220px;
  border: 2px solid var(--immi-border); border-radius: var(--radius-lg);
  padding: 1.25rem 1rem; text-align: center; text-decoration: none;
  color: var(--immi-text); transition: var(--transition);
  background: var(--immi-card-bg);
}
.onboarding-step:hover { border-color: var(--immi-accent); box-shadow: var(--shadow-sm); color: var(--immi-text); }
.onboarding-step .step-num {
  width: 28px; height: 28px; border-radius: 50%; background: var(--immi-accent);
  color: #fff; display: inline-flex; align-items: center; justify-content: center;
  font-size: 0.8rem; font-weight: 700; margin-bottom: 0.5rem;
}
.onboarding-step .step-title { font-weight: 600; font-size: 0.9rem; font-family: var(--font-heading); }
.onboarding-step .step-desc { font-size: 0.75rem; color: var(--immi-muted); margin-top: 0.25rem; }

/* ── Flash / Toast Messages ──────────────────────────────────────────── */
.toast-container {
  position: fixed; top: 62px; right: 1rem; z-index: 1060;
  display: flex; flex-direction: column; gap: 0.5rem;
}
.toast-msg {
  min-width: 300px; max-width: 420px; padding: 0.7rem 1rem;
  border-radius: var(--radius-lg); box-shadow: var(--shadow-lg);
  display: flex; align-items: flex-start; gap: 0.5rem;
  animation: slideIn 0.3s ease; font-size: 0.85rem;
  background: var(--immi-card-bg); color: var(--immi-text);
}
.toast-msg.success { border-left: 4px solid var(--immi-success); }
.toast-msg.error, .toast-msg.danger { border-left: 4px solid var(--immi-danger); }
.toast-msg.warning { border-left: 4px solid var(--immi-warning); }
.toast-msg.info { border-left: 4px solid var(--immi-info); }
.toast-msg .toast-icon { font-size: 1rem; margin-top: 1px; }
.toast-msg .btn-close { font-size: 0.55rem; margin-left: auto; }

@keyframes slideIn {
  from { opacity: 0; transform: translateX(30px); }
  to { opacity: 1; transform: translateX(0); }
}

/* ── Data Dictionary ─────────────────────────────────────────────────── */
.dict-section .card-header { font-weight: 600; font-family: var(--font-heading); }
.dict-section code { background: var(--immi-accent-muted); color: var(--immi-accent); padding: 0.1rem 0.35rem; border-radius: var(--radius-sm); font-size: 0.8rem; }
[data-theme="dark"] .dict-section code { background: rgba(212, 160, 23, 0.12); }

.stage-badge {
  display: inline-flex; align-items: center; gap: 0.3rem;
  padding: 0.25rem 0.6rem; border-radius: var(--radius-pill);
  font-size: 0.72rem; font-weight: 600;
}
.stage-badge.search { background: rgba(42, 100, 150, 0.1); color: var(--immi-info); border: 1px solid rgba(42, 100, 150, 0.2); }
.stage-badge.download { background: rgba(184, 134, 11, 0.1); color: var(--immi-warning); border: 1px solid rgba(184, 134, 11, 0.2); }
.stage-badge.user { background: rgba(45, 125, 70, 0.1); color: var(--immi-success); border: 1px solid rgba(45, 125, 70, 0.2); }
.stage-badge.postprocess { background: rgba(124, 58, 173, 0.1); color: #7c3aad; border: 1px solid rgba(124, 58, 173, 0.2); }

/* Dict section anchor links */
.dict-anchor-nav {
  position: sticky; top: 62px;
  font-size: 0.78rem;
}
.dict-anchor-nav a {
  display: block; padding: 0.3rem 0.6rem;
  color: var(--immi-text-secondary); text-decoration: none;
  border-left: 2px solid transparent;
  transition: var(--transition);
}
.dict-anchor-nav a:hover, .dict-anchor-nav a.active {
  color: var(--immi-accent); border-left-color: var(--immi-accent);
  background: var(--immi-accent-muted);
}

/* ── Form Validation ─────────────────────────────────────────────────── */
.form-control:user-invalid, .form-select:user-invalid {
  border-color: var(--immi-danger);
}
.form-control:user-valid, .form-select:user-valid {
  border-color: var(--immi-success);
}
.was-validated .form-control:invalid, .was-validated .form-select:invalid {
  border-color: var(--immi-danger);
  box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.15);
}
.was-validated .form-control:valid, .was-validated .form-select:valid {
  border-color: var(--immi-success);
}
.was-validated .invalid-feedback { color: var(--immi-danger); font-size: 0.78rem; }

/* ── Delete Confirmation Modal ───────────────────────────────────────── */
.delete-modal .modal-header { background: var(--immi-surface); border-bottom-color: var(--immi-border); }
.delete-modal .modal-footer { background: var(--immi-surface); border-top-color: var(--immi-border); }
[data-theme="dark"] .modal-content { background: var(--immi-card-bg); color: var(--immi-text); }

/* ── Keyboard Shortcuts Help Modal ───────────────────────────────────── */
.shortcuts-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;
}
.shortcut-item {
  display: flex; align-items: center; gap: 0.5rem; padding: 0.35rem 0;
  font-size: 0.82rem;
}
.shortcut-key {
  display: inline-flex; align-items: center; justify-content: center;
  min-width: 28px; height: 24px; padding: 0 0.4rem;
  background: var(--immi-surface); border: 1px solid var(--immi-border);
  border-radius: var(--radius-sm); font-family: var(--font-mono);
  font-size: 0.72rem; font-weight: 600; color: var(--immi-text-secondary);
}

/* ── Utility Classes ─────────────────────────────────────────────────── */
.text-truncate-2 {
  display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
  overflow: hidden;
}
.fade-in { animation: fadeIn 0.35s ease; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.text-accent { color: var(--immi-accent) !important; }
.bg-accent-muted { background: var(--immi-accent-muted) !important; }
.border-accent { border-color: var(--immi-accent) !important; }
.font-serif { font-family: var(--font-heading) !important; }

/* Coverage matrix warm alternating rows */
.coverage-matrix tbody tr:nth-child(even) { background: var(--immi-surface); }
.coverage-matrix tbody tr:hover { background: var(--immi-accent-muted); }

/* ── Related Cases Grid ───────────────────────────────────────────── */
.related-cases-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 1px;
  background: var(--immi-border-light);
}
.related-case-card {
  display: block;
  padding: var(--sp-3) var(--sp-4);
  background: var(--immi-card-bg);
  color: var(--immi-text);
  transition: background 0.15s;
}
.related-case-card:hover {
  background: var(--immi-surface);
  color: var(--immi-text);
}
.related-case-citation {
  font-family: var(--font-heading);
  font-weight: 600;
  font-size: 0.85rem;
  margin-bottom: 2px;
}
.related-case-title {
  font-size: 0.78rem;
  color: var(--immi-text-secondary);
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  margin-bottom: 4px;
}
.related-case-meta {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  align-items: center;
}

/* ── Case Compare ─────────────────────────────────────────────────── */
.compare-table th { background: var(--immi-surface); font-weight: 600; white-space: nowrap; width: 130px; }
.compare-table td { vertical-align: top; }
.compare-table .diff-highlight { background: rgba(184, 134, 11, 0.08); }

/* ── Enhanced Text Search (augments .case-text-viewer rules) ─────── */
.case-text-viewer .text-toolbar { flex-wrap: wrap; }
.case-text-viewer .text-toolbar .nav-btn {
  background: none;
  border: 1px solid var(--immi-border);
  border-radius: var(--radius);
  padding: 1px 6px;
  font-size: 0.75rem;
  cursor: pointer;
  color: var(--immi-text-secondary);
  line-height: 1.4;
}
.case-text-viewer .text-toolbar .nav-btn:hover { background: var(--immi-border-light); }
.case-text-viewer .text-toolbar .nav-btn:disabled { opacity: 0.4; cursor: default; }
.case-text-viewer .text-content mark.active-match {
  background: var(--immi-accent-light);
  outline: 2px solid var(--immi-accent);
}

/* ── Legal Text Section Headings ──────────────────────────────────── */
.case-text-viewer .text-content .section-heading {
  font-weight: 700;
  font-size: 0.95rem;
  color: var(--immi-primary);
  margin-top: 1.5em;
  margin-bottom: 0.3em;
  text-transform: uppercase;
  letter-spacing: 0.02em;
  border-bottom: 1px solid var(--immi-border-light);
  padding-bottom: 2px;
}
[data-theme="dark"] .case-text-viewer .text-content .section-heading {
  color: var(--immi-accent-light);
}

/* Expand/collapse toggle for long texts */
.text-expand-toggle {
  display: flex;
  justify-content: center;
  padding: var(--sp-2);
  border-top: 1px solid var(--immi-border-light);
  background: linear-gradient(to bottom, transparent, var(--immi-surface));
}
.text-expand-toggle button {
  font-size: 0.78rem;
  color: var(--immi-accent);
  background: none;
  border: 1px solid var(--immi-accent-muted);
  border-radius: var(--radius);
  padding: 2px 12px;
  cursor: pointer;
}
.text-expand-toggle button:hover { background: var(--immi-accent-muted); }
.case-text-viewer .text-content.expanded { max-height: none; }

/* ── Responsive: Small phones (≤576px) ────────────────────────────── */
@media (max-width: 576px) {
  .case-hero .citation-display { font-size: 1rem; }
  .case-hero .case-title { font-size: 0.82rem; }
  .meta-grid { grid-template-columns: 1fr; }
  .filter-bar .row { gap: 0.25rem; }
  .filter-bar .form-label { font-size: 0.7rem; }
  .related-cases-grid { grid-template-columns: 1fr; }
  .case-text-viewer .text-content { padding: 0.75rem 1rem; font-size: 0.82rem; }
  .text-toolbar { gap: 0.25rem; padding: 0.3rem 0.5rem; }
  .text-toolbar input[type="text"] { min-width: 80px; font-size: 0.75rem; }
  .batch-bar { padding: 0.5rem 0.75rem; gap: 0.5rem; flex-wrap: wrap; }
  .batch-bar .btn { font-size: 0.7rem; padding: 2px 6px; }
}

/* ── Responsive: Tablet (577px–991px) ─────────────────────────────── */
@media (min-width: 577px) and (max-width: 991px) {
  .filter-bar .row > [class*="col-lg"] { flex: 0 0 50%; max-width: 50%; }
  .meta-grid { grid-template-columns: repeat(2, 1fr); }
  .related-cases-grid { grid-template-columns: repeat(2, 1fr); }
}

/* ── Responsive: Wide screens (≥1400px) ───────────────────────────── */
@media (min-width: 1400px) {
  .container-fluid { max-width: 1600px; }
  .table-cases { font-size: 0.88rem; }
  .meta-grid { grid-template-columns: repeat(3, 1fr); }
  .related-cases-grid { grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); }
  .case-text-viewer .text-content { max-height: 80vh; padding: 1.5rem 2rem; }
}

/* ── Print Styles ────────────────────────────────────────────────────── */
@media print {
  .immi-navbar, .immi-sidebar, .mobile-nav, .toast-container,
  .btn, .filter-bar, .batch-bar, .skip-link, .theme-toggle,
  .mobile-search-bar { display: none !important; }

  body {
    font-family: Georgia, 'Times New Roman', serif;
    font-size: 11pt;
    color: #000;
    background: #fff;
  }

  .card { border: 1px solid #ccc; box-shadow: none; break-inside: avoid; }
  .case-text-viewer .text-content { max-height: none; overflow: visible; }
  main { padding: 0 !important; }
  .col-lg-10 { flex: 0 0 100%; max-width: 100%; }
  .case-hero { background: #f5f5f5; }

  a[href]::after { content: none; }
}
