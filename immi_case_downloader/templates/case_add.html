{% extends "base.html" %}
{% block title %}Add Case{% endblock %}
{% block content %}
<nav aria-label="breadcrumb"><ol class="breadcrumb small">
  <li class="breadcrumb-item"><a href="{{ url_for('case_list') }}">Cases</a></li>
  <li class="breadcrumb-item active">Add New</li>
</ol></nav>
<h4 class="mb-3 font-serif"><i class="bi bi-plus-circle me-2"></i>Add Case Manually</h4>
<form method="post" class="needs-validation" novalidate>
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  <div class="row g-3">
    <div class="col-lg-8">
      <div class="card">
        <div class="card-header"><i class="bi bi-file-earmark-text me-1"></i>Case Details</div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label small" for="add_citation">Citation <span class="text-danger">*</span></label>
              <input type="text" name="citation" id="add_citation" class="form-control form-control-sm" placeholder="[2024] AATA 1234" pattern="\[?\d{4}\]?\s+\w+\s+\d+" required>
              <div class="invalid-feedback">Citation required (e.g. [2024] AATA 1234).</div>
            </div>
            <div class="col-12">
              <label class="form-label small" for="add_title">Title / Parties <span class="text-danger">*</span></label>
              <input type="text" name="title" id="add_title" class="form-control form-control-sm" placeholder="Smith v Minister for Immigration" required>
              <div class="invalid-feedback">Title is required.</div>
            </div>
            <div class="col-md-5">
              <label class="form-label small" for="add_court">Court</label>
              <select name="court" id="add_court" class="form-select form-select-sm">
                <option value="">-- Select --</option>
                {% for code, info in databases.items() %}<option value="{{ info.name }}">{{ info.name }}</option>{% endfor %}
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label small" for="add_court_code">Code</label>
              <select name="court_code" id="add_court_code" class="form-select form-select-sm">
                <option value="">--</option>
                {% for code in databases %}<option value="{{ code }}">{{ code }}</option>{% endfor %}
              </select>
            </div>
            <div class="col-md-2">
              <label class="form-label small" for="add_year">Year</label>
              <input type="number" name="year" id="add_year" class="form-control form-control-sm" placeholder="2024" min="1900" max="2100">
            </div>
            <div class="col-md-2">
              <label class="form-label small" for="add_date">Date</label>
              <input type="text" name="date" id="add_date" class="form-control form-control-sm" placeholder="15 Mar 2024">
            </div>
            <div class="col-md-6">
              <label class="form-label small" for="add_judges">Judge(s)</label>
              <input type="text" name="judges" id="add_judges" class="form-control form-control-sm">
            </div>
            <div class="col-md-6">
              <label class="form-label small" for="add_visa_type">Visa Type</label>
              <input type="text" name="visa_type" id="add_visa_type" class="form-control form-control-sm" placeholder="protection visa">
            </div>
            <div class="col-12">
              <label class="form-label small" for="add_url">URL</label>
              <input type="url" name="url" id="add_url" class="form-control form-control-sm" placeholder="https://...">
              <div class="invalid-feedback">Please enter a valid URL.</div>
            </div>
            <div class="col-12">
              <label class="form-label small" for="add_catchwords">Catchwords</label>
              <textarea name="catchwords" id="add_catchwords" class="form-control form-control-sm" rows="2"></textarea>
            </div>
            <div class="col-12">
              <label class="form-label small" for="add_outcome">Outcome</label>
              <textarea name="outcome" id="add_outcome" class="form-control form-control-sm" rows="2" placeholder="Application dismissed..."></textarea>
            </div>
            <div class="col-12">
              <label class="form-label small" for="add_legislation">Legislation</label>
              <textarea name="legislation" id="add_legislation" class="form-control form-control-sm" rows="2" placeholder="Migration Act 1958 s 501"></textarea>
            </div>
            <div class="col-md-4">
              <label class="form-label small" for="add_case_nature">Case Nature</label>
              <select name="case_nature" id="add_case_nature" class="form-select form-select-sm">
                <option value="">--</option>
                {% for n in ['Merits Review','Judicial Review','Appeal','Visa Cancellation','Visa Refusal','Detention Challenge','Deportation','Constitutional'] %}
                <option value="{{ n }}">{{ n }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-8">
              <label class="form-label small" for="add_legal_concepts">Legal Concepts <span class="text-muted">(semicolon separated)</span></label>
              <textarea name="legal_concepts" id="add_legal_concepts" class="form-control form-control-sm" rows="2" placeholder="Jurisdictional error; Procedural fairness; Unreasonableness"></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="card mb-3">
        <div class="card-header"><i class="bi bi-bookmark me-1"></i>Your Annotations</div>
        <div class="card-body">
          <label class="form-label small" for="add_tags">Tags</label>
          <input type="text" name="tags" id="add_tags" class="form-control form-control-sm mb-3" placeholder="important, character-test">
          <label class="form-label small" for="add_notes">Notes</label>
          <textarea name="user_notes" id="add_notes" class="form-control form-control-sm" rows="6" placeholder="Your analysis..."></textarea>
        </div>
      </div>
      <div class="d-grid gap-2">
        <button type="submit" class="btn btn-primary"><i class="bi bi-plus-circle me-1"></i>Add Case</button>
        <a href="{{ url_for('case_list') }}" class="btn btn-outline-secondary">Cancel</a>
      </div>
    </div>
  </div>
</form>
{% endblock %}

{% block extra_js %}
<script>
(function() {
  'use strict';
  var form = document.querySelector('.needs-validation');
  if (form) {
    form.addEventListener('submit', function(event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    });
  }
})();
</script>
{% endblock %}
