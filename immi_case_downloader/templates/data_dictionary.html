{% extends "base.html" %}
{% block title %}Data Dictionary{% endblock %}

{% block content %}
<nav aria-label="breadcrumb"><ol class="breadcrumb small">
  <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
  <li class="breadcrumb-item active">Data Dictionary</li>
</ol></nav>
<div class="d-flex justify-content-between align-items-center mb-3">
  <div><h4 class="mb-0">Data Dictionary</h4><small class="text-muted">All data points captured for each immigration case</small></div>
  <div class="d-flex gap-1">
    <a href="{{ url_for('export_data', fmt='csv') }}" class="btn btn-sm btn-outline-success"><i class="bi bi-filetype-csv me-1"></i>CSV</a>
    <a href="{{ url_for('export_data', fmt='json') }}" class="btn btn-sm btn-outline-primary"><i class="bi bi-filetype-json me-1"></i>JSON</a>
  </div>
</div>

<!-- Data population stages overview -->
<div class="card mb-4">
  <div class="card-header"><i class="bi bi-diagram-3 me-1"></i>Data Population Pipeline</div>
  <div class="card-body">
    <div class="row g-3 text-center">
      <div class="col-md-4">
        <div class="stage-badge search mb-2"><i class="bi bi-search"></i> Stage 1: Search</div>
        <div class="small text-muted">Core identification fields scraped from court listing pages</div>
        <div class="mt-1"><code class="me-1">citation</code><code class="me-1">title</code><code class="me-1">court</code><code class="me-1">court_code</code><code class="me-1">year</code><code class="me-1">url</code><code>source</code></div>
      </div>
      <div class="col-md-4">
        <div class="stage-badge download mb-2"><i class="bi bi-cloud-download"></i> Stage 2: Download</div>
        <div class="small text-muted">Detailed fields extracted from full judgment text via pattern matching</div>
        <div class="mt-1"><code class="me-1">judges</code><code class="me-1">date</code><code class="me-1">catchwords</code><code class="me-1">outcome</code><code class="me-1">visa_type</code><code class="me-1">legislation</code><code>full_text_path</code></div>
      </div>
      <div class="col-md-4">
        <div class="stage-badge user mb-2"><i class="bi bi-pencil"></i> Stage 3: Your Edits</div>
        <div class="small text-muted">Your personal annotations, plus corrections to any field</div>
        <div class="mt-1"><code class="me-1">user_notes</code><code>tags</code></div>
      </div>
    </div>
  </div>
</div>

<!-- Core ID fields -->
<div class="card dict-section mb-3">
  <div class="card-header"><span class="stage-badge search me-2"><i class="bi bi-key"></i> Core</span>Identification Fields</div>
  <div class="table-responsive">
    <table class="table table-hover table-sm mb-0">
      <thead class="table-light"><tr><th style="width:140px">Column</th><th style="width:100px">Type</th><th>Description</th><th style="width:260px">Example</th></tr></thead>
      <tbody>
        <tr>
          <td><code>case_id</code></td>
          <td class="small">Text (12)</td>
          <td class="small">Auto-generated unique identifier (SHA-256 hash of citation/URL). Used internally to link records.</td>
          <td class="small"><code>a3f8b2c1d4e5</code></td>
        </tr>
        <tr>
          <td><code>citation</code></td>
          <td class="small">Text</td>
          <td class="small"><strong>Legal citation</strong> &mdash; the official reference for citing in legal documents. Format: <code>[Year] CourtCode Number</code></td>
          <td class="small"><code>[2024] AATA 1234</code></td>
        </tr>
        <tr>
          <td><code>title</code></td>
          <td class="small">Text</td>
          <td class="small"><strong>Case title / parties</strong> &mdash; typically applicant vs. Minister/Department. AATA cases include <code>(Migration)</code> or <code>(Refugee)</code> markers.</td>
          <td class="small"><code>JSWC and Minister for Immigration... (Migration)</code></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Court & Date fields -->
<div class="card dict-section mb-3">
  <div class="card-header"><span class="stage-badge search me-2"><i class="bi bi-bank"></i> Court</span>Court &amp; Date Fields</div>
  <div class="table-responsive">
    <table class="table table-hover table-sm mb-0">
      <thead class="table-light"><tr><th style="width:140px">Column</th><th style="width:100px">Type</th><th>Description</th><th style="width:260px">Example</th></tr></thead>
      <tbody>
        <tr>
          <td><code>court</code></td>
          <td class="small">Text</td>
          <td class="small"><strong>Full court name</strong> of the deciding court or tribunal.</td>
          <td class="small"><code>Administrative Appeals Tribunal</code></td>
        </tr>
        <tr>
          <td><code>court_code</code></td>
          <td class="small">Text (short)</td>
          <td class="small"><strong>Court abbreviation</strong> used in citations and for filtering.</td>
          <td class="small">
            <span class="badge badge-court badge-AATA me-1">AATA</span>
            <span class="badge badge-court badge-FCA me-1">FCA</span>
            <span class="badge badge-court badge-FCCA me-1">FCCA</span>
            <span class="badge badge-court badge-HCA me-1">HCA</span>
            <span class="badge badge-court badge-RRTA me-1">RRTA</span>
            <span class="badge badge-court badge-MRTA">MRTA</span>
          </td>
        </tr>
        <tr>
          <td><code>date</code></td>
          <td class="small">Text</td>
          <td class="small"><strong>Decision date</strong> when the judgment was handed down. Extracted from the case document.</td>
          <td class="small"><code>2 January 2024</code></td>
        </tr>
        <tr>
          <td><code>year</code></td>
          <td class="small">Integer</td>
          <td class="small"><strong>Decision year</strong> for easy filtering and sorting.</td>
          <td class="small"><code>2024</code></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Case content fields -->
<div class="card dict-section mb-3">
  <div class="card-header"><span class="stage-badge download me-2"><i class="bi bi-file-earmark-text"></i> Content</span>Case Content Fields</div>
  <div class="table-responsive">
    <table class="table table-hover table-sm mb-0">
      <thead class="table-light"><tr><th style="width:140px">Column</th><th style="width:100px">Type</th><th>Description</th><th style="width:260px">Example</th></tr></thead>
      <tbody>
        <tr>
          <td><code>judges</code></td>
          <td class="small">Text</td>
          <td class="small"><strong>Decision-maker(s)</strong> &mdash; judge, justice, or tribunal member. Extracted from case document header.</td>
          <td class="small"><code>Gabrielle Cullen</code></td>
        </tr>
        <tr>
          <td><code>catchwords</code></td>
          <td class="small">Text (long)</td>
          <td class="small"><strong>Legal catchwords/topics</strong> &mdash; standardized keywords summarizing legal issues, assigned by the court.</td>
          <td class="small"><code>MIGRATION - Protection visa - whether applicant...</code></td>
        </tr>
        <tr>
          <td><code>outcome</code></td>
          <td class="small">Text</td>
          <td class="small"><strong>Decision outcome</strong> &mdash; what the court decided. Displayed as colour-coded badges: <span class="badge badge-outcome affirm">Affirmed</span> <span class="badge badge-outcome setaside">Set aside</span></td>
          <td class="small"><code>The Tribunal affirms the decision under review</code></td>
        </tr>
        <tr>
          <td><code>visa_type</code></td>
          <td class="small">Text</td>
          <td class="small"><strong>Visa type involved</strong> &mdash; auto-detected from case text. Identifies visa subclass or category.</td>
          <td class="small"><code>protection visa</code>, <code>partner visa</code></td>
        </tr>
        <tr>
          <td><code>legislation</code></td>
          <td class="small">Text</td>
          <td class="small"><strong>Legislation cited</strong> &mdash; key Acts and sections referenced.</td>
          <td class="small"><code>Migration Act 1958 s 36</code></td>
        </tr>
        <tr>
          <td><code>text_snippet</code></td>
          <td class="small">Text</td>
          <td class="small"><strong>Short excerpt</strong> from search results or case summary.</td>
          <td class="small">(first ~300 chars)</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Source & File fields -->
<div class="card dict-section mb-3">
  <div class="card-header"><span class="stage-badge search me-2"><i class="bi bi-link-45deg"></i> Source</span>Source &amp; File Fields</div>
  <div class="table-responsive">
    <table class="table table-hover table-sm mb-0">
      <thead class="table-light"><tr><th style="width:140px">Column</th><th style="width:100px">Type</th><th>Description</th><th style="width:260px">Example</th></tr></thead>
      <tbody>
        <tr>
          <td><code>url</code></td>
          <td class="small">URL</td>
          <td class="small"><strong>Source URL</strong> &mdash; direct link to the case on AustLII or the Federal Court website.</td>
          <td class="small"><code>https://www.austlii.edu.au/.../2024/16.html</code></td>
        </tr>
        <tr>
          <td><code>full_text_path</code></td>
          <td class="small">File path</td>
          <td class="small"><strong>Local file path</strong> to the downloaded full-text .txt file (populated after download step).</td>
          <td class="small"><code>downloaded_cases/case_texts/[2024] AATA 16.txt</code></td>
        </tr>
        <tr>
          <td><code>source</code></td>
          <td class="small">Text</td>
          <td class="small"><strong>Data source</strong> &mdash; which database the case was found in.</td>
          <td class="small"><code>AustLII</code>, <code>Federal Court</code>, <code>Manual Entry</code></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- User fields -->
<div class="card dict-section mb-3">
  <div class="card-header"><span class="stage-badge user me-2"><i class="bi bi-pencil"></i> User</span>Your Annotations</div>
  <div class="table-responsive">
    <table class="table table-hover table-sm mb-0">
      <thead class="table-light"><tr><th style="width:140px">Column</th><th style="width:100px">Type</th><th>Description</th><th style="width:260px">Example</th></tr></thead>
      <tbody>
        <tr>
          <td><code>user_notes</code></td>
          <td class="small">Text (long)</td>
          <td class="small"><strong>Your personal notes</strong> &mdash; analysis, observations, cross-references. Editable via web interface.</td>
          <td class="small"><code>Key case for s501 character test. Compare with XYZ [2023] FCA 100.</code></td>
        </tr>
        <tr>
          <td><code>tags</code></td>
          <td class="small">Text (CSV)</td>
          <td class="small"><strong>Custom tags</strong> &mdash; your own labels for categorization. Comma-separated, filterable in Browse view.</td>
          <td class="small"><code>important, character-test, s501</code></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
